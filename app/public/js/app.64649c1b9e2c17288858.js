webpackJsonp([1],{"+skl":function(t,e){},"1Cko":function(t,e){},"3VT9":function(t,e){},"4QtO":function(t,e){},B0C9:function(t,e){},D9xM:function(t,e){},EoEn:function(t,e){},EwBh:function(t,e){},GvKr:function(t,e){},HLmO:function(t,e){},Hpvh:function(t,e){},"I/Tt":function(t,e){},MLrj:function(t,e){},N6Q0:function(t,e){},NHnr:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("7+uW"),i=a("BTaQ"),o=a.n(i),n=(a("+skl"),{render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("transition",{attrs:{name:"router-transition"}},[e("router-view")],1)],1)},staticRenderFns:[]});var r=a("VU/8")({name:"App"},n,!1,function(t){a("GvKr")},null,null).exports,l=a("/ocq"),c=a("woOf"),p=a.n(c),d=a("mtWM"),u=a.n(d),h=a("qajy"),v=a.n(h);function f(t,e,a){401!==Number(e)?a?this.$Message.error({content:t,duration:a,closable:!0}):this.$Message.error(t):location.reload()}function m(){for(var t=document.cookie.split(";").map(function(t){return t.split("=").map(function(t){return t.trim()})}),e=t.length,a=0;a<e;a++){var s=t[a];if("csrfToken"===s[0])return s[1]}}function g(t){return void 0===t||null===t?"-":isNaN(t)?"-":t<1e3?t:t<1e6?(t/1e3).toFixed(1)+"K":(t/1e6).toFixed(1)+"M"}function y(t,e){var a=t===Math.abs(t),s="";return s=(t=+(t=Math.abs(t)))/1024<1?t.toFixed(2)+" Bytes":t/1024/1024<1?(t/1024).toFixed(2)+" KB":t/1024/1024/1024<1?(t/1024/1024).toFixed(2)+" MB":(t/1024/1024/1024).toFixed(2)+" GB",t?a?""+(e?"+"+s:s):"-"+s:s}function _(t,e){t=!isNaN(t)&&t||0;var a="";if((t=Number(t))<1e3)a=t.toFixed(2)+" "+(e?"毫秒":"ms");else if(t<6e4)a=(t/1e3).toFixed(2)+" "+(e?"秒":"s");else if(t<36e5)a=(t/6e4).toFixed(2)+" "+(e?"分钟":"min");else if(t<864e5)a=(t/36e5).toFixed(2)+" "+(e?"小时":"h");else{var s=parseInt(t/864e5),i=t-1e3*s*60*60*24;a=s+" "+(e?"天":"d")+(i?" "+_(i,e):"")}return a}function w(t){return null!==t&&!isNaN(t)}var C={methods:{getUserInfo:function(){var t=this;u.a.get("/api/user").then(function(e){(e=e.data).ok?(e=e.data,t.userName=e.name):f.call(t,"获取用户信息错误，请重试！",e.code)}).catch(function(e){return f.call(t,"获取用户信息错误，请重试！ "+e,e.code)})}}},x=p()({props:["activeName","menuStyle"],data:function(){return{userName:""}},created:function(){this.getUserInfo()}},C),b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Header",{style:{width:"100%"}},[a("Menu",{style:t.menuStyle,attrs:{mode:"horizontal",theme:"dark","active-name":t.activeName}},[a("router-link",{attrs:{to:{path:"/"}}},[a("div",{staticClass:"layout-logo"},[t._v("XNPP")])]),t._v(" "),a("div",{staticClass:"layout-nav"},[a("a",{attrs:{href:"/public/docs/xnpp/index.html",target:"_blank"}},[a("MenuItem",{attrs:{name:"doc"}},[a("Icon",{staticClass:"menu-icon",attrs:{type:"ios-book"}}),t._v("文档\n        ")],1)],1),t._v(" "),a("router-link",{attrs:{to:{path:"/console",query:{type:"myApps"}}}},[a("MenuItem",{attrs:{name:"console"}},[a("Icon",{staticClass:"menu-icon",attrs:{type:"ios-keypad"}}),t._v("控制台\n        ")],1)],1),t._v(" "),a("MenuItem",{attrs:{name:"persona"}},[a("Icon",{staticClass:"menu-icon",attrs:{type:"ios-contact"}}),t._v("\n        "+t._s(t.userName)+"\n      ")],1)],1)],1)],1)},staticRenderFns:[]};var k=a("VU/8")(x,b,!1,function(t){a("bDuY")},"data-v-e7633222",null).exports,S={components:{"x-header":k},data:function(){return{featureStyle:""}},mounted:function(){var t=window.innerHeight,e=parseInt(window.getComputedStyle(this.$refs.xheader.$el).height,10)+parseInt(window.getComputedStyle(this.$refs.xlogo.$el).height,10);t>e&&(this.featureStyle="min-height:"+(t-e)+"px;")}},T={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home"},[a("x-header",{ref:"xheader",attrs:{"menu-style":"background:#030c1c;"}}),t._v(" "),a("Row",{staticClass:"body"},[a("Row",{ref:"xlogo",staticClass:"homeContainer"},[a("div",{staticClass:"wrapper homeWrapper"},[a("div",{staticClass:"xnodeProjectLogo"},[a("div",{staticClass:"xnode-logo"},[a("span",{staticClass:"open neon-heading neon-flicker-blink"},[t._v("XNPP")]),t._v(" "),a("span",{staticClass:"hrs neon-subheading"},[t._v("Monitoring Tool for Node.js")])])])])]),t._v(" "),a("Row",{staticClass:"feature",style:t.featureStyle,attrs:{type:"flex",justify:"center",gutter:24}},[a("Col",{attrs:{span:"6"}},[a("Icon",{staticClass:"home-icon",attrs:{type:"ios-cloud-upload-outline"}}),t._v(" "),a("div",{staticClass:"f1"},[t._v("实时采集")]),t._v(" "),a("div",{staticClass:"f2"},[t._v("无论 JS 工作线程处于何种状况，都可以采集到 CPU / Memory / GC / Libuv 句柄信息")])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Icon",{staticClass:"home-icon",attrs:{type:"ios-alarm-outline"}}),t._v(" "),a("div",{staticClass:"f1"},[t._v("阈值告警")]),t._v(" "),a("div",{staticClass:"f2"},[t._v("基于 DSL 表达式进行阈值条件告警的设置，触发判定后通过邮件等自定义形式通知")])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Icon",{staticClass:"home-icon",attrs:{type:"ios-git-network"}}),t._v(" "),a("div",{staticClass:"f1"},[t._v("智能分析")]),t._v(" "),a("div",{staticClass:"f2"},[t._v("集成 Chromium Devtools 调试套件，辅以定制化的 XNPP 分析服务更快定位到问题所在")])],1)],1)],1)],1)},staticRenderFns:[]};var L=a("VU/8")(S,T,!1,function(t){a("b6ah")},"data-v-7b5fb5c0",null).exports,I={methods:{createApp:function(){this.showCreateAppModal=!0,this.newAppName=""},submitNewAppCreation:function(){var t=this;this.newAppName?this.newAppName.length>20?this.$Message.error("应用名称不能超过 20 个字符！"):(this.creationNewAppLoading=!0,u()({method:"POST",url:"/api/application",headers:{"x-csrf-token":m()},data:{appName:this.newAppName}}).then(function(e){(e=e.data).ok?(e=e.data,t.newAppInfo.name=e.appName,t.newAppInfo.id=e.appId,t.newAppInfo.secret=e.appSecret,t.showCreateAppResultModal=!0,t.showCreateAppModal=!1):f.call(t,e.message||"创建新应用失败，请重试！",e.code),t.creationNewAppLoading=!1}).catch(function(e){f.call(t,"创建新应用失败，请重试！ "+e,e.code),t.creationNewAppLoading=!1})):this.$Message.error("请输入新应用的名称！")},cancelNewAppCreation:function(){this.showCreateAppModal=!1},confirmNewAppCreation:function(){this.showCreateAppResultModal=!1,this.getApps()},getApps:function(){var t=this;this.loadingAppData=!0;var e="获取 APP 列表失败，请刷新页面重试！";u.a.get("/api/apps",{params:{type:this.appTab}}).then(function(a){(a=a.data).ok?((a=a.data)&&Array.isArray(a.list)?t.appList=a.list:t.appList=[],a&&Array.isArray(a.invitations)?t.invitationList=a.invitations:t.invitationList=[]):f.call(t,a.message||e,a.code),t.loadingAppData=!1}).catch(function(a){f.call(t,e+" "+a,a.code),t.loadingAppData=!1})},updateInvitation:function(){this.getApps()}},watch:{appTab:function(){this.$route.query.type!==this.appTab&&(this.$router.push({path:"/console",query:{type:this.appTab}}),this.appList=[],this.getApps())},$route:function(t){t.query.type!==this.appTab&&(this.appTab=t.query.type,this.appList=[],this.getApps())}},computed:{appTip:function(){return"myApps"===this.appTab?"您的账号下没有任何应用，请点击右上角 【创建新应用】按钮进行创建":"您暂时没有加入任何应用"}},updated:function(){this.$emit("appListChanged")}},D={methods:{getRandomColor:function(t){var e=["#19be6b","#2d8cf0","#9B59B6","#3498DB","#28B463"];return"border-left: 5px solid "+e[t%e.length]},getInstanceCount:function(){var t=this,e="获取应用实例信息失败，请刷新页面重试！";this.instanceCountLoading=!0,u.a.get("/api/app/instance_count",{params:{appId:this.app.appId}}).then(function(a){(a=a.data).ok?void 0===(a=a.data).count||isNaN(a.count)||(t.instanceCount=a.count):console.error(a.message||e),t.instanceCountLoading=!1}).catch(function(a){console.error(e+" "+a),t.instanceCountLoading=!1})},getAlarmCount:function(){var t=this,e="获取应用报警信息失败，请刷新页面重试！";this.alarmCountLoading=!0,u.a.get("/api/app/alarm_count",{params:{appId:this.app.appId}}).then(function(a){(a=a.data).ok?void 0===(a=a.data).count||isNaN(a.count)||(t.alarmCount=a.count):console.error(a.message||e),t.alarmCountLoading=!1}).catch(function(a){console.error(e+" "+a),t.alarmCountLoading=!1})},formatCount:function(t){return g(t)},getNodeCpuAverageStatistics:function(){var t=this,e="获取应用 CPU 信息失败，请刷新页面重试！";this.cpuStatusLoading=!0,u.a.get("/api/app/cpu_overview",{params:{appId:this.app.appId}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.list)?t.cpuStatus=a.list:t.cpuStatus=[]):console.error(a.message||e),t.cpuStatusLoading=!1}).catch(function(a){console.error(e+" "+a),t.cpuStatusLoading=!1})},getNodeMomeryAverageStatistics:function(){var t=this,e="获取应用 Memory 信息失败，请刷新页面重试！";this.memoryStatusLoading=!0,u.a.get("/api/app/memory_overview",{params:{appId:this.app.appId}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.list)?t.memoryStatus=a.list:t.memoryStatus=[]):console.error(a.message||e),t.memoryStatusLoading=!1}).catch(function(a){console.error(e+" "+a),t.memoryStatusLoading=!1})}}},R=p()({data:function(){return{instanceCount:"-",instanceCountLoading:!1,alarmCount:"-",alarmCountLoading:!1,cpuStatus:[],cpuStatusLoading:!1,memoryStatus:[],memoryStatusLoading:!1}},props:["app","index"],created:function(){this.getInstanceCount(),this.getAlarmCount(),this.getNodeCpuAverageStatistics(),this.getNodeMomeryAverageStatistics()}},D),M={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"total",style:t.getRandomColor(t.index),attrs:{type:"flex",justify:"center"}},[a("div",{staticClass:"app-content"},[a("div",{staticClass:"app-name"},[t._v(t._s(t.app.appName))]),t._v(" "),a("div",{staticClass:"app-menu"},[a("router-link",{staticClass:"link-color",attrs:{to:{path:"/app/"+t.app.appId+"/agent",query:{appName:t.app.appName}}}},[a("div",[a("div",[t._v("实例")]),t._v(" "),a("Icon",{staticClass:"app-icon",attrs:{type:"ios-grid"}})],1)]),t._v(" "),a("router-link",{staticClass:"link-color",attrs:{to:{path:"/app/"+t.app.appId+"/file",query:{appName:t.app.appName}}}},[a("div",{staticClass:"app-menu-item"},[a("div",[t._v("文件")]),t._v(" "),a("Icon",{staticClass:"app-icon",attrs:{type:"ios-folder"}})],1)]),t._v(" "),a("router-link",{staticClass:"link-color",attrs:{to:{path:"/app/"+t.app.appId+"/team",query:{appName:t.app.appName}}}},[a("div",{staticClass:"app-menu-item"},[a("div",[t._v("团队")]),t._v(" "),a("Icon",{staticClass:"app-icon",attrs:{type:"md-person-add"}})],1)]),t._v(" "),a("router-link",{staticClass:"link-color",attrs:{to:{path:"/app/"+t.app.appId+"/alarm",query:{appName:t.app.appName}}}},[a("div",{staticClass:"app-menu-item"},[a("div",[t._v("报警")]),t._v(" "),a("Icon",{staticClass:"app-icon",attrs:{type:"ios-alarm"}})],1)]),t._v(" "),t.app.own?a("router-link",{staticClass:"link-color",attrs:{to:{path:"/app/"+t.app.appId+"/setting"}}},[a("div",{staticClass:"app-menu-item",style:t.app.own?"":"color:#c5c8ce"},[a("div",[t._v("设置")]),t._v(" "),a("Icon",{staticClass:"app-icon",attrs:{type:"md-build"}})],1)]):t._e()],1)]),t._v(" "),a("div",{staticClass:"overview"},[a("div",{staticClass:"overview-metric-item"},[a("div",{staticClass:"overview-title"},[t._v("实例总数")]),t._v(" "),a("transition",{attrs:{name:"common-transition"}},[t.instanceCountLoading?t._e():a("div",{staticClass:"overview-content"},[t._v(t._s(t.formatCount(t.instanceCount)))])]),t._v(" "),t.instanceCountLoading?a("Row",{staticClass:"overview-content-loading",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Spin",{attrs:{size:"small"}})],1)],1):t._e()],1),t._v(" "),a("div",{staticClass:"overview-metric-item"},[a("div",{staticClass:"overview-title"},[t._v("24h 报警数")]),t._v(" "),a("transition",{attrs:{name:"common-transition"}},[t.alarmCountLoading?t._e():a("div",{staticClass:"overview-content"},[t._v(t._s(t.formatCount(t.alarmCount)))])]),t._v(" "),t.alarmCountLoading?a("Row",{staticClass:"overview-content-loading",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Spin",{attrs:{size:"small"}})],1)],1):t._e()],1),t._v(" "),a("div",{staticClass:"overview-instance-item"},[a("div",{staticClass:"overview-title"},[t._v("Node 进程 CPU 平均负载")]),t._v(" "),t.cpuStatusLoading?a("Row",{staticClass:"overview-content-loading",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Spin",{attrs:{size:"small"}})],1)],1):t._e(),t._v(" "),a("transition",{attrs:{name:"common-transition"}},[t.cpuStatusLoading?t._e():a("div",{staticClass:"overview-content"},[t.cpuStatus.length?t._e():a("div",[t._v("-")]),t._v(" "),t.cpuStatus.length?a("div",{staticClass:"overview-icon-line",attrs:{type:"flex",justify:"center"}},t._l(t.cpuStatus,function(e,s){return a("div",{key:s,staticClass:"overview-icon-item",attrs:{title:"CPU: "+("-"===e.status?"-":e.cpuUsage+"%"),span:2}},[a("router-link",{attrs:{to:{path:"/app/"+t.app.appId+"/agent",query:{agentId:e.agentId,selectPid:e.pid}}}},["-"==e.status?a("Icon",{staticClass:"overview-icon-disable",attrs:{type:"ios-help-circle-outline"}}):t._e(),t._v(" "),0==e.status?a("Icon",{staticClass:"overview-icon-healthy",attrs:{type:"md-checkmark-circle"}}):t._e(),t._v(" "),1==e.status?a("Icon",{staticClass:"overview-icon-warn",attrs:{type:"md-checkmark-circle"}}):t._e(),t._v(" "),2==e.status?a("Icon",{staticClass:"overview-icon-error",attrs:{type:"md-close-circle"}}):t._e()],1)],1)}),0):t._e()])])],1),t._v(" "),a("div",{staticClass:"overview-instance-item"},[a("div",{staticClass:"overview-title"},[t._v("Node 进程 Memory 平均使用率")]),t._v(" "),t.memoryStatusLoading?a("Row",{staticClass:"overview-content-loading",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Spin",{attrs:{size:"small"}})],1)],1):t._e(),t._v(" "),a("transition",{attrs:{name:"common-transition"}},[t.memoryStatusLoading?t._e():a("div",{staticClass:"overview-content"},[t.memoryStatus.length?t._e():a("div",[t._v("-")]),t._v(" "),t.memoryStatus.length?a("div",{staticClass:"overview-icon-line",attrs:{type:"flex",justify:"center"}},t._l(t.memoryStatus,function(e,s){return a("div",{key:s,staticClass:"overview-icon-item",attrs:{title:"内存: "+("-"===e.status?"-":e.memoryUsage+"%"),span:2}},[a("router-link",{attrs:{to:{path:"/app/"+t.app.appId+"/agent/",query:{agentId:e.agentId,selectPid:e.pid}}}},["-"==e.status?a("Icon",{staticClass:"overview-icon-disable",attrs:{type:"ios-help-circle-outline"}}):t._e(),t._v(" "),0==e.status?a("Icon",{staticClass:"overview-icon-healthy",attrs:{type:"md-checkmark-circle"}}):t._e(),t._v(" "),1==e.status?a("Icon",{staticClass:"overview-icon-warn",attrs:{type:"md-checkmark-circle"}}):t._e(),t._v(" "),2==e.status?a("Icon",{staticClass:"overview-icon-error",attrs:{type:"md-close-circle"}}):t._e()],1)],1)}),0):t._e()])])],1)])])])},staticRenderFns:[]};var P=a("VU/8")(R,M,!1,function(t){a("ljx0")},"data-v-72fb9f91",null).exports,A={methods:{updateLoadingStatus:function(t,e){1===t?this.cancelLoading=e:this.confirmLoading=e},updateInvitation:function(t){var e=this;this.updateLoadingStatus(t,!0),u()({method:"PUT",url:"/api/member/invitation",headers:{"x-csrf-token":m()},data:{status:t,appId:this.invitation.appId}}).then(function(a){(a=a.data).ok?e.$emit("updateInvitation"):f.call(e,a.message||"更新邀请状态失败，请重试！",a.code),e.updateLoadingStatus(t,!1)}).catch(function(a){f.call(e,"更新邀请状态失败，请重试！ "+a,a.code),e.updateLoadingStatus(t,!1)})},rejectInvitation:function(){this.updateInvitation(1)},confirmInvitation:function(){this.updateInvitation(2)}}},j=p()({props:["invitation"],data:function(){return{cancelLoading:!1,confirmLoading:!1}}},A),F={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Alert",[a("Row",{staticStyle:{"text-align":"left"}},[a("Col",{attrs:{span:"18"}},[a("div",{staticClass:"title"},[t._v("\n          您收到了来自应用\n          "+t._s(t.invitation.appName)+" (Owner: "+t._s(t.invitation.owner)+") 的邀请！\n        ")]),t._v(" "),a("div",{staticClass:"tip"},[t._v("加入应用后您可以查看完整的监控数据、访问性能分析文件和协助定位问题")])]),t._v(" "),a("Col",{staticClass:"button"},[a("Button",{attrs:{loading:t.confirmLoading,type:"info"},on:{click:t.confirmInvitation}},[t._v("加入应用")]),t._v(" "),a("Button",{staticStyle:{"margin-left":"5px"},attrs:{type:"info",loading:t.cancelLoading,ghost:""},on:{click:t.rejectInvitation}},[t._v("谢绝邀请")])],1)],1)],1)],1)},staticRenderFns:[]};var N=a("VU/8")(j,F,!1,function(t){a("3VT9")},"data-v-26ad67bc",null).exports,$=p()({data:function(){return{showCreateAppModal:!1,newAppName:"",creationNewAppLoading:!1,showCreateAppResultModal:!1,newAppInfo:{name:"",id:"",secret:""},appTab:"",appList:[],invitationList:[],loadingAppData:!1}},components:{"x-app-view":P,"x-invitation":N},created:function(){this.appTab=this.$route.query.type||"myApps",this.getApps()}},I),z={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("Button",{staticClass:"create",attrs:{type:"primary",icon:"md-add"},on:{click:t.createApp}},[t._v("创建新应用")]),t._v(" "),a("Tabs",{attrs:{value:t.appTab},model:{value:t.appTab,callback:function(e){t.appTab=e},expression:"appTab"}},[a("TabPane",{attrs:{label:"我的应用",name:"myApps"}}),t._v(" "),a("TabPane",{attrs:{label:"我加入的应用",name:"joinedApps"}})],1),t._v(" "),t.loadingAppData?a("Row",{staticClass:"main-spin",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Spin",{attrs:{size:"large"}})],1)],1):t._e(),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.loadingAppData,expression:"!loadingAppData"}],staticStyle:{"margin-top":"-15px"}},[a("transition",{attrs:{name:"common-transition"}},[t.invitationList.length?a("div",t._l(t.invitationList,function(e,s){return a("x-invitation",{key:s,staticStyle:{"margin-top":"15px"},attrs:{invitation:e},on:{updateInvitation:t.updateInvitation}})}),1):t._e()]),t._v(" "),t.appList.length?t._e():a("div",{staticClass:"tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v("\n      "+t._s(t.appTip)+"\n    ")],1),t._v(" "),a("transition",{attrs:{name:"common-transition"}},[t.appList.length?a("div",t._l(t.appList,function(t,e){return a("x-app-view",{key:e,staticStyle:{"margin-top":"15px"},attrs:{app:t,index:e}})}),1):t._e()])],1),t._v(" "),a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"500",closable:""},model:{value:t.showCreateAppModal,callback:function(e){t.showCreateAppModal=e},expression:"showCreateAppModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("创建新应用")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"25px","margin-bottom":"15px"}},[a("Input",{model:{value:t.newAppName,callback:function(e){t.newAppName=e},expression:"newAppName"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("应用名称")])]),t._v(" "),a("br"),t._v(" "),a("span",[a("span",{staticStyle:{"font-weight":"bold"}},[t._v("注意")]),t._v("：应用名称最大长度不能超过 20 个字符\n      ")])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancelNewAppCreation}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.creationNewAppLoading},on:{click:t.submitNewAppCreation}},[t._v("提交")])],1)]),t._v(" "),a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"500",closable:""},model:{value:t.showCreateAppResultModal,callback:function(e){t.showCreateAppResultModal=e},expression:"showCreateAppResultModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("创建新应用成功")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"25px","margin-bottom":"15px","margin-left":"70px","font-size":"13px"}},[a("div",[a("span",{staticClass:"new-app-info"},[t._v("应用名称")]),t._v("\n        ：\n        "+t._s(t.newAppInfo.name)+"\n      ")]),t._v(" "),a("div",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[a("span",{staticClass:"new-app-info"},[t._v("应用 ID")]),t._v("\n        ：\n        "+t._s(t.newAppInfo.id)+"\n      ")]),t._v(" "),a("div",[a("span",{staticClass:"new-app-info"},[t._v("应用 Secret")]),t._v("\n        ：\n        "+t._s(t.newAppInfo.secret)+"\n      ")])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.confirmNewAppCreation}},[t._v("关闭")]),t._v(" "),a("Button",{attrs:{to:{path:"/app/"+t.newAppInfo.id+"/agent",query:{appName:t.newAppInfo.name}},type:"primary"}},[t._v("打开新应用")])],1)])],1)},staticRenderFns:[]};var U=a("VU/8")($,z,!1,function(t){a("N6Q0")},"data-v-63549bc7",null).exports,E={textAlign:"center",position:"fixed",bottom:0,width:"100%"},O=p()({data:function(){return{activeName:"console",layoutFooterCenter:E}},components:{"console-tab":U,"x-header":k},methods:{updateFooterStyle:function(){var t=window.innerHeight,e=parseInt(window.getComputedStyle(this.$refs.xheader.$el).height,10)+parseInt(window.getComputedStyle(this.$refs.xbody.$el).height,10)+parseInt(window.getComputedStyle(this.$refs.xfooter.$el).height,10);this.layoutFooterCenter=e<t?E:{}}}}),B={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"layout"},[e("x-header",{ref:"xheader",attrs:{"active-name":this.activeName}}),this._v(" "),e("Layout",[e("Content",{ref:"xbody",style:{background:"#fff"}},[e("console-tab",{on:{appListChanged:this.updateFooterStyle}})],1),this._v(" "),e("Footer",{ref:"xfooter",style:this.layoutFooterCenter},[this._v("2020 © 苏宁易购")])],1)],1)},staticRenderFns:[]};var G=a("VU/8")(O,B,!1,function(t){a("EoEn")},"data-v-c08032e8",null).exports,V={methods:{getAppSecret:function(){var t=this;u.a.get("/api/app/info",{params:{appId:this.appId}}).then(function(e){(e=e.data).ok?(e=e.data,t.appSecret=e.secret):f.call(t,e.message||"获取秘钥失败！",e.code)}).catch(function(e){return f.call(t,"获取秘钥失败！ "+e,e.code)})},modifyAppName:function(){this.newAppName=this.appName,this.showModifyAppModal=!0},cancelModifyAppCreation:function(){this.showModifyAppModal=!1},submitNewAppName:function(){var t=this;if(this.newAppName)if(this.newAppName!==this.appName)if(this.newAppName.length>20)this.$Message.error("应用名称不能超过 20 个字符！");else{this.modifyNewAppLoading=!0,u()({method:"POST",url:"/api/app/name",headers:{"x-csrf-token":m()},data:{appName:this.newAppName,appId:this.appId}}).then(function(e){(e=e.data).ok?t.$emit("updateAppName",t.newAppName):f.call(t,e.message||"修改应用名失败！",e.code),t.showModifyAppModal=!1,t.modifyNewAppLoading=!1}).catch(function(e){f.call(t,"修改应用名失败！ "+e,e.code),t.showModifyAppModal=!1,t.modifyNewAppLoading=!1})}else this.$Message.error("新应用名称不能和老应用一样！");else this.$Message.error("请输入新应用的名称！")},deleteApp:function(){this.showDeleteAppModal=!0},cancelDeleteAppCreation:function(){this.showDeleteAppModal=!1},submitAppDeletion:function(){var t=this;this.deleteAppLoading=!0,u()({method:"DELETE",url:"/api/application",headers:{"x-csrf-token":m()},data:{appId:this.appId}}).then(function(e){(e=e.data).ok?t.$router.push({path:"/console"}):f.call(t,e.message||"删除应用失败！",e.code),t.showDeleteAppModal=!1,t.deleteAppLoading=!1}).catch(function(e){f.call(t,"删除应用失败！ "+e,e.code),t.showModifyAppModal=!1,t.deleteAppLoading=!1})}}},H=p()({data:function(){return{appId:"",appSecret:"",showModifyAppModal:!1,modifyNewAppLoading:!1,showDeleteAppModal:!1,deleteAppLoading:!1,newAppName:""}},props:["appName"],created:function(){this.appId=this.$route.params.appId,this.getAppSecret()}},V),q={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      "+t._s(t.appName)+"\n      > 应用设置\n    ")])],1),t._v(" "),a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{staticClass:"content",attrs:{type:"flex",justify:"center"}},[a("Col",[a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",[a("span",{staticClass:"setting-key"},[t._v("应用名称：")]),t._v(" "),a("span",{staticClass:"setting-value"},[t._v(t._s(t.appName))])])],1),t._v(" "),a("br"),t._v(" "),a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",[a("span",{staticClass:"setting-key"},[t._v("应用 ID：")]),t._v(" "),a("span",{staticClass:"setting-value"},[t._v(t._s(t.appId))])])],1),t._v(" "),a("br"),t._v(" "),a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",[a("span",{staticClass:"setting-key"},[t._v("应用秘钥：")]),t._v(" "),a("span",{staticClass:"setting-value"},[t._v(t._s(t.appSecret))])])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px",width:"300px"},attrs:{type:"flex",justify:"start"}},[a("Col",{attrs:{span:"6"}},[a("Button",{attrs:{size:"small",type:"info",long:""},on:{click:t.modifyAppName}},[t._v("修改名称")])],1),t._v(" "),a("Col",{staticStyle:{"margin-left":"15px"},attrs:{span:"6"}},[a("Button",{attrs:{size:"small",type:"error",long:""},on:{click:t.deleteApp}},[t._v("删除应用")])],1)],1)],1)],1),t._v(" "),a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"500",closable:""},model:{value:t.showModifyAppModal,callback:function(e){t.showModifyAppModal=e},expression:"showModifyAppModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("修改应用名称")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"25px","margin-bottom":"15px"}},[a("Input",{model:{value:t.newAppName,callback:function(e){t.newAppName=e},expression:"newAppName"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("应用名称")])]),t._v(" "),a("br"),t._v(" "),a("span",[a("span",{staticStyle:{"font-weight":"bold"}},[t._v("注意")]),t._v("：应用名称最大长度不能超过 20 个字符\n      ")])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancelModifyAppCreation}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.modifyNewAppLoading},on:{click:t.submitNewAppName}},[t._v("提交")])],1)]),t._v(" "),a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"560",closable:""},model:{value:t.showDeleteAppModal,callback:function(e){t.showDeleteAppModal=e},expression:"showDeleteAppModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("删除应用")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"25px","margin-bottom":"15px"}},[a("Icon",{staticClass:"delete-warning",attrs:{type:"ios-warning-outline"}}),t._v(" "),a("span",{staticStyle:{"font-weight":"bold"}},[t._v("注意：")]),t._v("删除应用后您的所有实例都会断开，监控数据、性能分析文件等都会丢失，请谨慎操作！\n    ")],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancelDeleteAppCreation}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.deleteAppLoading},on:{click:t.submitAppDeletion}},[t._v("确认删除")])],1)])],1)},staticRenderFns:[]};var W=a("VU/8")(H,q,!1,function(t){a("mQRO")},"data-v-c4a06a8a",null).exports,X=a("BO1k"),K=a.n(X),Y={strategies:{global:"/api/alarm/global_strategies",default:"/api/alarm/strategies"},strategy:{global:"/api/alarm/global_strategy",default:"/api/alarm/strategy"},strategyStatus:{global:"/api/alarm/global_strategy_status",default:"/api/alarm/strategy_status"},list:{global:"/api/alarm/global_list",default:"/api/alarm/list"},members:{global:"/api/alarm/global_member_list",default:"/api/alarm/member_list"},member:{global:"/api/alarm/global_member",default:"/api/alarm/member"}},J={methods:{getRuleList:function(){var t=this;this.userRulesLoading=!0,u.a.get(Y.strategies[this.urlKey],{params:{appId:this.appId}}).then(function(e){(e=e.data).ok?(e=e.data,Array.isArray(e.list)&&(t.settedRuleList=e.list)):f.call(t,e.message||"获取规则列表失败，请重试！",e.code),t.userRulesLoading=!1}).catch(function(e){f.call(t,"获取规则列表失败，请重试！ "+e,e.code),t.userRulesLoading=!1})},checkAddRule:function(){return this.selectedContextType?this.selectedPushType?this.dsl?!!this.expr||(f.call(this,"请填写告警消息内容!"),!1):(f.call(this,"请填写阈值表达式!"),!1):(f.call(this,"请选择推送级别!"),!1):(f.call(this,"请选择判定上下文类型!"),!1)},addRule:function(){var t=this;if(this.checkAddRule()){this.addRuleLoading=!0,u()({method:"POST",url:Y.strategy[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,contextType:this.selectedContextType,pushType:this.selectedPushType,dsl:this.dsl,expr:this.expr}}).then(function(e){(e=e.data).ok?(t.getRuleList(),t.reset()):f.call(t,e.message||"添加告警规则失败，请重试！",e.code),t.addRuleLoading=!1}).catch(function(e){f.call(t,"添加告警规则失败，请重试！ "+e,e.code),t.addRuleLoading=!1})}},updateFastRule:function(){"fast_rule_memory"===this.selectedPreSettedRules?(this.selectedContextType="node_log",this.dsl="@heap_used / @heap_limit > 0.7",this.expr="已用堆内存超过堆上限的 70%，当前为 ${@heap_used / @heap_limit * 100}%"):"fast_rule_cpu"===this.selectedPreSettedRules?(this.selectedContextType="node_log",this.dsl="@cpu_60 > 80",this.expr="1 分钟内 CPU 使用率超过 80%，当前为 ${@cpu_60}%"):"fast_rule_coredump"===this.selectedPreSettedRules?(this.selectedContextType="xagent_notification",this.dsl="@corefile_created",this.expr="服务器生成 coredump 文件，路径为：${@corefile}，请分析查看原因!"):"fast_rule_os_memory"===this.selectedPreSettedRules?(this.selectedContextType="system_log",this.dsl="@os_mem_usage > 80",this.expr="系统内存整体使用率超过 80%，当前为 ${@os_mem_usage}%"):"fast_rule_os_cpu"===this.selectedPreSettedRules?(this.selectedContextType="system_log",this.dsl="@os_cpu_usage > 80",this.expr="系统 CPU 整体使用率超过 80%，当前为 ${@os_cpu_usage}%"):"fast_rule_disk_usage"===this.selectedPreSettedRules?(this.selectedContextType="system_log",this.dsl="@disk_usage > 85",this.expr="磁盘 (${@mounted_on}) 占比超过 85%：为 ${@disk_usage}%"):"fast_rule_error_log_content"===this.selectedPreSettedRules?(this.selectedContextType="error_log",this.dsl='@error_type == "TypeError" || @error_type ==  "SyntaxError"',this.expr="发生错误 ${@error_type}，堆栈是：${@stack}"):"fast_rule_node_process_exit"===this.selectedPreSettedRules?(this.selectedContextType="xagent_notification",this.dsl="@node_process_exit",this.expr="实例 ${@agent_id} 上 Node.js 进程 ${@pid} 退出，命令信息：${@cmd}"):"fast_rule_dependence_security_risk"===this.selectedPreSettedRules?(this.selectedContextType="xagent_notification",this.dsl="@critical > 0 || @high > 0",this.expr="项目依赖发现极危漏洞 ${@critical} 个，高危漏洞 ${@high} 个，请尽快升级修复"):"fast_rule_expired_request"===this.selectedPreSettedRules?(this.selectedContextType="system_log",this.dsl="@expired_request > 0",this.expr="1 分钟内响应超过 30s 时请求出现 ${@expired_request} 个，请多加关注"):"fast_rule_illegal_request"===this.selectedPreSettedRules?(this.selectedContextType="system_log",this.dsl="@code_4xx / @http_response_sent + @code_5xx / @http_response_sent > 0.5",this.expr="1 分钟内 4xx 和 5xx 请求数占比超过 50%，当前为 (${@code_4xx}, ${@code_5xx}) / ${@http_response_sent}"):(this.selectedContextType="node_log",this.dsl="",this.expr="")},getPushType:function(t){var e=!0,a=!1,s=void 0;try{for(var i,o=K()(this.pushTypeList);!(e=(i=o.next()).done);e=!0){var n=i.value;if(t===n.value)return n.label}}catch(t){a=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw s}}return t},getContextType:function(t){var e=!0,a=!1,s=void 0;try{for(var i,o=K()(this.contextTypeList);!(e=(i=o.next()).done);e=!0){var n=i.value;if(t===n.value)return n.label}}catch(t){a=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw s}}return t},updateAlarmListModalStatus:function(t){(this.showAlarmListModal=t,t)||this.$route.query.showAlarmListModal&&this.$router.push({path:this.$route.path})},showAlarmList:function(t){var e=this;this.showAlarmListModal=!0,this.alarmListModalLoading=!0;u.a.get(Y.list[this.urlKey],{params:{appId:this.appId,strategyId:t.strategyId}}).then(function(a){a=a.data,e.alarmListData=a,e.alarmListModalLoading=!1,e.$route.query.showAlarmListModal||e.$router.push({path:e.$route.path,query:p()({},e.$route.query,{showAlarmListModal:1,strategyId:t.strategyId})})}).catch(function(t){e.alarmListData={ok:!1,message:"获取告警列表失败，请重试！ "+t},e.alarmListModalLoading=!1})},updateAlarmMemberSettingModalStatus:function(t){this.showAlarmMemberSettingModal=t},getMemberSetting:function(t){var e=this;u.a.get(Y.members[this.urlKey],{params:{appId:this.appId,strategyId:t.strategyId}}).then(function(t){t=t.data,e.alarmMemberSettingData=t,e.alarmMemberSettingModalLoading=!1}).catch(function(t){e.alarmMemberSettingData={ok:!1,message:"获取告警联系人信息失败，请重试！ "+t},e.alarmMemberSettingModalLoading=!1})},showMemberSetting:function(t){this.showAlarmMemberSettingModal=!0,this.alarmMemberSettingModalLoading=!0,this.alarmMemberSettingRule=t.dsl,this.getMemberSetting(t)},removeFromContactList:function(t){var e=this;this.removeContactLoading=!0;var a="移出告警联系人列表失败，请重试！";u()({method:"DELETE",url:Y.member[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,strategyId:t.strategyId,workId:t.workId}}).then(function(s){(s=s.data).ok?e.getMemberSetting(t):f.call(e,s.message||a,s.code),e.removeContactLoading=!1}).catch(function(t){f.call(e,a+" "+t,t.code),e.removeContactLoading=!1})},addToContactList:function(t){var e=this;this.addContactLoading=!0;var a="添加至告警联系人列表失败，请重试！";u()({method:"PUT",url:Y.member[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,strategyId:t.strategyId,workId:t.workId}}).then(function(s){(s=s.data).ok?e.getMemberSetting(t):f.call(e,s.message||a,s.code),e.addContactLoading=!1}).catch(function(t){f.call(e,a+" "+t,t.code),e.addContactLoading=!1})},updateRuleStatus:function(t,e){var a=this;this.userRulesLoading=!0;var s="更新规则状态为 "+(1===e?"启用":"禁用")+" 失败，请重试";u()({method:"PUT",url:Y.strategyStatus[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,strategyId:t.strategyId,status:e}}).then(function(t){(t=t.data).ok?(a.getRuleList(),a.reset()):(f.call(a,t.message||s,t.code),a.updateRuleLoading=!1)}).catch(function(t){f.call(a,s+" "+t,t.code),a.userRulesLoading=!1})},deleteRule:function(t){var e=this;this.userRulesLoading=!0;u()({method:"DELETE",url:Y.strategy[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,strategyId:t.strategyId}}).then(function(t){(t=t.data).ok?(e.getRuleList(),e.reset()):(f.call(e,t.message||"删除规则失败，请重试",t.code),e.updateRuleLoading=!1)}).catch(function(t){f.call(e,"删除规则失败，请重试 "+t,t.code),e.userRulesLoading=!1})},selectMoreAction:function(t){var e=JSON.parse(t);if("edit"===e.action){this.ruleEditData=e.row;var a=this.$refs.configureRule;a&&a.$el&&"function"==typeof a.$el.scrollIntoView&&a.$el.scrollIntoView(!0)}"disable"===e.action&&this.updateRuleStatus(e.row,0),"delete"===e.action&&this.deleteRule(e.row)},reset:function(){this.selectedContextType="node_log",this.selectedPushType="p3",this.selectedPreSettedRules="",this.dsl="",this.expr="",this.ruleEditData=null},cancelUpdateRule:function(){this.reset()},updateRule:function(){var t=this;if(this.checkAddRule())if(this.ruleEditData&&this.ruleEditData.strategyId){this.updateRuleLoading=!0,u()({method:"PUT",url:Y.strategy[this.urlKey],headers:{"x-csrf-token":m()},data:{appId:this.appId,contextType:this.selectedContextType,pushType:this.selectedPushType,dsl:this.dsl,expr:this.expr,strategyId:this.ruleEditData.strategyId}}).then(function(e){(e=e.data).ok?(t.getRuleList(),t.reset()):f.call(t,e.message||"更新告警规则失败，请重试！",e.code),t.updateRuleLoading=!1}).catch(function(e){f.call(t,"更新告警规则失败，请重试！ "+e,e.code),t.updateRuleLoading=!1})}else f.call(this,"没有告警规则 Id!")}},computed:{shouldShowUpdate:function(){var t=this.ruleEditData;return t&&t.dsl&&t.expr&&t.contextType&&t.pushType},urlKey:function(){return this.globalRule?"global":"default"}},watch:{ruleEditData:function(){var t=this.ruleEditData;this.shouldShowUpdate&&(this.selectedContextType=t.contextType,this.selectedPushType=t.pushType,this.dsl=t.dsl,this.expr=t.expr)}}},Q={props:["show","loading","cancel","data","getContextType"],data:function(){return{showModal:!1,columns:[{title:"告警时间",slot:"time",width:150},{title:"上下文类型",slot:"contextType",width:150},{title:"应用 ID",slot:"appId",width:125},{title:"实例 ID",slot:"agentId",width:300},{title:"消息内容",slot:"expr"},{title:"操作",slot:"action",align:"center",width:150}]}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}},computed:{list:function(){var t=this,e=this.data.data;if(!e)return[];var a=e.list;return Array.isArray(a)?(a=a.map(function(e){return p()({},e,{contextType:t.getContextType(e.contextType)})}),a):[]},totalCount:function(){var t=this.data.data;return t&&t.totalCount||0}},methods:{goToAgentPage:function(t){var e={agentId:t.agentId,instanceTab:t.instanceTab||"process"};"process"===e.instanceTab&&(e.selectPid=t.pid,e.showProcessDetailDrawer=1);var a=this.$router.resolve({path:"/app/"+t.appId+"/agent",query:e}).href;window.open(a,"_blank")}}},Z={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticClass:"alarm-list",staticStyle:{"border-radius":"0px"},attrs:{fullscreen:"",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("告警触发列表")])],1),t._v(" "),a("Row",{staticClass:"info-prompt",staticStyle:{"margin-top":"0px","margin-left":"0px","margin-right":"0px"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("此规则下告警总数为\n        "),a("code",{staticClass:"alert"},[t._v(t._s(t.totalCount))]),t._v(" "),a("span",[t._v("条，默认只展示最近的")]),t._v(" "),a("code",[t._v("100")]),t._v(" "),a("span",[t._v("条告警记录")])],1)],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t.loading?a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{color:"#2db7f5","margin-top":"200px","text-align":"center"},attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Col",{attrs:{span:"24"}},[t.data.ok?a("Row",{staticStyle:{"text-align":"left"}},[a("Col",[a("Table",{attrs:{columns:t.columns,data:t.list},scopedSlots:t._u([{key:"time",fn:function(e){var s=e.row;return[a("span",{staticClass:"time"},[t._v(t._s(s.time))])]}},{key:"contextType",fn:function(e){var s=e.row;return[a("span",{staticClass:"contextType"},[t._v(t._s(s.contextType))])]}},{key:"appId",fn:function(e){var s=e.row;return[a("span",{staticClass:"agent-id"},[t._v("\n                    "+t._s(s.appId)+"\n                    "),s.owner?a("span",[t._v("("+t._s(s.owner)+")")]):t._e()])]}},{key:"agentId",fn:function(e){var s=e.row;return[a("span",{staticClass:"agent-id"},[t._v(t._s(s.agentId))])]}},{key:"expr",fn:function(e){var s=e.row;return[a("span",{staticClass:"expr"},[t._v(t._s(s.expr))])]}},{key:"action",fn:function(e){var s=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{long:"",type:"primary",size:"small"},on:{click:function(e){return t.goToAgentPage(s)}}},[t._v("详细信息页面")])]}}],null,!1,2238840809)})],1)],1):t._e(),t._v(" "),t.data.ok?t._e():a("Row",{staticStyle:{"text-align":"center","margin-top":"100px"}},[a("p",[t._v(t._s(t.data.message))])])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var tt=a("VU/8")(Q,Z,!1,function(t){a("HLmO")},"data-v-653e9a03",null).exports,et={props:["show","loading","cancel","data","rule","removeContactLoading","addContactLoading"],data:function(){return{showModal:!1,memberColumns:[{title:"成员信息",slot:"time"},{title:"操作",slot:"action",align:"center",width:180}],settingColumns:[{title:"成员信息",slot:"time"},{title:"操作",slot:"action",align:"center",width:180}]}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}},computed:{memberList:function(){var t=this.data.data;return t&&Array.isArray(t.settedList)?t.settedList.map(function(t){return p()({},t,{user:t.workId+(t.userName?" ("+t.userName+")":"")})}):[]},settingList:function(){var t=this.data.data;return t&&Array.isArray(t.remainList)?t.remainList.map(function(t){return p()({},t,{user:t.workId+(t.userName?" ("+t.userName+")":"")})}):[]}},methods:{remove:function(t){this.$emit("removeFromContactList",t)},add:function(t){this.$emit("addToContactList",t)}}},at={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"600",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("告警联系人设置")])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[t.loading?a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{color:"#2db7f5","text-align":"center"},attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Col",{attrs:{span:"24"}},[t.data.ok?a("Row",{staticStyle:{"text-align":"left"}},[a("Row",{staticClass:"info-prompt",staticStyle:{"margin-top":"-15px","margin-left":"0px","margin-right":"0px"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("为规则\n                "),a("code",{staticStyle:{color:"#ed4014"}},[t._v(t._s(t.rule))]),t._v(" "),a("span",[t._v("配置告警联系人")])],1)],1),t._v(" "),a("Row",{staticClass:"title"},[t._v("已添加联系人")]),t._v(" "),a("Row",[a("Col",[a("Table",{attrs:{columns:t.memberColumns,data:t.memberList,"no-data-text":"此规则下没有报警联系人"},scopedSlots:t._u([{key:"time",fn:function(e){var s=e.row;return[a("span",{staticClass:"time"},[t._v(t._s(s.user))])]}},{key:"action",fn:function(e){var s=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{ghost:"",long:"",type:"primary",size:"small",loading:t.removeContactLoading},on:{click:function(e){return t.remove(s)}}},[t._v("移出联系人列表")])]}}],null,!1,2428522037)})],1)],1),t._v(" "),a("Row",{staticClass:"title",staticStyle:{"margin-top":"15px"}},[t._v("可添加联系人")]),t._v(" "),a("Row",[a("Col",[a("Table",{attrs:{columns:t.settingColumns,data:t.settingList,"no-data-text":"没有剩余可添加的联系人"},scopedSlots:t._u([{key:"time",fn:function(e){var s=e.row;return[a("span",{staticClass:"time"},[t._v(t._s(s.user))])]}},{key:"action",fn:function(e){var s=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{ghost:"",long:"",type:"primary",size:"small",loading:t.addContactLoading},on:{click:function(e){return t.add(s)}}},[t._v("添加至联系人列表")])]}}],null,!1,3069279356)})],1)],1)],1):t._e(),t._v(" "),t.data.ok?t._e():a("Row",{staticStyle:{"text-align":"center"}},[a("p",[t._v(t._s(t.data.message))])])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var st=a("VU/8")(et,at,!1,function(t){a("lR7k")},"data-v-2cb55360",null).exports,it=p()({data:function(){return{appId:"",keySpan:8,valueSpan:16,selectedContextType:"node_log",contextTypeList:[{value:"node_log",label:"XNPP 插件日志"},{value:"system_log",label:"操作系统信息日志"},{value:"error_log",label:"Node.js 错误日志"},{value:"xagent_notification",label:"X-Agent 通知信息"}],selectedPushType:"p3",pushTypeList:[{value:"p1",label:"P1 (致电)"},{value:"p2",label:"P2 (短信)"},{value:"p3",label:"P3 (邮件)"},{value:"p4",label:"P4 (数据记录)"}],selectedPreSettedRules:"",preSettedRules:[{value:"fast_rule_memory",label:"进程 Memory 使用率预警"},{value:"fast_rule_cpu",label:"进程 CPU 使用率预警"},{value:"fast_rule_os_memory",label:"系统 Memory 使用率预警"},{value:"fast_rule_os_cpu",label:"系统 CPU 使用率预警"},{value:"fast_rule_disk_usage",label:"磁盘使用率预警"},{value:"fast_rule_error_log_content",label:"特定错误日志预警"},{value:"fast_rule_expired_request",label:"慢响应预警 (超过 30s)"},{value:"fast_rule_illegal_request",label:"异常请求预警 (4xx 5xx 占比过高)"},{value:"fast_rule_node_process_exit",label:"Node.js 进程退出预警"},{value:"fast_rule_dependence_security_risk",label:"Npm 安全漏洞预警"}],dsl:"",expr:"",settedRuleColumn:[{title:"推送级别",slot:"pushType",width:130},{title:"上下文类型",slot:"contextType",width:150},{title:"阈值表达式",slot:"dsl",width:260},{title:"告警消息内容",slot:"expr"},{title:"已有告警",slot:"alarmList",width:100},{title:"操作",slot:"action",width:175}],settedRuleList:[],addRuleLoading:!1,userRulesLoading:!1,showAlarmListModal:!1,alarmListModalLoading:!1,alarmListData:{},showAlarmMemberSettingModal:!1,alarmMemberSettingModalLoading:!1,alarmMemberSettingData:{},alarmMemberSettingRule:"",removeContactLoading:!1,addContactLoading:!1,ruleEditData:null,updateRuleLoading:!1}},props:["appName","globalRule"],components:{"x-alarm-list":tt,"x-alarm-member-setting":st},created:function(){this.appId=this.$route.params.appId,this.getRuleList()},mounted:function(){var t=this.$route.query;t.showAlarmListModal&&t.strategyId&&this.showAlarmList({strategyId:t.strategyId})}},J),ot={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      "+t._s(t.appName)+"\n      > 运维报警\n    ")])],1),t._v(" "),a("Row",{ref:"configureRule",staticClass:"info-divider"}),t._v(" "),a("Row",{staticClass:"info-prompt",staticStyle:{"margin-top":"-10px"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("目前开放了配置告警判定上下文为\n      "),a("code",{staticClass:"alert"},[t._v("XNPP 插件日志")]),t._v(" /\n      "),a("code",{staticClass:"alert"},[t._v("OS 信息日志")]),t._v(" /\n      "),a("code",{staticClass:"alert"},[t._v("X-Agent 通知信息")]),t._v(" 以及\n      "),a("code",{staticClass:"alert"},[t._v("Node.js 错误日志")]),t._v(" 四大类告警规则\n    ")],1)],1),t._v(" "),a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",{staticStyle:{"margin-left":"20px"}},[a("Tag",{attrs:{color:"primary",size:"large"}},[t._v("配置告警项")])],1)],1),t._v(" "),a("Row",[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span",[t._v("判定上下文类型")])]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[a("Select",{staticStyle:{width:"260px"},model:{value:t.selectedContextType,callback:function(e){t.selectedContextType=e},expression:"selectedContextType"}},t._l(t.contextTypeList,function(e){return a("Option",{key:e.value,attrs:{value:e.value,disabled:e.disabled}},[t._v(t._s(e.label))])}),1)],1)],1),t._v(" "),a("Row",{staticClass:"line"},[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span",[t._v("消息推送级别")])]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[a("Select",{staticStyle:{width:"260px"},model:{value:t.selectedPushType,callback:function(e){t.selectedPushType=e},expression:"selectedPushType"}},t._l(t.pushTypeList,function(e){return a("Option",{key:e.value,attrs:{value:e.value,disabled:e.disabled}},[t._v(t._s(e.label))])}),1)],1)],1),t._v(" "),a("Row",{staticClass:"line pre-setted-rules"},[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span",[t._v("预设规则列表")])]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[a("Select",{staticStyle:{width:"500px"},attrs:{clearable:"",placeholder:"自定义规则"},on:{"on-change":t.updateFastRule},model:{value:t.selectedPreSettedRules,callback:function(e){t.selectedPreSettedRules=e},expression:"selectedPreSettedRules"}},t._l(t.preSettedRules,function(e){return a("Option",{key:e.value,attrs:{value:e.value,disabled:e.disabled}},[t._v(t._s(e.label))])}),1)],1)],1),t._v(" "),a("Row",{staticClass:"line"},[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span",[t._v("自定义阈值表达式")])]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[a("Input",{staticStyle:{width:"500px"},attrs:{clearable:"",placeholder:"eg. @cpu_60 > 90"},model:{value:t.dsl,callback:function(e){t.dsl=e},expression:"dsl"}})],1)],1),t._v(" "),a("Row",{staticClass:"line"},[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span",[t._v("告警消息内容")])]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[a("Input",{staticStyle:{width:"500px"},attrs:{clearable:"",placeholder:"实例 ${@agent_id} 上的进程 ${@pid} CPU 使用率超过 90%，为 ${@cpu_60}%"},model:{value:t.expr,callback:function(e){t.expr=e},expression:"expr"}})],1)],1),t._v(" "),a("Row",{staticClass:"line"},[a("Col",{staticClass:"alarm-key",attrs:{span:t.keySpan}},[a("span")]),t._v(" "),a("Col",{staticClass:"alarm-value",attrs:{span:t.valueSpan}},[t.shouldShowUpdate?t._e():a("Button",{attrs:{type:"info",loading:t.addRuleLoading},on:{click:t.addRule}},[t._v("添加告警项")]),t._v(" "),t.shouldShowUpdate?a("Button",{attrs:{ghost:"",type:"info"},on:{click:t.cancelUpdateRule}},[t._v("取消")]):t._e(),t._v(" "),t.shouldShowUpdate?a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"info",loading:t.updateRuleLoading},on:{click:t.updateRule}},[t._v("更新告警项")]):t._e()],1)],1),t._v(" "),a("Row",{staticClass:"info-divider",staticStyle:{"margin-top":"40px"}}),t._v(" "),a("Row",{staticStyle:{"margin-top":"-12px"},attrs:{type:"flex",justify:"start"}},[a("Col",{staticStyle:{"margin-left":"20px"}},[a("Tag",{attrs:{color:"primary",size:"large"}},[t._v("已配置列表")])],1)],1),t._v(" "),a("Row",{staticClass:"setted-rules"},[t.userRulesLoading?a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"50px"}},[a("Spin")],1)],1):t._e(),t._v(" "),t.userRulesLoading?t._e():a("Col",[a("Table",{attrs:{columns:t.settedRuleColumn,data:t.settedRuleList,"no-data-text":"暂无告警配置"},scopedSlots:t._u([{key:"pushType",fn:function(e){var s=e.row;return[1===s.status?a("span",{staticClass:"title"},[t._v(t._s(t.getPushType(s.pushType)))]):t._e(),t._v(" "),1!==s.status?a("span",{staticClass:"title disabled"},[t._v(t._s(t.getPushType(s.pushType)))]):t._e()]}},{key:"contextType",fn:function(e){var s=e.row;return[1===s.status?a("span",{staticClass:"title"},[t._v(t._s(t.getContextType(s.contextType)))]):t._e(),t._v(" "),1!==s.status?a("span",{staticClass:"title disabled"},[t._v(t._s(t.getContextType(s.contextType)))]):t._e()]}},{key:"dsl",fn:function(e){var s=e.row;return[1===s.status?a("span",{staticClass:"express"},[t._v(t._s(s.dsl))]):t._e(),t._v(" "),1!==s.status?a("span",{staticClass:"express disabled"},[t._v(t._s(s.dsl))]):t._e()]}},{key:"expr",fn:function(e){var s=e.row;return[1===s.status?a("span",{staticClass:"express"},[t._v(t._s(s.expr))]):t._e(),t._v(" "),1!==s.status?a("span",{staticClass:"express disabled"},[t._v(t._s(s.expr))]):t._e()]}},{key:"alarmList",fn:function(e){var s=e.row;return[1===s.status?a("Badge",{attrs:{count:s.count,"overflow-count":"999"}},[a("Button",{attrs:{type:"primary",ghost:"",size:"small"},on:{click:function(e){return t.showAlarmList(s)}}},[t._v("告警列表")])],1):t._e(),t._v(" "),1!==s.status?a("Button",{attrs:{type:"primary",ghost:"",size:"small",disabled:""},on:{click:function(e){return t.showAlarmList(s)}}},[t._v("告警列表")]):t._e()]}},{key:"action",fn:function(e){var s=e.row;return[1===s.status?a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",ghost:"",size:"small"},on:{click:function(e){return t.showMemberSetting(s)}}},[t._v("联系人设置")]):t._e(),t._v(" "),1!==s.status?a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",ghost:"",size:"small",disabled:""},on:{click:function(e){return t.showMemberSetting(s)}}},[t._v("联系人设置")]):t._e(),t._v(" "),1===s.status?a("Dropdown",{staticStyle:{"text-align":"center","margin-left":"10px"},on:{"on-click":t.selectMoreAction}},[a("a",{attrs:{href:"javascript:void(0)"}},[t._v("\n              更多\n              "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:JSON.stringify({row:s,action:"edit"})}},[t._v("编辑")]),t._v(" "),a("DropdownItem",{attrs:{name:JSON.stringify({row:s,action:"disable"})}},[t._v("禁用")]),t._v(" "),a("DropdownItem",{attrs:{name:JSON.stringify({row:s,action:"delete"})}},[t._v("删除")])],1)],1):t._e(),t._v(" "),1!==s.status?a("Button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:function(e){return t.updateRuleStatus(s,1)}}},[t._v("启用")]):t._e()]}}],null,!1,1441721335)})],1)],1),t._v(" "),a("x-alarm-list",{attrs:{show:t.showAlarmListModal,loading:t.alarmListModalLoading,cancel:function(){t.showAlarmListModal=!1},data:t.alarmListData,"get-context-type":t.getContextType},on:{modalStatusChanged:t.updateAlarmListModalStatus}}),t._v(" "),a("x-alarm-member-setting",{attrs:{show:t.showAlarmMemberSettingModal,loading:t.alarmMemberSettingModalLoading,"remove-contact-loading":t.removeContactLoading,"add-contact-loading":t.addContactLoading,cancel:function(){t.showAlarmMemberSettingModal=!1},data:t.alarmMemberSettingData,rule:t.alarmMemberSettingRule},on:{modalStatusChanged:t.updateAlarmMemberSettingModalStatus,removeFromContactList:t.removeFromContactList,addToContactList:t.addToContactList}})],1)},staticRenderFns:[]};var nt=a("VU/8")(it,ot,!1,function(t){a("MLrj")},"data-v-1012cdc4",null).exports,rt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"560",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v(t._s(t.title))])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"25px","margin-bottom":"15px","text-align":"center"},domProps:{innerHTML:t._s(t.body)}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.loading},on:{click:t.confirm}},[t._v("确认")])],1)])],1)},staticRenderFns:[]},lt=a("VU/8")({props:["show","loading","title","body","cancel","confirm"],data:function(){return{showModal:!1}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}}},rt,!1,null,null,null).exports,ct={methods:{getMembers:function(){var t=this;u.a.get("/api/members",{params:{appId:this.appId}}).then(function(e){(e=e.data).ok?(e=e.data,Array.isArray(e.list)?t.members=e.list:t.members=[]):f.call(t,e.message||"获取应用成员列表失败！",e.code)}).catch(function(e){return f.call(t,"获取应用成员列表失败！ "+e,e.code)})},submitInvitationCancel:function(){var t=this;this.cancelInvitationModalLoading=!0,u()({method:"DELETE",url:"/api/member/invitation",headers:{"x-csrf-token":m()},data:this.cancelInvitationData}).then(function(e){(e=e.data).ok?t.getMembers():f.call(t,e.message||"撤回邀请失败，请重试！",e.code),t.showCancelInvitationModal=!1,t.cancelInvitationModalLoading=!1}).catch(function(e){f.call(t,"撤回邀请失败，请重试！ "+e,e.code),t.showCancelInvitationModal=!1,t.cancelInvitationModalLoading=!1})},updateCancelInvitationModalStatus:function(t){this.showCancelInvitationModal=t},invite:function(){if(!this.invitedWorkId)return this.$Message.error("用户 ID 不能为空！"),void(this.invitedWorkId="");this.showInviteModal=!0},updateInvitation:function(t){this.showInviteModal=t},submitInvitation:function(){var t=this;this.inviteModalLoading=!0,u()({method:"POST",url:"/api/member/invitation",headers:{"x-csrf-token":m()},data:{appId:this.appId,workId:this.invitedWorkId}}).then(function(e){(e=e.data).ok?t.getMembers():f.call(t,e.message||"邀请成员失败，请重试！",e.code),t.showInviteModal=!1,t.inviteModalLoading=!1,t.invitedWorkId=""}).catch(function(e){f.call(t,"邀请成员失败，请重试！ "+e,e.code),t.showInviteModal=!1,t.inviteModalLoading=!1})},submitTransferOwnerShip:function(){var t=this;this.transferOwnerShipModalLoading=!0,u()({method:"POST",url:"/api/member/ownership",headers:{"x-csrf-token":m()},data:this.transferOwnerShipData}).then(function(e){(e=e.data).ok?t.getMembers():f.call(t,e.message||"转交失败，请重试！",e.code),t.showTransferOwnerShipModal=!1,t.transferOwnerShipModalLoading=!1}).catch(function(e){f.call(t,"转交失败，请重试！ "+e,e.code),t.showTransferOwnerShipModal=!1,t.transferOwnerShipModalLoading=!1})},updateTransferOwnerShipModalStatus:function(t){this.showTransferOwnerShipModal=t},submitRemoveMember:function(){var t=this;this.removeMemberModalLoading=!0,u()({method:"DELETE",url:"/api/team/member",headers:{"x-csrf-token":m()},data:this.removeMemberData}).then(function(e){(e=e.data).ok?t.getMembers():f.call(t,e.message||"移除失败，请重试！",e.code),t.showRemoveMemberModal=!1,t.removeMemberModalLoading=!1}).catch(function(e){f.call(t,"移除失败，请重试！ "+e,e.code),t.showRemoveMemberModal=!1,t.removeMemberModalLoading=!1})},updateRemoveMemberModalStatus:function(t){this.showRemoveMemberModal=t},submitLeaveTeam:function(){var t=this;this.leaveTeamModalLoading=!0,u()({method:"DELETE",url:"/api/member",headers:{"x-csrf-token":m()},data:this.leaveTeamData}).then(function(e){(e=e.data).ok?window.location.href="/":f.call(t,e.message||"离开失败，请重试！",e.code),t.showLeaveTeamModal=!1,t.leaveTeamModalLoading=!1}).catch(function(e){f.call(t,"离开失败，请重试！ "+e,e.code),t.showLeaveTeamModal=!1,t.leaveTeamModalLoading=!1})},updateLeaveTeamModalStatus:function(t){this.showLeaveTeamModal=t}}},pt=p()({data:function(){var t=this;return{appId:"",title:[{title:"成员信息",key:"workId",render:function(t,e){var a=e.row.userName,s=e.row.workId;return t("div",[t("span",a?s+" ("+a+")":s)])}},{title:"当前状态",key:"status",render:function(t,e){var a=e.row.status,s="未知";return 0===a&&(s="管理员"),1===a&&(s="邀请中"),2===a&&(s="已加入"),t("div",[t("span",{style:{marginLeft:"1px"}},s)])}},{title:"加入时间",key:"joinedTime"},{title:"可执行的操作",key:"action",width:190,render:function(e,a){return 0===a.row.owner?a.row.currentUser===a.row.workId?e("div",[e("Button",{props:{type:"warning",size:"small"},style:{marginLeft:"5px"},on:{click:function(){t.showLeaveTeamModal=!0,t.leaveTeamData={appId:t.appId,workId:a.row.workId}}}},"离开团队")]):void 0:a.row.currentUser!==a.row.workId?1===a.row.status?e("div",[e("Button",{props:{type:"warning",size:"small"},style:{width:"64px"},on:{click:function(){t.showCancelInvitationModal=!0,t.cancelInvitationData={appId:t.appId,workId:a.row.workId}}}},"撤回邀请")]):e("div",[e("Button",{props:{type:"primary",size:"small"},style:{marginRight:"10px"},on:{click:function(){t.showTransferOwnerShipModal=!0,t.transferOwnerShipData={appId:t.appId,workId:a.row.workId}}}},"转交权限"),e("Button",{props:{type:"error",size:"small"},on:{click:function(){t.showRemoveMemberModal=!0,t.removeMemberData={appId:t.appId,workId:a.row.workId}}}},"移除成员")]):void 0}}],members:[],showInviteModal:!1,inviteModalLoading:!1,invitedWorkId:"",showCancelInvitationModal:!1,cancelInvitationModalLoading:!1,cancelInvitationData:null,showTransferOwnerShipModal:!1,transferOwnerShipModalLoading:!1,transferOwnerShipData:null,showRemoveMemberModal:!1,removeMemberModalLoading:!1,removeMemberData:null,showLeaveTeamModal:!1,leaveTeamModalLoading:!1,leaveTeamData:null}},props:["appName"],components:{"x-normal-modal":lt},created:function(){this.appId=this.$route.params.appId,this.getMembers()}},ct),dt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      "+t._s(t.appName)+"\n      > 团队协作\n    ")])],1),t._v(" "),a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{staticClass:"info-prompt",staticStyle:{"margin-top":"-10px"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("您可以在这里将本应用授权给其他同学，团队成员可以查看完整的监控数据以及生成的性能文件，进而一起对 Node.js 的应用故障进行排查和定位\n    ")],1)],1),t._v(" "),a("Row",{staticClass:"add-member"},[a("Col",{attrs:{span:"6"}},[a("Input",{attrs:{placeholder:"请输入用户 ID"},model:{value:t.invitedWorkId,callback:function(e){t.invitedWorkId=e},expression:"invitedWorkId"}},[a("span",{attrs:{slot:"prepend"},slot:"prepend"},[t._v("添加新成员")])])],1),t._v(" "),a("Col",{staticClass:"member-confirm",attrs:{span:"2"}},[a("Button",{attrs:{type:"info"},on:{click:t.invite}},[t._v("确认")])],1)],1),t._v(" "),a("Row",{staticClass:"show-member"},[a("Table",{attrs:{"no-data-text":"暂无成员",columns:t.title,data:t.members}})],1),t._v(" "),a("x-normal-modal",{attrs:{show:t.showInviteModal,loading:t.inviteModalLoading,title:"邀请成员",body:"确认邀请成员 <span style='font-weight:bold'>"+t.invitedWorkId+"</span> 至本应用，请注意这里需要输入正确的用户 ID",cancel:function(){t.showInviteModal=!1},confirm:t.submitInvitation},on:{modalStatusChanged:t.updateInvitation}}),t._v(" "),a("x-normal-modal",{attrs:{show:t.showCancelInvitationModal,loading:t.cancelInvitationModalLoading,title:"撤回邀请",body:"<span style='font-weight:bold'>注意：</span>将撤回向此用户的应用授权邀请，撤销后您仍然可以继续邀请此用户加入此应用",cancel:function(){t.showCancelInvitationModal=!1},confirm:t.submitInvitationCancel},on:{modalStatusChanged:t.updateCancelInvitationModalStatus}}),t._v(" "),a("x-normal-modal",{attrs:{show:t.showTransferOwnerShipModal,loading:t.transferOwnerShipModalLoading,title:"转交权限",body:"本应用的管理员权限将转交给用户 <span style='font-weight:bold'>"+(t.transferOwnerShipData&&t.transferOwnerShipData.workId||"")+"</span> ，转交后您将变为本应用的普通成员",cancel:function(){t.showTransferOwnerShipModal=!1},confirm:t.submitTransferOwnerShip},on:{modalStatusChanged:t.updateTransferOwnerShipModalStatus}}),t._v(" "),a("x-normal-modal",{attrs:{show:t.showRemoveMemberModal,loading:t.removeMemberModalLoading,title:"移除成员",body:"将会把成员 <span style='font-weight:bold'>"+(t.removeMemberData&&t.removeMemberData.workId||"")+"</span> 移出本应用，后续如有需要您仍然可以继续邀请此用户加入此应用",cancel:function(){t.showRemoveMemberModal=!1},confirm:t.submitRemoveMember},on:{modalStatusChanged:t.updateRemoveMemberModalStatus}}),t._v(" "),a("x-normal-modal",{attrs:{show:t.showLeaveTeamModal,loading:t.leaveTeamModalLoading,title:"离开团队",body:"将会离开此应用团队，离开后您将无法访问本应用的所有监控数据和生成的性能分析文件",cancel:function(){t.showLeaveTeamModal=!1},confirm:t.submitLeaveTeam},on:{modalStatusChanged:t.updateLeaveTeamModalStatus}})],1)},staticRenderFns:[]};var ut=a("VU/8")(pt,dt,!1,function(t){a("B0C9")},"data-v-75e07ebc",null).exports,ht=a("//Fk"),vt=a.n(ht),ft={methods:{getCsrfToken:function(){return m()},showUploadModal:function(){this.showUploadActivityModal=!0},cancelUpload:function(){this.showUploadActivityModal=!1},resetUploaderStatus:function(){this.selectedType="",this.fileName="",this.file=null,this.coreFileName="",this.coreFile=null,this.executableFileName="",this.executableFile=null},handleUpload:function(t){this.selectedType="",this.fileName="";for(var e=t.name.split("."),a=e[e.length-1],s=0;s<this.activityType.length;s++){this.activityType[s].value===a&&(this.selectedType=a)}return this.selectedType?"core"!==this.selectedType?(this.fileName=t.name,this.file=t):(this.coreFileName=t.name,this.coreFile=t):this.fileName='<span style="color:#ed4014">文件类型 .'+a+" 错误!</span>",!1},handleCoreFileUpload:function(t){this.fileName="";var e=t.name.split("."),a=e[e.length-1];return"core"!==a?this.coreFileName='<span style="color:#ed4014">文件类型 .'+a+" 错误!</span>":(this.coreFileName=t.name,this.coreFile=t),!1},handleExecutableFileUpload:function(t){this.fileName="";var e=t.name.split("."),a=e[e.length-1];return"node"!==a?this.executableFileName='<span style="color:#ed4014">文件类型 .'+a+" 错误!</span>":(this.executableFileName=t.name,this.executableFile=t),!1},submitUploadActivity:function(){var t=this;if(this.file){this.uploading=!0;var e=new FormData;e.append("file",this.file),u()({method:"POST",url:"/api/upload2oss?appId="+this.appId+"&type=activity&fileType="+this.selectedType,headers:{"x-csrf-token":m(),"content-type":"multipart/form-data"},data:e}).then(function(e){(e=e.data).ok?(t.changeFilter("all"),t.getActivityList(),t.resetUploaderStatus()):f.call(t,e.message||"上传文件失败，请重试！",e.code),t.uploading=!1,t.showUploadActivityModal=!1}).catch(function(e){f.call(t,"上传文件失败，请重试！ "+e,e.code),t.uploading=!1,t.showUploadActivityModal=!1})}else this.$Message.error("请选择正确类型的文件！")},submitUploadCoredump:function(){var t=this;if(this.coreFile)if(this.executableFile){var e=[],a="u-"+Math.random().toString(16).substr(2)+"-"+Math.random().toString(16).substr(2),s=new FormData;s.append("file",this.coreFile),e.push(u()({method:"POST",url:"/api/upload2oss?appId="+this.appId+"&type=coredump&id="+a,headers:{"x-csrf-token":m(),"content-type":"multipart/form-data"},data:s}));var i=new FormData;i.append("file",this.executableFile),e.push(u()({method:"POST",url:"/api/upload2oss?appId="+this.appId+"&type=executable&id="+a,headers:{"x-csrf-token":m(),"content-type":"multipart/form-data"},data:i})),this.coreUploading=!0,vt.a.all(e).then(function(e){2===(e=e.map(function(t){return t.data})).length&&e[0].ok&&e[1].ok?(t.changeFilter("all"),t.getActivityList(),t.resetUploaderStatus()):f.call(t,e.message||"上传文件失败，请重试！",e.code),t.coreUploading=!1,t.showUploadActivityModal=!1}).catch(function(e){f.call(t,"上传文件失败，请重试！ "+e,e.code),t.coreUploading=!1,t.showUploadActivityModal=!1})}else this.$Message.error("Coredump 需要上传可执行文件 (.node)！");else this.$Message.error("Coredump 需要上传 Core 文件 (.core)！")},getActivityList:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&(this.filesLoading=!0),u.a.get("/api/file_list",{params:{appId:this.appId,page:t,size:this.pageSize,filterType:a}}).then(function(t){(t=t.data).ok?(t=t.data,Array.isArray(t.list)&&(e.files=t.list,e.checkCreatingFile(),e.fileCount=t.totalCount)):f.call(e,t.message||"获取文件列表失败，请重试！",t.code),e.filesLoading=!1}).catch(function(t){f.call(e,"获取文件列表失败，请重试！ "+t,t.code),e.filesLoading=!1})},changePage:function(t){this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{currentPage:t})}),this.currentPage=t,this.getActivityList(t,this.selectedFilterType)},favor:function(t,e){var a=this;this.$set(this.loadingObject,e,!0),u()({method:"POST",url:"/api/file_favor",headers:{"x-csrf-token":m()},data:{fileType:t.fileType,fileId:t.fileId,favor:0===t.favor?1:0}}).then(function(t){(t=t.data).ok?a.getActivityList(a.currentPage,a.selectedFilterType,!1):f.call(a,t.message||"收藏/取消收藏失败，请重试！",t.code),a.$set(a.loadingObject,e,!1)}).catch(function(t){f.call(a,"收藏/取消收藏失败，请重试！ "+t,t.code),a.$set(a.loadingObject,e,!1)})},delete:function(t,e){this.deleteLoadingKey=e,this.deleteData=t,this.showDeletionModal=!0},submitDeletion:function(){var t=this;this.showDeletionModal=!1,this.$set(this.loadingObject,this.deleteLoadingKey,!0);u()({method:"DELETE",url:"/api/file",headers:{"x-csrf-token":m()},data:{fileId:this.deleteData.fileId,fileType:this.deleteData.fileType}}).then(function(e){(e=e.data).ok?t.getActivityList(t.currentPage,t.selectedFilterType):f.call(t,e.message||"删除文件失败，请重试！",e.code),t.$set(t.loadingObject,t.deleteLoadingKey,!1)}).catch(function(e){f.call(t,"删除文件失败，请重试！ "+e,e.code),t.$set(t.loadingObject,t.deleteLoadingKey,!1)})},updateDeletion:function(t){this.showDeletionModal=t},handleFileEvent:function(t,e){var a=t.fileType+"::"+t.fileId+"::"+e;if("下载"===e)window.location="/file/download?fileType="+t.fileType+"&fileId="+t.fileId;else if("收藏"===e||"已收藏"===e)this.favor(t,a);else if("删除"===e)this.delete(t,a);else if("转储"===e||"再转储"===e)this.transfer(t,a);else if("X分析"===e)this.analytics(t,a);else if("devtool"===e){var s="";["cpuprofile"].includes(t.fileType)&&(s="js_profiler"),["heapsnapshot","heapprofile"].includes(t.fileType)&&(s="heap_profiler");var i="/dashboard/devtools?"+("fileType="+t.fileType+"&fileId="+t.fileId+"&selectedTab="+s+"&fileName="+t.fileName);window.open(i,"_blank")}},changeFilter:function(t){this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{currentPage:1,filterType:t})}),this.getActivityList(1,t),this.currentPage=1,this.selectedFilterType=t},checkCreatingFile:function(){this.files.some(function(t){return 0===t.status||t.transferring})&&(clearTimeout(this.checkFileListTimer),this.checkFileListTimer=setTimeout(this.getActivityList.bind(this,1,this.selectedFilterType,!1),1e3))},transfer:function(t,e){var a=this;this.$set(this.loadingObject,e,!0),t.transferring=!0,u()({method:"POST",url:"/api/file_transfer",headers:{"x-csrf-token":m()},data:{fileId:t.fileId,fileType:t.fileType}}).then(function(t){(t=t.data).ok||f.call(a,t.message||"转储文件失败，请重试！",t.code,30),a.$set(a.loadingObject,e,!1),a.getActivityList(a.currentPage,a.selectedFilterType,!1)}).catch(function(s){f.call(a,"转储文件失败，请重试！ "+s,s.code),a.$set(a.loadingObject,e,!1),t.transferring=!1})},analytics:function(t,e){var a=this,s="XNPP 分析文件失败，请重试！";this.$set(this.loadingObject,e,!0),u.a.get("/api/file_detail",{params:{fileId:t.fileId,fileType:t.fileType}}).then(function(t){(t=t.data).ok?(t=t.data,a.$emit("xnodeAnalytics",t),clearTimeout(a.checkFileListTimer)):f.call(a,t.message||""+s,t.code),a.$set(a.loadingObject,e,!1)}).catch(function(t){f.call(a,s+" "+t,t.code),a.$set(a.loadingObject,e,!1)})}}},mt=p()({data:function(){var t=this;return{appId:"",showUploadActivityModal:!1,selectedType:"",activityType:[{value:"cpuprofile",label:"CPU 采样"},{value:"heapprofile",label:"Heap 采样"},{value:"gclog",label:"GC 追踪"},{value:"heapsnapshot",label:"堆快照"},{value:"diag",label:"诊断报告"},{value:"core",label:"核心转储"},{value:"trend",label:"进程趋势"}],fileName:"未选择文件",file:null,uploading:!1,coreFileName:"未选择文件",coreFile:null,executableFileName:"未选择文件",executableFile:null,coreUploading:!1,fileCount:0,pageSize:10,currentPage:1,filesLoading:!1,title:[{title:"类型",key:"fileType",align:"center",width:150,render:function(t,e){var a="",s="",i="35px";switch(e.row.fileType){case"cpuprofile":a="ios-bookmarks",s="CPU 采样",i="30px";break;case"heapprofile":a="md-camera",s="Heap 采样",i="30px";break;case"gclog":a="ios-speedometer",s="GC 追踪";break;case"heapsnapshot":a="ios-folder-open",s="堆快照",i="30px";break;case"diag":a="md-medkit",s="诊断报告",i="30px";break;case"core":a="ios-print",s="核心转储";break;case"trend":a="logo-chrome",s="进程趋势",i="30px"}return[t("Row",{style:{marginTop:"12px",marginBottom:"10px"}},[t("Icon",{props:{type:a},style:{fontSize:i,color:"#2d8cf0",marginBottom:"5px"}}),t("div",s)])]}},{title:"文件",key:"fileType",width:450,render:function(t,e){var a=function(e){return t("div",{style:{fontWeight:"bold",fontSize:"14px"}},e)},s=void 0;s="core"===e.row.fileType?a(e.row.coreFile):a(e.row.file);var i=void 0;return i="core"===e.row.fileType?0===e.row.executableStatus?[t("a",{attrs:{href:"/file/download?fileType=executable&fileId="+e.row.fileId}},"可执行文件"),t("span"," 由 "),t("span",{style:{fontWeight:"bold"}},e.row.name),t("span"," ["),t("span",e.row.workId),t("span","]")]:[t("a",{attrs:{href:"javscript:;"}},e.row.executableFile),t("span"," 由 "),t("span",{style:{fontWeight:"bold"}},"操作系统")]:[t("span","由 "),t("span",{style:{fontWeight:"bold"}},e.row.name),t("span"," ["),t("span",e.row.workId),t("span","]")],[t("Row",{style:{marginTop:"13px",marginBottom:"10px"}},[s,t("div",{style:{marginTop:"3px"}},i),t("div",[t("span","于 "),t("span",{style:{fontWeight:"bold"}},e.row.time),t("span"," 创建在实例 "),t("span",{style:{fontWeight:"bold"}},e.row.agent)])])]}},{title:"操作",key:"fileType",render:function(e,a){var s=function(s,i,o,n){var r={success:"#19be6b",primary:"#2d8cf0",disabled:"#c5c8ce",warning:"#ff9900"},l=n?r.disabled:r[s],c=a.row.fileType+"::"+a.row.fileId+"::"+o,p=t.loadingObject[c];return e("div",{style:{textAlign:"center",width:"50px"}},[e("Button",{props:{type:s,shape:"circle",icon:i,disabled:n,loading:p},style:{width:"30px",height:"30px",marginTop:"3px"},on:{click:t.handleFileEvent.bind(t,a.row,o)}}),e("div",{style:{marginTop:"5px",color:l}},o)])},i=function(t){return e("div",{style:{marginTop:"9px",color:{success:"#19be6b",primary:"#2d8cf0",disabled:"#c5c8ce",warning:"#ff9900"}[t]}},"——")},o=["cpuprofile","heapprofile","heapsnapshot"],n=["gclog","diag"],r=[];if("console"===a.row.agent||"trend"===a.row.fileType)r=[s("success","ios-clipboard","已生成"),i("primary")],n.includes(a.row.fileType)&&(r.push(s("primary","md-search","X分析")),r.push(i("primary"))),o.includes(a.row.fileType)&&(r.push(s("primary","md-search","devtool")),r.push(i("primary"))),r.push(s("primary","md-cloud-download","下载")),1===a.row.favor?(r.push(i("warning")),r.push(s("warning","md-star","已收藏"))):(r.push(i("default")),r.push(s("default","md-star","收藏")));else{if(0===a.row.status){var l=a.row.fileType+"::"+a.row.fileId+"::生成中";t.loadingObject[l]=!0,r=[s("success","ios-clipboard","生成中",!0),i("disabled"),s("success","md-cloud-upload","转储",!0),i("disabled")],n.includes(a.row.fileType)&&(r.push(s("primary","md-search","X分析",!0)),r.push(i("disabled"))),o.includes(a.row.fileType)&&(r.push(s("primary","md-search","devtool",!0)),r.push(i("disabled"))),r.push(s("primary","md-cloud-download","下载",!0)),r.push(i("disabled")),r.push(s("default","md-star","收藏",!0))}if(1===a.row.status){if(r=[s("success","ios-clipboard","已生成"),i("success")],a.row.transferring){var c=a.row.fileType+"::"+a.row.fileId+"::转储中";t.loadingObject[c]=!0,r.push(s("success","md-cloud-upload","转储中")),r.push(i("disabled"))}else r.push(s("success","md-cloud-upload","转储")),r.push(i("disabled"));n.includes(a.row.fileType)&&(r.push(s("primary","md-search","X分析",!0)),r.push(i("disabled"))),o.includes(a.row.fileType)&&(r.push(s("primary","md-search","devtool",!0)),r.push(i("disabled"))),r.push(s("primary","md-cloud-download","下载",!0)),r.push(i("disabled")),r.push(s("default","md-star","收藏",!0))}2===a.row.status&&(r=[s("success","ios-clipboard","已生成"),i("success"),s("success","md-cloud-upload","再转储"),i("primary")],n.includes(a.row.fileType)&&(r.push(s("primary","md-search","X分析")),r.push(i("primary"))),o.includes(a.row.fileType)&&(r.push(s("primary","md-search","devtool")),r.push(i("primary"))),r.push(s("primary","md-cloud-download","下载")),1===a.row.favor?(r.push(i("warning")),r.push(s("warning","md-star","已收藏"))):(r.push(i("default")),r.push(s("default","md-star","收藏"))))}return[e("div",{style:{display:"flex"}},r)]}},{title:"删除",key:"fileType",align:"center",width:150,render:function(e,a){var s=a.row.fileType+"::"+a.row.fileId+"::删除";return[e("Row",[e("Col",{style:{textAlign:"center"}},[e("Button",{props:{type:"error",shape:"circle",icon:"md-trash",loading:t.loadingObject[s]},style:{width:"30px",height:"30px",marginTop:"3px"},on:{click:t.handleFileEvent.bind(t,a.row,"删除")}}),e("div",{style:{marginTop:"5px"}},"删除")])])]}}],files:[],loadingObject:{},deleteLoadingKey:"",deleteData:null,showDeletionModal:!1,selectedFilterType:"all",filterType:[{value:"all",label:"全部"},{value:"cpuprofile",label:"CPU 采样"},{value:"heapprofile",label:"Heap 采样"},{value:"gclog",label:"GC 追踪"},{value:"heapsnapshot",label:"堆快照"},{value:"diag",label:"诊断报告"},{value:"core",label:"核心转储"},{value:"trend",label:"进程趋势"},{value:"favor",label:"收藏"}],checkFileListTimer:null}},props:["appName"],components:{"x-normal-modal":lt},created:function(){this.appId=this.$route.params.appId,this.currentPage=Number(this.$route.query.currentPage)||1,this.selectedFilterType=this.$route.query.filterType||"all",this.getActivityList(this.currentPage,this.selectedFilterType)},beforeDestroy:function(){this.checkFileListTimer&&clearTimeout(this.checkFileListTimer)}},ft),gt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      "+t._s(t.appName)+"\n      > 性能文件\n      "),a("Button",{staticClass:"upload",attrs:{type:"primary",icon:"md-cloud-upload",size:"small"},on:{click:t.showUploadModal}},[t._v("上传文件")])],1)],1),t._v(" "),a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{staticClass:"file-filter"},[a("Select",{attrs:{placeholder:"请选择过滤类型"},on:{"on-change":t.changeFilter},model:{value:t.selectedFilterType,callback:function(e){t.selectedFilterType=e},expression:"selectedFilterType"}},t._l(t.filterType,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),t._v(" "),a("Row",{staticClass:"show-files"},[a("Table",{attrs:{"no-data-text":"暂无文件",columns:t.title,data:t.files,loading:t.filesLoading}})],1),t._v(" "),t.files.length?a("Row",{staticClass:"pagination"},[a("Page",{attrs:{total:t.fileCount,"page-size":t.pageSize,current:t.currentPage,size:"small","show-elevator":""},on:{"on-change":t.changePage}})],1):t._e(),t._v(" "),a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"500",closable:""},model:{value:t.showUploadActivityModal,callback:function(e){t.showUploadActivityModal=e},expression:"showUploadActivityModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("上传文件")])],1),t._v(" "),a("div",{staticStyle:{"margin-top":"15px","margin-bottom":"15px"}},[a("Row",{staticClass:"upload-file",attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"7px","font-size":"13px"},attrs:{span:"4"}},[t._v("文件类型")]),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Select",{attrs:{placeholder:"请选择文件类型"},model:{value:t.selectedType,callback:function(e){t.selectedType=e},expression:"selectedType"}},t._l(t.activityType,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1)],1),t._v(" "),a("br"),t._v(" "),"core"!==t.selectedType?a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"7px","font-size":"13px"},attrs:{span:"4"}},[t._v("选择文件")]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Upload",{attrs:{"before-upload":t.handleUpload,action:""}},[a("Button",{attrs:{type:"primary",icon:"md-cloud-upload"}},[t._v("选择文件")])],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"7px"},attrs:{span:"6"},domProps:{innerHTML:t._s(t.fileName)}})],1):t._e(),t._v(" "),"core"===t.selectedType?a("div",[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"7px","font-size":"13px"},attrs:{span:"4"}},[t._v("核心转储")]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Upload",{attrs:{"before-upload":t.handleCoreFileUpload,action:""}},[a("Button",{attrs:{type:"primary",icon:"md-cloud-upload"}},[t._v("选择文件")])],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"7px"},attrs:{span:"6"},domProps:{innerHTML:t._s(t.coreFileName)}})],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"7px","font-size":"13px"},attrs:{span:"4"}},[t._v("执行文件")]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Upload",{attrs:{"before-upload":t.handleExecutableFileUpload,action:""}},[a("Button",{attrs:{type:"primary",icon:"md-cloud-upload"}},[t._v("选择文件")])],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"7px"},attrs:{span:"6"},domProps:{innerHTML:t._s(t.executableFileName)}})],1)],1):t._e()],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancelUpload}},[t._v("取消")]),t._v(" "),"core"!==t.selectedType?a("Button",{attrs:{type:"primary",loading:t.uploading},on:{click:t.submitUploadActivity}},[t._v("上传")]):t._e(),t._v(" "),"core"===t.selectedType?a("Button",{attrs:{type:"primary",loading:t.coreUploading},on:{click:t.submitUploadCoredump}},[t._v("上传")]):t._e()],1)]),t._v(" "),a("x-normal-modal",{attrs:{show:t.showDeletionModal,loading:!1,title:"删除文件",body:"确定删除文件 <span style='font-weight:bold'>"+(t.deleteData&&(t.deleteData.file||t.deleteData.coreFile))+"</span>?",cancel:function(){t.showDeletionModal=!1},confirm:t.submitDeletion},on:{modalStatusChanged:t.updateDeletion}})],1)},staticRenderFns:[]};var yt=a("VU/8")(mt,gt,!1,function(t){a("D9xM")},"data-v-4a7d31f0",null).exports,_t={methods:{getAgentList:function(){var t=this,e="获取应用实例列表，请刷新页面重试！";u.a.get("/api/app/agent_list",{params:{appId:this.appId}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.list)&&(t.agentList=a.list,a.list.length&&!t.selectedAgent&&(t.selectedAgent=a.list[0].value))):f.call(t,a.message||""+e,a.code),t.agentLoading=!1}).catch(function(a){t.agentLoading=!1,f.call(t,e+" "+a,a.code)})},updateCheckOSModalStatus:function(t){this.showCheckOSModal=t},checkInstance:function(){var t=this;this.showCheckOSModal=!0,this.checkOSModalLoading=!0;u.a.get("/api/app/agent_info",{params:{appId:this.appId,agentId:this.selectedAgent}}).then(function(e){e=e.data,t.checkOSData=e,t.checkOSModalLoading=!1}).catch(function(e){t.checkOSData={ok:!1,message:"获取实例详情失败，请重试！ "+e},t.checkOSModalLoading=!1})},updateCheckInstanceDisabled:function(t){this.checkInstanceDisabled=t}},watch:{selectedAgent:function(){this.selectedAgent!==this.$route.query.agentId&&this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{agentId:this.selectedAgent,selectPid:void 0})})},instanceTab:function(){this.$route.query.instanceTab!==this.instanceTab&&this.$router.push({path:this.$route.path,query:{instanceTab:this.instanceTab,agentId:this.$route.query.agentId}})},agentList:function(){this.checkInstanceDisabled=0===this.agentList.length}}},wt=[["#9B59B6","rgb(155, 89, 182, 0.4)"],["#3498DB","rgb(52, 152, 219, 0.4)"],["#2d8cf0","rgb(45, 140, 240, 0.4)"],["#16A085","rgb(22, 160, 133, 0.4)"],["#E67E22","rgb(230, 126, 34, 0.4)"],["#D35400","rgb(211, 84, 0, 0.4)"],["#F39C12","rgb(243, 156, 18, 0.4)"],["#F1C40F","rgb(241, 196, 15, 0.4)"],["#2ECC71","rgb(46, 204, 113, 0.4)"],["#27AE60","rgb(39, 174, 96, 0.4)"],["#1ABC9C","rgb(26, 188, 156, 0.4)"],["#2980B9","rgb(41, 128, 185, 0.4)"],["#8E44AD","rgb(142, 68, 173, 0.4)"]],Ct=["#c5c8ce","#CCD1D1"],xt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function bt(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}var kt={methods:{selectProcessAtDropDown:function(t){this.selectPid=t},selectProcess:function(t){var e=this;this.selectPid=t.pid,this.xnodeList.forEach(function(a){if(a.pid===t.pid){a.class+=" select";var s=e.getShadowStyle(t.color[1]);t.style.includes(s)||(t.style+=s)}else{a.class=a.class.replace("select","");var i=e.getShadowStyle(a.color[1]);a.style=a.style.replace(new RegExp(bt(i),"g"),"")}})},getShadowStyle:function(t){return"box-shadow:0 0 0 2px "+t+";"},showTooltip:function(t,e){this.moveTooltip(t,e)},moveTooltip:function(t,e){var a=this.getShadowStyle(t.color[1]);t.style.includes(a)||(t.style+=a);var s=this.$refs[this.agentId+"::"+t.pid][0],i=parseInt(window.getComputedStyle(s).height,10),o=parseInt(window.getComputedStyle(s).width,10),n=parseInt(window.getComputedStyle(this.$refs["process-body"].$el).width,10),r=e.pageX+10+o<n?e.pageX+10:e.pageX-10-o,l=e.pageY>i?e.pageY-(i&&i+10):e.pageY+10;s.style.display="inherit",s.style["z-index"]=9999,s.style.left=r+"px",s.style.top=l+"px"},resetTooltip:function(t){if(this.selectPid!==t.pid){var e=this.getShadowStyle(t.color[1]);t.style=t.style.replace(new RegExp(bt(e),"g"),"")}var a=this.$refs[this.agentId+"::"+t.pid][0];a.style.display="none",a.style["z-index"]=-9999,a.style.left="0px",a.style.top="0px"},getAgentProcesses:function(){return u.a.get("/api/app/agent_process",{params:{appId:this.appId,agentId:this.agentId}}).then(function(t){if((t=t.data).ok)return t.data;throw new Error(t.message||"获取实例进程失败")})},getAgentDetail:function(){return u.a.get("/api/app/agent_detail",{params:{appId:this.appId,agentId:this.agentId}}).then(function(t){if((t=t.data).ok)return t.data;throw new Error(t.message||"获取实例详情失败")})},init:function(){var t=this;this.processDataLoading=!0,this.selectPid=parseInt(this.$route.query.selectPid)||"无",vt.a.all([this.getAgentProcesses(),this.getAgentDetail()]).then(function(e){var a=e[0].processes.reduce(function(t,e){return t[e.pid]=e.command,t},{}),s=e[1];t.xagentConnectedStatus=e[0].xagent,t.$emit("instanceStatus",!t.xagentConnectedStatus),t.processes=e[0].processes,t.processDetails=s.detail,s.timeline.length?("无"===t.selectPid&&(t.selectPid=s.timeline[0].pid),t.processDataUploaded=!0):(t.processDataUploaded=!1,t.selectPid="无");var i=Date.now()-864e5;t.xnodeList=s.timeline.map(function(t,e){var s=t.pid,o=a[s]||"暂无命令信息",n=Math.abs(function(t){for(var e=void 0,a=0;a<t.length;a++)e=v()(31,e)+t.charCodeAt(a)|0;return e}(o)),r=void 0,l={};return a[s]?(r=wt[n%wt.length],new Date(t.create)<=i?l.pre=0:l.pre=(new Date(t.create)-i)/24/3600/1e3*100,Date.now()-new Date(t.update)<18e4?l.after=0:(l.after=(Date.now()-new Date(t.update))/24/3600/1e3*100,l.after>=100&&(l.after=100)),l.active=100-l.pre-l.after):(r=Ct,l={pre:0,active:24,after:0}),{pid:s,class:"line",style:"background:"+r[0]+";",cmd:o,create:t.create,update:t.update,color:r,span:l}});var o=!0,n=!1,r=void 0;try{for(var l,c=K()(t.xnodeList);!(o=(l=c.next()).done);o=!0){var p=l.value;p.pid===t.selectPid&&t.selectProcess(p)}}catch(t){n=!0,r=t}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}var d=new Date,u=!1;t.times=new Array(8).fill("").map(function(){var t=new Date(d-3*(arguments.length<=1?void 0:arguments[1])*3600*1e3),e=t.getHours(),a=e<=12?"AM":"PM";return e=e<10?"0"+e:e,0!==Number(e)&&t.getDate()===d.getDate()||u||(u=!0,e=xt[t.getDay()],a=t.getMonth()+1+"."+t.getDate()),{hour:e,tip:a}}).reverse(),t.cpuMemoryData=t.processDetails.map(function(t){return{pid:t.pid,cpu:t.cpu_60,memory:t.rss/1024/1024}}),t.memoryGcData=t.processDetails.map(function(t){return{pid:t.pid,gc:t.gc_total,memory:t.rss/1024/1024}}),t.processDataLoading=!1}).catch(function(e){f.call(t,"获取实例数据失败，请刷新页面重试！ "+e,e.code),t.processDataLoading=!1})},showProcessList:function(){this.getDrawerWidth(),this.showProcessListDrawer=!0},updateProcessListDrawerStatus:function(t){this.showProcessListDrawer=t},getDrawerWidth:function(){if(this.$refs["process-body"]){var t=window.getComputedStyle(this.$refs["process-body"].$el).width,e=parseInt(t,10);this.drawerWidth=e}},getChardWidth:function(){var t=window.getComputedStyle(this.$refs["main-charts"].$el).width,e=parseInt(t,10);this.scatterWidth=e},updateCheckListModalStatus:function(t){this.showCheckListModal=t},checkProcess:function(t){var e=this;this.showCheckListModal=!0,this.checkListModalLoading=!0;u.a.get("/api/app/agent_process_status",{params:{appId:this.appId,agentId:this.agentId,pid:t.pid}}).then(function(t){t=t.data,e.checkListData=t,e.checkListModalLoading=!1}).catch(function(t){e.checkListData={ok:!1,message:"检查进程信息失败，请重试！ "+t},e.checkListModalLoading=!1})},updateTakeActionModalStatus:function(t){this.showTakeActionModal=t},takeAction:function(t){var e=this;this.showTakeActionModal=!0,this.takeActionModalLoading=!0;u()({method:"POST",url:"/api/app/agent_take_action",headers:{"x-csrf-token":m()},data:{appId:this.appId,agentId:this.agentId,pid:this.selectPid,action:t}}).then(function(t){t=t.data,e.takeActionData=t,e.takeActionModalLoading=!1}).catch(function(t){e.takeActionData={ok:!1,message:"操作失败，请重试！ "+t},e.takeActionModalLoading=!1})},showProcessDetail:function(){this.showProcessDetailDrawer=!0;var t=this.$route.query;parseInt(t.showProcessDetailDrawer)||this.$router.push({path:this.$route.path,query:p()({},t,{showProcessDetailDrawer:1})})},updateProcessDetailDrawerStatus:function(t){this.showProcessDetailDrawer=t;var e=this.$route.query;!t&&parseInt(e.showProcessDetailDrawer)&&this.$router.push({path:this.$route.path,query:p()({},e,{showProcessDetailDrawer:0})})}},watch:{agentId:function(){this.init()},selectPid:function(){this.selectPid!==parseInt(this.$route.query.selectPid)&&this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{selectPid:this.selectPid})});var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;o.pid===this.selectPid&&this.selectProcess(o)}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}}},computed:{processCardStyle:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return"background: "+o.color[0]}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"background: "+Ct[0]},processCmd:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.cmd}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"暂无进程命令信息"},processCreateDay:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.create.split(" ")[0]}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processCreateTime:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.create.split(" ")[1]}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return""},processUpdateDay:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.update.split(" ")[0]}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processUpdateTime:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.xnodeList);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.update.split(" ")[1]}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return""},processCpuUsage:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.cpu_60.toFixed(2)+" %"}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processMemoryUsage:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return""+y(o.rss)}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processGcUsage:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return o.gc_total.toFixed(2)+" %"}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processLibuvActiveHandles:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return""+o.active_handles}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}},processTimers:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return""+o.total_timer}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"},processTcpActiveHandles:function(){var t=!0,e=!1,a=void 0;try{for(var s,i=K()(this.processDetails);!(t=(s=i.next()).done);t=!0){var o=s.value;if(o.pid===this.selectPid)return""+o.total_tcp}}catch(t){e=!0,a=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw a}}return"-"}}},St=a("b7ct"),Tt=a.n(St),Lt={data:function(){return{chart:null}},props:{charData:{type:Array,default:function(){return{data:[]}}},id:String,width:Number},mounted:function(){this.drawChart()},watch:{charData:function(t,e){this.chart?(this.chart.source(this.charData),this.chart.render()):this.drawChart()},width:function(t,e){this.chart?(this.chart.source(this.charData),this.chart.render()):this.drawChart()}},methods:{drawChart:function(){this.width&&(this.chart=new Tt.a.Chart({container:this.id,width:this.width,height:400}),this.chart.source(this.charData),this.chart.tooltip({showTitle:!1,crosshairs:{type:"cross"},itemTpl:'<li data-index={index} style="margin-bottom:4px;text-align:left"><span style="background-color:{color};" class="g2-tooltip-marker"></span>pid: {pid}<br/><span style="background-color:{color};" class="g2-tooltip-marker"></span>cpu: {cpu}, <span style="background-color:{color};" class="g2-tooltip-marker"></span>memory: {memory}</li>'}),this.chart.point().position("memory*cpu").size(4).shape("circle").opacity(.65).tooltip("pid*memory*cpu",function(t,e,a){return{pid:t,cpu:a+" %",memory:y(1024*e*1024)}}),this.chart.render())}}},It={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{style:"margin-left:"+(this.width/2-130)+"px"},[this._v("X轴: RSS / MB, Y轴: CPU / %")]),this._v(" "),e("div",{staticStyle:{"margin-left":"-65px"},attrs:{id:this.id}})])},staticRenderFns:[]},Dt=a("VU/8")(Lt,It,!1,null,null,null).exports,Rt={data:function(){return{chart:null}},props:{charData:{type:Array,default:function(){return{data:[]}}},id:String,width:Number},mounted:function(){this.drawChart()},watch:{charData:function(t,e){this.chart?(this.chart.source(this.charData),this.chart.render()):this.drawChart()},width:function(t,e){this.chart?(this.chart.source(this.charData),this.chart.render()):this.drawChart()}},methods:{drawChart:function(){this.width&&(this.chart=new Tt.a.Chart({container:this.id,width:this.width,height:400}),this.chart.source(this.charData),this.chart.tooltip({showTitle:!1,crosshairs:{type:"cross"},itemTpl:'<li data-index={index} style="margin-bottom:4px;text-align:left"><span style="background-color:{color};" class="g2-tooltip-marker"></span>pid: {pid}<br/><span style="background-color:{color};" class="g2-tooltip-marker"></span>gc: {gc}, <span style="background-color:{color};" class="g2-tooltip-marker"></span>memory: {memory}</li>'}),this.chart.point().position("memory*gc").size(4).shape("circle").opacity(.65).tooltip("pid*memory*gc",function(t,e,a){return{pid:t,gc:a+" %",memory:y(1024*e*1024)}}),this.chart.render())}}},Mt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{style:"margin-left:"+(this.width/2-55)+"px"},[this._v("X轴: RSS / MB, Y轴: GC / %")]),this._v(" "),e("div",{staticStyle:{"margin-left":"-15px"},attrs:{id:this.id}})])},staticRenderFns:[]},Pt=a("VU/8")(Rt,Mt,!1,null,null,null).exports,At=p()({data:function(){return{status:!1,columns:[{title:"PID",slot:"pid",width:70},{title:"命令",slot:"command"},{title:"操作",slot:"action",width:150}],data:{},loading:!1,error:""}},props:{open:Boolean,width:Number,agentId:String,getAgentProcesses:Function}},{methods:{checkProcess:function(t){this.$emit("checkProcess",t)}},watch:{status:function(){var t=this;this.$emit("drawerStatusUpdated",this.status),this.status&&(this.loading=!0,this.data={},this.error="",this.getAgentProcesses().then(function(e){t.data=e,t.loading=!1}).catch(function(e){t.error=e,t.loading=!1}))},open:function(){this.status=this.open}},computed:{title:function(){return"实例 "+this.agentId+" 下的 Node.js 进程列表"},list:function(){return this.data.processes||[]}}}),jt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Drawer",{attrs:{title:t.title,closable:!1,width:t.width},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[t.loading?a("Col",{attrs:{span:"1"}},[a("Spin",{staticClass:"spin"})],1):t._e(),t._v(" "),t.loading?t._e():a("Col",{attrs:{span:"24"}},[t.error?a("Col",{staticClass:"error"},[a("span",[t._v(t._s(t.error))])]):t._e(),t._v(" "),t.error?t._e():a("Table",{attrs:{columns:t.columns,data:t.list},scopedSlots:t._u([{key:"pid",fn:function(e){var s=e.row;return[a("strong",[t._v(t._s(s.pid))])]}},{key:"command",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.command))])]}},{key:"action",fn:function(e){var s=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.checkProcess(s)}}},[t._v("检查进程")])]}}],null,!1,1444309875)})],1)],1)],1)],1)},staticRenderFns:[]};var Ft=a("VU/8")(At,jt,!1,function(t){a("tXiL")},"data-v-45ca42c3",null).exports,Nt=a("ifQC"),$t=a.n(Nt),zt={data:function(){return{chart:null,colors:["#21618C","#2980B9","#3498DB","#229954","#52BE80","#7D3C98","#A569BD"]}},props:["id","status","fields","chartData","careKey","formatter"],mounted:function(){this.chart||this.drawChart()},beforeDestroy:function(){this.$emit("clearChart",{id:this.id})},watch:{status:function(){this.status&&(this.chart||this.drawChart())},chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint()):this.drawChart())}},methods:{color:function(t){var e=this.fields.indexOf(t);if(e)return this.colors[e%this.colors.length]},drawChart:function(){var t=this;if(this.chartData){var e=(new $t.a.View).source(this.chartData);e.transform({type:"fold",fields:this.fields,key:"type",value:"value"}),this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,height:400,animate:!1}),this.chart.source(e,{min:{type:"time",tickCount:12,mask:"HH:mm",range:[0,1]},value:{min:0,formatter:this.formatter}}),this.chart.tooltip({crosshairs:!0,htmlContent:function(e,a){for(var s='<div style="margin-bottom: 4px;">'+e+"</div>",i='<ul style="margin:0;list-style-type:none;padding:0;">',o=0,n=0;n<a.length;n++){var r=a[n];i+='<li><span style="background-color:'+r.color+';width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px;"></span>'+r.name+'<span style="display:inline-block;float:right;margin-left:30px;">'+(t.showOriginValue?r.point._origin.value:r.value)+"</span></li>",t.careKey.includes(r.name)&&(t.$emit("shouldCareValue",r.value),o+=parseFloat(r.value))}return t.$emit("shouldCareSumValue",o),'<div style="position:absolute;visibility:hidden;z-index:8;transition:cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);background-color: rgba(255, 255, 255, 0.9);box-shadow: 0px 0px 10px #aeaeae;border-radius:3px;color:rgb(87, 87, 87);font-size:12px;font-family:r;line-height:20px;padding:10px 10px 6px 10px;">'+s+(i+="</ul>")+"</div>"}}),this.chart.area().position("min*value").color("type",this.color).opacity(.4),this.chart.line().position("min*value").color("type",this.color).opacity(.8).size(1),this.chart.render(),this.$emit("pushChart",{chart:this.chart,id:this.id}),this.chart.on("plotmove",function(e){var a={x:e.x,y:e.y},s=t.chart.getSnapRecords(a);if(s.length){var i=s[0]._origin.min;t.$emit("plotmove",{min:i})}}),this.chart.on("plotleave",function(){return t.$emit("plotleave")})}}},computed:{showOriginValue:function(){return["process-handle-detail","process-timer-detail","process-tcp-detail"].includes(this.id)}}},Ut={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},Et=a("VU/8")(zt,Ut,!1,null,null,null).exports,Ot={data:function(){return{chart:null,colors:["#21618C","#2980B9","#3498DB","#229954","#52BE80","#7D3C98","#A569BD"]}},props:["id","status","fields","title","position","chartData","percentFormatter","positionFormatter","lableFormatter"],mounted:function(){this.chart||this.drawChart()},watch:{status:function(){this.status&&(this.chart||this.drawChart())},chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint(),this.showBiggestPart()):this.drawChart())}},methods:{color:function(t){var e=this.fields.indexOf(t);if(e)return this.colors[e%this.colors.length]},showBiggestPart:function(){},drawChart:function(){var t=this;this.chartData&&(this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,animate:!1,height:400}),this.chart.source(this.chartData,{percent:{formatter:this.percentFormatter}}),this.chart.coord("theta",{radius:.75,innerRadius:.6}),this.chart.tooltip({showTitle:!1,itemTpl:'<li><span style="background-color:{color};" class="g2-tooltip-marker"></span>{name}: {value}</li>'}),this.interval=this.chart.intervalStack().position(this.position).color(this.title,this.color).label("percent",{formatter:this.lableFormatter}).tooltip(this.title+"*"+this.position,function(e,a){return{name:e,value:t.positionFormatter(a)}}).style({lineWidth:1,stroke:"#fff"}),this.chart.render(),this.showBiggestPart())}}},Bt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},Gt=a("VU/8")(Ot,Bt,!1,null,null,null).exports,Vt=a("fZjL"),Ht=a.n(Vt),qt={methods:{takeAction:function(t){this.$emit("action",t)},getTrends:function(){var t=this,e=[],a=!0,s=!1,i=void 0;try{for(var o,n=K()(["memory","cpu","heap","gc","handle","timer","tcp"]);!(a=(o=n.next()).done);a=!0){var r=o.value;e.push(this.getTrend(r))}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}this.loading=!0,vt.a.all(e).then(function(){t.loading=!1}).catch(function(e){f.call(t,"获取进程详情失败，请重试 "+e,e.code),t.loading=!1})},commonFormatter:function(t){return g(t)},cpuFormatter:function(t){return t+"%"},shouldCareCpuValue:function(t){t=parseFloat(t),this.cpuStatus=t<=60?"healthy":t<=85?"warning":"error"},memoryFormatter:function(t){return y(t)},shouldCareMemoryValue:function(t){var e=t.split(" "),a=e[1],s=e[0];"KB"===a&&(s*=1024),"MB"===a&&(s=1024*s*1024),"GB"===a&&(s=1024*s*1024*1024);var i=s/this.heapLimit*100;this.memortStatus=i<=60?"healthy":i<=85?"warning":"error"},shouldCareGcSumValue:function(t){t=parseFloat(t),this.gcStatus=t<=5?"healthy":t<=15?"warning":"error"},pushChart:function(t){this.charts.push(t)},clearChart:function(t){for(var e=t.id,a=null,s=0;s<this.charts.length;s++)e===this.charts[s].id&&(a=s);null!==a&&this.charts.splice(a,1)},plotmove:function(t){var e=this,a=t.min;this.charts.forEach(function(t){var s=t.chart,i=t.id,o=!0,n=!1,r=void 0;try{for(var l,c=K()(e[i.split("-")[1]+"Trend"]);!(o=(l=c.next()).done);o=!0){var p=l.value;if(p.min===a){var d=Ht()(p).filter(function(t){return"min"!==t});if(d.length){var u=!0,h=!1,v=void 0;try{for(var f,m=K()(d);!(u=(f=m.next()).done);u=!0){var g=f.value,y=s.getXY({min:a,type:g,value:p[g]});if(y.x>0&&y.y>0){if(s.showTooltip(y),"process-heap-detail"===i){var _=s.getSnapRecords(y),w={},C=!0,x=!1,b=void 0;try{for(var k,S=K()(_);!(C=(k=S.next()).done);C=!0){var T=k.value._origin;w[T.type]=T.value}}catch(t){x=!0,b=t}finally{try{!C&&S.return&&S.return()}finally{if(x)throw b}}e.getHeapMemoryDetail(w)}break}}}catch(t){h=!0,v=t}finally{try{!u&&m.return&&m.return()}finally{if(h)throw v}}}}}}catch(t){n=!0,r=t}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}})},plotleave:function(){this.charts.forEach(function(t){var e=t.chart;try{e.hideTooltip()}catch(t){}})},getHeapMemoryDetail:function(t){var e=0,a=Ht()(t).map(function(a){if("min"!==a)return e+=t[a],{space_name:a,size:t[a]}}).filter(function(t){return t}),s=!0,i=!1,o=void 0;try{for(var n,r=K()(a);!(s=(n=r.next()).done);s=!0){var l=n.value;l.percent=(l.size/e*100).toFixed(0)}}catch(t){i=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw o}}this.heapMemoryDetail=a},heapMemoryPieFormatter:function(t,e){var a=e.point.space_name;return(a=a.split("_")[0])+": "+t},getTrend:function(t){var e=this,a="获取 "+t+" trend 信息失败，请重试！";return u.a.get("/api/agent/process_detail",{params:{appId:this.appId,agentId:this.agentId,pid:this.pid,trend:t,duration:this.duration}}).then(function(s){if(!(s=s.data).ok)throw new Error(s.message||""+a);if(s=s.data,Array.isArray(s.trend)){e[t+"Trend"]=s.trend;for(var i=s.trend.length,o=0,n={};Ht()(n).length<=1&&o<i;)o++,n=s.trend[i-o];"heap"===t&&e.getHeapMemoryDetail(n),"memory"===t&&(e.heapLimit=s.heapLimit,e.shouldCareMemoryValue(y(n.heap_total))),"cpu"===t&&e.shouldCareCpuValue(n.cpu_60),"gc"===t&&e.shouldCareGcSumValue(n.scavange_duration+n.marksweep_duration)}})}},computed:{title:function(){return"进程 "+this.pid+" 数据趋势"}},watch:{status:function(){this.$emit("drawerStatusUpdated",this.status),this.status&&this.getTrends()},open:function(){this.status=this.open},duration:function(){this.getTrends()}}},Wt=p()({data:function(){return{status:!1,loading:!1,heapLimit:null,memoryTrend:[],cpuTrend:[],heapTrend:[],gcTrend:[],handleTrend:[],timerTrend:[],tcpTrend:[],heapMemoryDetail:{},cpuStatus:null,memortStatus:null,gcStatus:null,charts:[],duration:"1d"}},props:["open","width","titleStyle","pid","cmd","appId","agentId"],components:{"x-area":Et,"x-pie":Gt},created:function(){this.status=this.open}},qt),Xt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Drawer",{attrs:{title:t.title,closable:!1,width:t.width},model:{value:t.status,callback:function(e){t.status=e},expression:"status"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[t.loading?a("Col",{attrs:{span:"1"}},[a("Spin",{staticClass:"spin"})],1):t._e(),t._v(" "),t.loading?t._e():a("Col",{staticClass:"content",attrs:{span:"24"}},[a("Row",{staticClass:"card-title",style:t.titleStyle,attrs:{gutter:8,type:"flex",align:"middle"}},[a("Col",{attrs:{span:"8"}},[a("Row",{staticClass:"card-pid"},[t._v("PID: "+t._s(t.pid))]),t._v(" "),a("Row",{staticClass:"card-cmd"},[t._v(t._s(t.cmd))])],1),t._v(" "),a("Col",{attrs:{span:"16"}},[a("Row",{attrs:{gutter:8,type:"flex",justify:"center"}},[a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{ghost:"",long:""},on:{click:function(e){return t.takeAction("cpu_profiling")}}},[t._v("CPU Profiling")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{ghost:"",long:""},on:{click:function(e){return t.takeAction("heap_profiling")}}},[t._v("Heap Profiling")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{ghost:"",long:""},on:{click:function(e){return t.takeAction("heapdump")}}},[t._v("堆快照")])],1),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{attrs:{ghost:"",long:""},on:{click:function(e){return t.takeAction("gc_tracing")}}},[t._v("GC 追踪")])],1),t._v(" "),a("Col",{attrs:{span:"5"}},[a("Button",{attrs:{ghost:"",long:""},on:{click:function(e){return t.takeAction("diag_report")}}},[t._v("Node.js 实时诊断报告")])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"cpu-memory"},[a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("堆内存趋势")]),t._v(" "),"healthy"===t.memortStatus?a("div",{staticClass:"status-icon healthy"},[t._v("健康态")]):t._e(),t._v(" "),"healthy"===t.memortStatus?a("div",{staticClass:"status-desc"},[t._v("堆内存使用率在正常范围内 ( 0 - 60% )")]):t._e(),t._v(" "),"warning"===t.memortStatus?a("div",{staticClass:"status-icon warning"},[t._v("警告态")]):t._e(),t._v(" "),"warning"===t.memortStatus?a("div",{staticClass:"status-desc"},[t._v("堆内存使用率偏高 ( 60% - 85% )")]):t._e(),t._v(" "),"error"===t.memortStatus?a("div",{staticClass:"status-icon error"},[t._v("紧急态")]):t._e(),t._v(" "),"error"===t.memortStatus?a("div",{staticClass:"status-desc"},[t._v("堆内存使用率极高 ( 85%+ )")]):t._e()]),t._v(" "),a("x-area",{attrs:{id:"process-memory-detail",status:t.status,fields:["rss","heap_total","heap_used"],"chart-data":t.memoryTrend,formatter:t.memoryFormatter,"care-key":["heap_total"]},on:{shouldCareValue:t.shouldCareMemoryValue,pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("CPU 趋势")]),t._v(" "),"healthy"===t.cpuStatus?a("div",{staticClass:"status-icon healthy"},[t._v("健康态")]):t._e(),t._v(" "),"healthy"===t.cpuStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 CPU 平均使用率在正常范围内 ( 0 - 60% )")]):t._e(),t._v(" "),"warning"===t.cpuStatus?a("div",{staticClass:"status-icon warning"},[t._v("警告态")]):t._e(),t._v(" "),"warning"===t.cpuStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 CPU 平均使用率偏高 ( 60% - 85% )")]):t._e(),t._v(" "),"error"===t.cpuStatus?a("div",{staticClass:"status-icon error"},[t._v("紧急态")]):t._e(),t._v(" "),"error"===t.cpuStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 CPU 平均使用率极高 ( 85%+ )")]):t._e()]),t._v(" "),a("x-area",{attrs:{id:"process-cpu-detail",status:t.status,fields:["cpu_now","cpu_15","cpu_30","cpu_60"],"chart-data":t.cpuTrend,formatter:t.cpuFormatter,"care-key":["cpu_60"]},on:{shouldCareValue:t.shouldCareCpuValue,pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1),t._v(" "),a("Row",{attrs:{gutter:24}},[a("Col",{attrs:{span:"8"}},[a("div",{staticClass:"chart-title status-title"},[t._v("堆空间组成")]),t._v(" "),a("x-pie",{attrs:{id:"process-heap-detail-pie",status:t.status,fields:["new_space","old_space","code_space","map_space","lo_space"],title:"space_name",position:"size","chart-data":t.heapMemoryDetail,"percent-formatter":t.cpuFormatter,"position-formatter":t.memoryFormatter,"lable-formatter":t.heapMemoryPieFormatter}})],1),t._v(" "),a("Col",{attrs:{span:"16"}},[a("div",{staticClass:"chart-title status-title"}),t._v(" "),a("x-area",{attrs:{id:"process-heap-detail",status:t.status,fields:["new_space","old_space","code_space","map_space","lo_space"],"chart-data":t.heapTrend,formatter:t.memoryFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1),t._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("GC 趋势")]),t._v(" "),"healthy"===t.gcStatus?a("div",{staticClass:"status-icon healthy"},[t._v("健康态")]):t._e(),t._v(" "),"healthy"===t.gcStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 GC 平均耗费在正常范围内 ( 0 - 5% )")]):t._e(),t._v(" "),"warning"===t.gcStatus?a("div",{staticClass:"status-icon warning"},[t._v("警告态")]):t._e(),t._v(" "),"warning"===t.gcStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 GC 平均耗费偏高 ( 5% - 15% )")]):t._e(),t._v(" "),"error"===t.gcStatus?a("div",{staticClass:"status-icon error"},[t._v("紧急态")]):t._e(),t._v(" "),"error"===t.gcStatus?a("div",{staticClass:"status-desc"},[t._v("一分钟内 GC 平均耗费极高 ( 15%+ )")]):t._e()]),t._v(" "),a("x-area",{attrs:{id:"process-gc-detail",status:t.status,fields:["scavange_duration","marksweep_duration"],"chart-data":t.gcTrend,formatter:t.cpuFormatter,"care-key":["scavange_duration","marksweep_duration"]},on:{shouldCareSumValue:t.shouldCareGcSumValue,pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("Libuv Active Handles 趋势")])]),t._v(" "),a("x-area",{attrs:{id:"process-handle-detail",status:t.status,fields:["active_handles"],"chart-data":t.handleTrend,formatter:t.commonFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1),t._v(" "),a("Row",[a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("Timer 趋势")])]),t._v(" "),a("x-area",{attrs:{id:"process-timer-detail",status:t.status,fields:["timer_handles_active"],"chart-data":t.timerTrend,formatter:t.commonFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Col",{staticClass:"chart-title"},[a("div",{staticClass:"status-title"},[t._v("TCP 趋势")])]),t._v(" "),a("x-area",{attrs:{id:"process-tcp-detail",status:t.status,fields:["tcp_handles_active"],"chart-data":t.tcpTrend,formatter:t.commonFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var Kt=a("VU/8")(Wt,Xt,!1,function(t){a("xvAY")},"data-v-f7a93152",null).exports,Yt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"500",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("检查进程")])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px","margin-bottom":"5px","text-align":"center"},attrs:{type:"flex",justify:"center"}},[t.loading?a("Row",[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{color:"#2db7f5"},attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Col",{attrs:{span:"24"}},[t.data.ok?a("Row",{staticStyle:{"text-align":"left","font-size":"12px"}},[a("p",{domProps:{innerHTML:t._s(t.xnodeinstallTip)}}),t._v(" "),a("p",{staticStyle:{"margin-top":"1px"},domProps:{innerHTML:t._s(t.xnodeEnableTip)}}),t._v(" "),a("p",{staticStyle:{"margin-top":"1px"},domProps:{innerHTML:t._s(t.xnodeLogDirTip)}}),t._v(" "),a("p",{staticStyle:{"margin-top":"1px"},domProps:{innerHTML:t._s(t.processAdditionalTip)}})]):t._e(),t._v(" "),t.data.ok?t._e():a("Row",[a("p",[t._v(t._s(t.data.message))])])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.loading?a("Button",{attrs:{type:"primary",ghost:"",loading:!0},on:{click:t.cancel}},[t._v("连接实例中...")]):t._e(),t._v(" "),t.loading?t._e():a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var Jt=a("VU/8")({props:["show","loading","cancel","data"],data:function(){return{showModal:!1,secondTitleStyle:"margin-left:6px;"}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}},computed:{xnodeinstallTip:function(){var t="1. 插件 xprofiler 是否安装：";return this.data.data.installXnode?t+="✓":t+="✗",t},xnodeEnableTip:function(){var t="2. 插件 xprofiler 是否启用：";return this.data.data.xnodeVersion?t+="✓":t+="✗",t},xnodeLogDirTip:function(){var t=this.data.data,e=this.secondTitleStyle,a="3. 插件 xprofiler 生成日志目录是否与 x-agent 采集目录一致：";return t.installXnode&&t.xnodeVersion?(t.xnodeLogDir===t.xagentLogDir?a+="✓":a+="✗",a+='<br><span style="'+e+'">- 插件生成日志的目录: '+t.xnodeLogDir+"</span>",a+='<br><span style="'+e+'">- 采集性能日志的目录: '+t.xagentLogDir+"</span>"):a+="✗",a},processAdditionalTip:function(){var t=this.data.data,e="";return t.nodeVersion&&(e="4. 进程 "+t.pid+" 使用的 node.js 版本: v"+t.nodeVersion),t.xnodeVersion&&(e+=", xprofiler 版本: v"+t.xnodeVersion),e}}},Yt,!1,function(t){a("Hpvh")},"data-v-93025ea0",null).exports,Qt={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"560",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("抓取性能数据")])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px","margin-bottom":"5px","text-align":"center"},attrs:{type:"flex",justify:"center"}},[t.loading?a("Row",[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{color:"#2db7f5"},attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Col",{attrs:{span:"24"}},[t.data.ok?a("Row",{staticStyle:{"text-align":"left"}},[a("p",["save_process_data"===t.type?a("span",[t._v("保存过去 24h 进程趋势数据成功，请访问")]):t._e(),t._v(" "),"save_process_data"!==t.type?a("span",[t._v("操作成功，请访问")]):t._e(),t._v(" "),a("router-link",{attrs:{to:{path:"/app/"+t.appId+"/file"},target:"_blank"}},[t._v("文件列表")]),t._v(" "),a("span",[t._v("查看详情")])],1),t._v(" "),"cpu_profiling"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("CPU Profiling 文件路径:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("注意：CPU 采样快照生成需要约 5 分钟，请耐性等待")])])]):t._e(),t._v(" "),"heapdump"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("堆快照文件路径:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("注意：堆快照生成可能需要几秒到几十秒，请耐性等待")])])]):t._e(),t._v(" "),"heap_profiling"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("Heap Profiling 文件路径:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("注意：Heap 采样快照生成需要约 5 分钟，请耐性等待")])])]):t._e(),t._v(" "),"gc_tracing"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("GC Tracing 文件路径:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("注意：GC 追踪文件生成需要约 5 分钟，请耐性等待")])])]):t._e(),t._v(" "),"diag_report"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("诊断报告文件路径:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("注意：诊断报告生成可能需要几秒，请耐性等待")])])]):t._e(),t._v(" "),"save_process_data"===t.type?a("div",[a("p",{staticStyle:{"margin-top":"5px"}},[a("span",[t._v("进程数据已保存至 oss，文件名:")]),t._v(" "),a("span",[t._v(t._s(t.filePath))])])]):t._e()]):t._e(),t._v(" "),t.data.ok?t._e():a("Row",[a("p",[t._v(t._s(t.data.message))])])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.loading?a("Button",{attrs:{type:"primary",ghost:"",loading:!0},on:{click:t.cancel}},[t._v("连接实例中...")]):t._e(),t._v(" "),t.loading?t._e():a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var Zt=a("VU/8")({props:["appId","show","loading","cancel","data"],data:function(){return{showModal:!1}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}},computed:{type:function(){var t=this.data||{},e=(t=t.data||{}).type||"unknown";return e},filePath:function(){var t=this.data||{},e=(t=t.data||{}).file||"unknown";return e}}},Qt,!1,function(t){a("r5+f")},"data-v-f9004f9c",null).exports,te=p()({props:["appId","agentId"],data:function(){return{selectPid:"无",xnodeList:[],times:[],processes:[],processDetails:[],cpuMemoryData:[],memoryGcData:[],scatterWidth:0,showProcessListDrawer:!1,showProcessDetailDrawer:!1,drawerWidth:0,processDataUploaded:!1,processColumns:[{title:"PID",slot:"pid",width:80},{title:"命令",slot:"command"},{title:"操作",slot:"action",width:150}],xagentConnectedStatus:!1,processDataLoading:!1,showCheckListModal:!1,checkListModalLoading:!1,checkListData:{},showTakeActionModal:!1,takeActionModalLoading:!1,takeActionData:{}}},components:{"x-cpu-memory-scatter":Dt,"x-memory-gc-scatter":Pt,"x-process-list":Ft,"x-process-detail":Kt,"x-check-list":Jt,"x-take-action":Zt},created:function(){this.init()},mounted:function(){this.getChardWidth(),this.getDrawerWidth(),window.onresize=this.getDrawerWidth,this.showProcessDetailDrawer=!!parseInt(this.$route.query.showProcessDetailDrawer)}},kt),ee={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("Row",{ref:"process-body"},[a("Row",[a("Col",{attrs:{span:"18"}},[a("Row",[a("Col",{ref:"main-charts",attrs:{span:"12"}})],1)],1)],1),t._v(" "),t.processDataLoading?a("Row",[a("Row",{staticStyle:{"margin-top":"150px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{attrs:{size:"large"}})],1)],1)],1):t._e(),t._v(" "),t.processDataLoading?t._e():a("Row",[t.xagentConnectedStatus?t._e():a("Row",[a("Row",{staticClass:"dashboard-message-tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v(" "),a("span",[t._v("无法连接到此实例，请确认当前实例已安装且启动 x-agent，并正确配置了 appid 和 secret")])],1)],1),t._v(" "),t.xagentConnectedStatus?a("Row",[t.processDataUploaded?t._e():a("Row",{staticStyle:{"margin-bottom":"10px"}},[a("Row",{staticClass:"info-prompt",staticStyle:{"margin-left":"0","margin-right":"0"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("暂无监控数据，可能是当前实例未正确配置 x-agent 的日志目录，如果已确认正确配置 x-agent 日志目录请等待 1min 以初始化上报第一次进程数据\n            ")],1)],1),t._v(" "),a("Row",{staticClass:"agent-process-header"},[t._v("Node.js 进程列表")]),t._v(" "),a("Row",[a("Table",{attrs:{columns:t.processColumns,data:t.processes},scopedSlots:t._u([{key:"pid",fn:function(e){var s=e.row;return[a("strong",[t._v(t._s(s.pid))])]}},{key:"command",fn:function(e){var s=e.row;return[a("span",{staticClass:"agent-process-cmd"},[t._v(t._s(s.command))])]}},{key:"action",fn:function(e){var s=e.row;return[a("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.checkProcess(s)}}},[t._v("检查进程")])]}}],null,!1,2207245517)})],1)],1),t._v(" "),t.processDataUploaded?a("div",{staticClass:"process-content"},[a("div",{staticClass:"process-metrics"},[a("Row",{staticClass:"process-timeline"},[a("Row",{staticClass:"section-header"},[t._v("进程存活时间线")]),t._v(" "),t._l(t.xnodeList,function(e,s){return a("Row",{key:s,attrs:{type:"flex",justify:"end"}},[a("div",{style:0!==s?"width:100%;margin-top: 8px;":"width:100%;"},[a("div",{style:"height:5px;width:"+e.span.pre+"%;background:#c5c8ce;float:left"}),t._v(" "),a("a",{on:{click:function(a){return t.selectProcess(e)},mouseover:function(a){return t.showTooltip(e,a)},mousemove:function(a){return t.showTooltip(e,a)},mouseout:function(a){return t.resetTooltip(e,a)}}},[a("div",{class:e.class,style:"height:5px;width:"+e.span.active+"%;float:left;"+e.style})]),t._v(" "),a("div",{style:"height:5px;width:"+e.span.after+"%;background:#c5c8ce;float:left"})])])}),t._v(" "),a("Row",{staticClass:"process-time"},[t._l(t.times,function(e){return a("Col",{key:e.hour+"."+e.tip,attrs:{span:"3"}},[t._v(t._s(e.hour))])}),t._v(" "),t._l(t.times,function(e,s){return a("Col",{key:s,staticStyle:{"font-size":"10px"},attrs:{span:"3"}},[t._v(t._s(e.tip))])})],2)],2),t._v(" "),a("Row",{staticClass:"process-info-divider"}),t._v(" "),a("Row",{staticStyle:{"text-align":"left"}},[a("Row",{staticClass:"section-header"},[t._v("进程 CPU/Memory/GC 指标分布")]),t._v(" "),a("Row",{staticStyle:{"margin-top":"5px"},attrs:{type:"flex",justify:"start"}},[a("Col",{attrs:{span:"12"}},[a("x-cpu-memory-scatter",{staticStyle:{"margin-left":"20px"},attrs:{"char-data":t.cpuMemoryData,id:"cpuMemory",width:t.scatterWidth}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("x-memory-gc-scatter",{attrs:{"char-data":t.memoryGcData,id:"memoryGc",width:t.scatterWidth}})],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"process-panel"},[a("Row",{attrs:{type:"flex",justify:"end"}},[a("Button",{attrs:{size:"small",icon:"md-search",type:"primary"},on:{click:t.showProcessList}},[t._v("查看运行中的 Node.js 进程")])],1),t._v(" "),a("Row",{staticClass:"process-card",attrs:{type:"flex",justify:"end"}},[a("Col",{attrs:{span:"23"}},[a("Row",{staticClass:"process-card-title",style:t.processCardStyle},[a("Row",[a("Col",{staticClass:"process-card-pid",attrs:{span:"16"}},[t._v("PID: "+t._s(this.selectPid))]),t._v(" "),a("Col",{attrs:{span:"8"}},[a("Dropdown",{on:{"on-click":t.selectProcessAtDropDown}},[a("a",{staticStyle:{color:"white"},attrs:{href:"javascript:void(0)"}},[t._v("\n                          进程列表\n                          "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.xnodeList,function(e,s){return a("DropdownItem",{key:s,attrs:{name:e.pid}},[a("span",{style:"font-weight:bold;color:"+e.color[0]},[a("Icon",{attrs:{type:"md-egg"}})],1),t._v("\n                            "+t._s(e.pid)+"\n                          ")])}),1)],1)],1)],1),t._v(" "),a("div",{staticClass:"process-card-cmd"},[t._v(t._s(t.processCmd))])],1),t._v(" "),a("Row",{staticClass:"process-card-content"},[a("Row",{staticStyle:{"margin-top":"5px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("启动时间")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processCreateDay))]),t._v(" "),a("Row",{staticClass:"process-card-value",staticStyle:{"margin-top":"0px"}},[t._v(t._s(t.processCreateTime))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("更新时间")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processUpdateDay))]),t._v(" "),a("Row",{staticClass:"process-card-value",staticStyle:{"margin-top":"0px"}},[t._v(t._s(t.processUpdateTime))])],1)],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("CPU 使用率")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processCpuUsage))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("内存使用率")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processMemoryUsage))])],1)],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("GC 占比")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processGcUsage))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("UV 存活句柄数 (Ref)")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processLibuvActiveHandles))])],1)],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"15px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("定时器数量")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processTimers))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{staticClass:"process-card-key"},[t._v("TCP 活跃句柄数")]),t._v(" "),a("Row",{staticClass:"process-card-value"},[t._v(t._s(t.processTcpActiveHandles))])],1)],1),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"15px"}},[t._v("进程详细信息")]),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"10px"}},[a("Button",{attrs:{size:"small",type:"success",long:"",ghost:""},on:{click:function(e){return t.checkProcess({pid:t.selectPid})}}},[t._v("获取 Node.js 进程状态")])],1),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"15px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:t.showProcessDetail}},[t._v("进程趋势")])],1)],1)],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"end"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("save_process_data")}}},[t._v("保存数据")])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"15px"}},[t._v("抓取性能数据")]),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"10px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("cpu_profiling")}}},[t._v("CPU Profiling")])],1)],1)],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"end"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("heapdump")}}},[t._v("堆快照")])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"15px"}},[a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"start"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("heap_profiling")}}},[t._v("Heap Profiling")])],1)],1)],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",{attrs:{type:"flex",justify:"end"}},[a("Col",{attrs:{span:"22"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("gc_tracing")}}},[t._v("GC 追踪")])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"action-title",staticStyle:{"margin-top":"15px","margin-bottom":"10px"}},[a("Button",{attrs:{size:"small",type:"success",long:""},on:{click:function(e){return t.takeAction("diag_report")}}},[t._v("Node.js 实时诊断报告")])],1)],1)],1)],1)],1)]):t._e()],1):t._e()],1)],1),t._v(" "),a("x-process-list",{attrs:{open:t.showProcessListDrawer,width:t.drawerWidth,"agent-id":t.agentId,"get-agent-processes":t.getAgentProcesses},on:{drawerStatusUpdated:t.updateProcessListDrawerStatus,checkProcess:t.checkProcess}}),t._v(" "),a("x-process-detail",{attrs:{open:t.showProcessDetailDrawer,width:t.drawerWidth,"title-style":t.processCardStyle,pid:t.selectPid,cmd:t.processCmd,"app-id":t.appId,"agent-id":t.agentId},on:{drawerStatusUpdated:t.updateProcessDetailDrawerStatus,action:t.takeAction}}),t._v(" "),t._l(t.xnodeList,function(e,s){return a("div",{key:s,ref:t.agentId+"::"+e.pid,refInFor:!0,staticClass:"tooltip"},[a("Row",{staticClass:"tip-title",style:"background:"+e.color[0]+";"},[a("Col",[t._v("\n        PID:\n        "),a("span",[t._v(t._s(e.pid))])])],1),t._v(" "),a("Row",{staticClass:"tip-content"},[a("Row",[a("Col",{staticClass:"tip-content-key",attrs:{span:"6"}},[t._v("启动命令：")]),t._v(" "),a("Col",{staticClass:"tip-content-value",attrs:{span:"18"}},[a("span",[t._v(t._s(e.cmd))])])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"3px"}},[a("Col",{staticClass:"tip-content-key",attrs:{span:"6"}},[t._v("创建时间：")]),t._v(" "),a("Col",{staticClass:"tip-content-value",attrs:{span:"18"}},[a("span",[t._v(t._s(e.create))])])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"3px"}},[a("Col",{staticClass:"tip-content-key",attrs:{span:"6"}},[t._v("更新时间：")]),t._v(" "),a("Col",{staticClass:"tip-content-value",attrs:{span:"18"}},[a("span",[t._v(t._s(e.update))])])],1)],1)],1)}),t._v(" "),a("x-check-list",{attrs:{show:t.showCheckListModal,loading:t.checkListModalLoading,cancel:function(){t.showCheckListModal=!1},data:t.checkListData},on:{modalStatusChanged:t.updateCheckListModalStatus}}),t._v(" "),a("x-take-action",{attrs:{"app-id":t.appId,show:t.showTakeActionModal,loading:t.takeActionModalLoading,cancel:function(){t.showTakeActionModal=!1},data:t.takeActionData},on:{modalStatusChanged:t.updateTakeActionModalStatus}})],2)},staticRenderFns:[]};var ae=a("VU/8")(te,ee,!1,function(t){a("wiix")},"data-v-6b205670",null).exports,se=a("z/wH"),ie=a.n(se),oe={data:function(){return{chart:null,colors:{healthy:"#19be6b",warning:"#ff9900",error:"#ed4014"}}},props:{id:String,type:String,value:Number,status:String,title:String},mounted:function(){this.chart||this.drawChart()},methods:{drawChart:function(){ie()("\n        .g2-guide-html {\n          width: 80px;\n          height: 80px;\n          vertical-align: middle;\n          text-align: center;\n          line-height: 0.4\n        }\n\n        .g2-guide-html .title {\n          font-size: 14px;\n          color: #8c8c8c;\n          font-weight: 300;\n          margin-top:30px;\n        }\n\n        .g2-guide-html .value {\n          font-size: 18px;\n          color: #000;\n          font-weight: bold;\n          margin-top:20px;\n        }"),Tt.a.Shape.registerShape("point","pointer",{drawShape:function(t,e){var a=t.points[0],s=this.parsePoint({x:0,y:0}),i=this.parsePoint({x:a.x,y:.9}),o={x:s.x-i.x,y:s.y-i.y},n=Math.sqrt(o.x*o.x+o.y*o.y);o.x*=1/n,o.y*=1/n;var r=-Math.PI/2,l=Math.cos(r)*o.x-Math.sin(r)*o.y,c=Math.sin(r)*o.x+Math.cos(r)*o.y,p=Math.PI/2,d=Math.cos(p)*o.x-Math.sin(p)*o.y,u=Math.sin(p)*o.x+Math.cos(p)*o.y,h=[["M",i.x+1*l,i.y+1*c],["L",s.x+3*l,s.y+3*c],["L",s.x+3*d,s.y+3*u],["L",i.x+1*d,i.y+1*u],["Z"]];return e.addShape("path",{attrs:{path:h,fill:t.color}})}});var t=[{type:this.type,value:Number(this.value)}],e=new Tt.a.Chart({container:this.id,forceFit:!0,height:200,padding:["-30%","0%","0%","0%"]});e.source(t),e.coord("polar",{startAngle:-1.25*Math.PI,endAngle:.25*Math.PI,radius:.6}),e.scale("value",{min:0,max:1,tickInterval:1,nice:!1}),e.axis(!1);var a=this.colors[this.status||"healthy"],s=this.title;e.facet("rect",{fields:["type"],showTitle:!1,eachView:function(t,e){var i=e.data[0];t.point().position("value*1").shape("pointer").color("#d8d8d8").active(!1),t.guide().arc({zIndex:0,top:!1,start:[0,1],end:[1,1],style:{stroke:"#ebedf0",lineWidth:10}}),t.guide().arc({zIndex:1,start:[0,1],end:[i.value,1],style:{stroke:a,lineWidth:10}});var o=parseInt(100*i.value);t.guide().html({position:["50%","75%"],html:"<div"+(s?" title='磁盘: "+s+"'":"")+' class="g2-guide-html"><p class="title">'+i.type+'</p><p class="value">'+o+"%</p></div>"})}}),e.render()}}},ne={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]};var re=a("VU/8")(oe,ne,!1,function(t){a("XFle")},"data-v-47c9fd16",null).exports,le={created:function(){var t=this;this.getSystemOverview().then(function(){return t.getSystemDetail()})},methods:{setOverviewData:function(t,e){w(t[e])&&(this.overviewData[e]=t[e])},setDetailData:function(t,e){Array.isArray(t[e])&&(this.detailData[e]=t[e])},status:function(t){return t<.6?"healthy":t<.85?"warning":"error"},getSystemOverview:function(){var t=this;return this.overviewLoading=!0,u.a.get("/api/app/agent_osinfo_overview",{params:{appId:this.appId,agentId:this.agentId}}).then(function(e){if((e=e.data).ok){if(!(e=e.data))return void(t.hasOsData=!1);t.setOverviewData(e,"cpuUsage"),t.setOverviewData(e,"memUsage"),t.setOverviewData(e,"diskUsage"),t.overviewData.diskMounted=e.diskMounted}else f.call(t,e.message||"获取系统信息概览失败，请重试",e.code);t.overviewLoading=!1}).catch(function(e){f.call(t,"获取系统信息概览失败，请重试 "+e,e.code),t.overviewLoading=!1})},getSystemDetail:function(){var t=this;return this.detailLoading=!0,u.a.get("/api/app/agent_osinfo_detail",{params:{appId:this.appId,agentId:this.agentId}}).then(function(e){(e=e.data).ok?(e=e.data,t.setDetailData(e,"cpuTrend"),t.setDetailData(e,"memTrend"),t.setDetailData(e,"loadTrend"),t.setDetailData(e,"nodeTrend"),t.setDetailData(e,"diskTrend"),t.setDetailData(e,"qpsTrend"),t.setDetailData(e,"responseTrend"),t.setDetailData(e,"rtTrend"),t.setDetailData(e,"expiredTrend"),w(e.totalMem)&&(t.detailData.totalMem=e.totalMem),Array.isArray(e.diskFields)&&(t.detailData.diskFields=e.diskFields),Array.isArray(e.responseFields)&&e.responseFields.length&&(t.detailData.responseFields=e.responseFields)):f.call(t,e.message||"获取系统信息详情失败，请重试",e.code),t.detailLoading=!1}).catch(function(e){f.call(t,"获取系统信息详情失败，请重试 "+e,e.code),t.detailLoading=!1})},cpuFormatter:function(t){return t+"%"},memoryFormatter:function(t){return y(t)},pushChart:function(t){this.charts.push(t)},clearChart:function(t){for(var e=t.id,a=null,s=0;s<this.charts.length;s++)e===this.charts[s].id&&(a=s);null!==a&&this.charts.splice(a,1)},plotmove:function(t){var e=this,a=t.min;this.charts.forEach(function(t){var s=t.chart,i=t.id,o=!0,n=!1,r=void 0;try{for(var l,c=K()(e.detailData[i.split("-")[1]+"Trend"]);!(o=(l=c.next()).done);o=!0){var p=l.value;if(p.min===a){var d=Ht()(p).filter(function(t){return"min"!==t});if(d.length){var u=!0,h=!1,v=void 0;try{for(var f,m=K()(d);!(u=(f=m.next()).done);u=!0){var g=f.value,y=s.getXY({min:a,type:g,value:p[g]});if(y.x>0&&y.y>0){if(s.showTooltip(y),"process-heap-detail"===i){var _=s.getSnapRecords(y),w={},C=!0,x=!1,b=void 0;try{for(var k,S=K()(_);!(C=(k=S.next()).done);C=!0){var T=k.value._origin;w[T.type]=T.value}}catch(t){x=!0,b=t}finally{try{!C&&S.return&&S.return()}finally{if(x)throw b}}e.getHeapMemoryDetail(w)}break}}}catch(t){h=!0,v=t}finally{try{!u&&m.return&&m.return()}finally{if(h)throw v}}}}}}catch(t){n=!0,r=t}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}})},plotleave:function(){this.charts.forEach(function(t){var e=t.chart;try{e.hideTooltip()}catch(t){}})}},watch:{agentId:function(){var t=this;this.hasOsData=!0,this.getSystemOverview().then(function(){return t.getSystemDetail()})}}},ce=p()({data:function(){return{hasOsData:!0,overviewLoading:!1,detailLoading:!1,overviewData:{cpuUsage:0,memUsage:0,diskUsage:0,diskMounted:""},detailData:{cpuTrend:[],memTrend:[],totalMem:0,loadTrend:[],nodeTrend:[],diskTrend:[],diskFields:[],qpsTrend:[],responseFields:["200"],responseTrend:[],rtTrend:[],expiredTrend:[]},charts:[]}},props:["appId","agentId"],components:{"x-dashboard":re,"x-area":Et}},le),pe={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t.hasOsData?a("Row",{staticClass:"content"},[a("Row",{staticClass:"section-header"},[t._v("基本系统信息概览")]),t._v(" "),t.overviewLoading?a("div",{staticStyle:{height:"255px","text-align":"center"},attrs:{type:"flex"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{"padding-top":"100px"},attrs:{size:"large"}})],1)],1)],1):a("Row",[a("Col",{attrs:{span:"8"}},[a("x-dashboard",{attrs:{id:"cpuUsage",type:"CPU 使用率",value:t.overviewData.cpuUsage,status:t.status(t.overviewData.cpuUsage)}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("x-dashboard",{attrs:{id:"memUsage",type:"Mem 使用率",value:t.overviewData.memUsage,status:t.status(t.overviewData.memUsage)}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("x-dashboard",{attrs:{id:"diskUsage",type:"Disk 使用率",value:t.overviewData.diskUsage,status:t.status(t.overviewData.diskUsage),title:t.overviewData.diskMounted}})],1)],1),t._v(" "),a("Row",{staticClass:"section-header"},[t._v("24h 内系统详细数据")]),t._v(" "),t.detailLoading?a("div",{staticStyle:{height:"405px","text-align":"center"},attrs:{type:"flex"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{"padding-top":"150px"},attrs:{size:"large"}})],1)],1)],1):a("Row",[a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("系统 CPU 趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-cpu-detail",status:!1,fields:["os_cpu"],"chart-data":t.detailData.cpuTrend,formatter:t.cpuFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("系统 Memory 趋势 ("+t._s(t.memoryFormatter(t.detailData.totalMem))+")")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-mem-detail",status:!1,fields:["os_mem"],"chart-data":t.detailData.memTrend,formatter:t.cpuFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("系统 Load 负载趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-load-detail",status:!1,fields:["load1","load5","load15"],"chart-data":t.detailData.loadTrend,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("系统 Node.js 进程数趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-node-detail",status:!1,fields:["node_count"],"chart-data":t.detailData.nodeTrend,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"24"}},[a("div",{staticClass:"status-title"},[t._v("系统磁盘使用趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-disk-detail",status:!1,fields:t.detailData.diskFields,"chart-data":t.detailData.diskTrend,formatter:t.cpuFormatter,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("QPS 趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-qps",status:!1,fields:["qps"],"chart-data":t.detailData.qpsTrend,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("HTTP 响应时间趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-rt",status:!1,fields:["rt"],"chart-data":t.detailData.rtTrend,formatter:function(t){return t+"ms"},"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("HTTP 状态码趋势")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-response",status:!1,fields:t.detailData.responseFields,"chart-data":t.detailData.responseTrend,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("div",{staticClass:"status-title"},[t._v("HTTP 响应超时状况 (30s)")]),t._v(" "),a("x-area",{staticClass:"chart",attrs:{id:"osinfo-expired-detail",status:!1,fields:["expired_count"],"chart-data":t.detailData.expiredTrend,"care-key":[]},on:{pushChart:t.pushChart,clearChart:t.clearChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1)],1):a("Row",{staticClass:"content dashboard-message-tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v(" "),a("span",[t._v("项目下暂无 OS 信息，请确认您已正确配置 x-agent 且等待 1min 以初始化上报第一次系统数据")])],1)],1)},staticRenderFns:[]};var de=a("VU/8")(ce,pe,!1,function(t){a("4QtO")},"data-v-633be5a8",null).exports,ue=a("PJh5"),he=a.n(ue),ve={created:function(){this.getErrorLogFiles(),this.selectErrorLog=this.$route.query.selectErrorLog||"",this.currentPage=Number(this.$route.query.currentPage)||1},methods:{formatHtml:function(t){return t?t.split("\n").filter(function(t){return t}):[]},formatErrorLogs:function(t){return t.map(function(t){return{label:t.errorLogFile,value:t.errorLogPath}})},formatErrorLogContent:function(t){var e=this;return t.map(function(t){var a=he()(Number(t.timestamp)).format("YYYY-MM-DD HH:mm:ss").split(" ");return{date:a[0],time:a[1],type:t.type,stack:e.formatHtml(t.stack),extra:e.formatHtml(t.extra)}})},reset:function(){this.loading=!1,this.currentPage=1,this.pageSize=10,this.errorLogLength=0},getErrorLogFiles:function(){var t=this,e="获取 error logs 失败，请重试";return this.fileLoading=!0,u.a.get("/api/app/agent_error_log_files",{params:{appId:this.appId,agentId:this.agentId}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.errorLogFiles)&&(t.errorLogFiles=t.formatErrorLogs(a.errorLogFiles),t.errorLogFiles.length>0&&(t.selectErrorLog=t.errorLogFiles[0].value))):f.call(t,a.message||e,a.code),t.fileLoading=!1}).catch(function(a){f.call(t,e+" "+a,a.code),t.fileLoading=!1})},getErrorLogContent:function(){var t=this,e="获取 error log 详细信息失败，请重试";this.loading=!0,this.errorLogTableContent=[],u.a.get("/api/app/agent_error_log",{params:{appId:this.appId,agentId:this.agentId,errorLogPath:this.selectErrorLog,currentPage:this.currentPage,pageSize:this.pageSize}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.logs)&&(t.errorLogTableContent=t.formatErrorLogContent(a.logs),t.errorLogLength=a.count)):f.call(t,a.message||e,a.code),t.loading=!1}).catch(function(a){f.call(t,e+" "+a,a.code),t.loading=!1})},changeErrorLog:function(t){this.$router.push({path:this.$route.path,query:{agentId:this.agentId,instanceTab:"error",selectErrorLog:t}}),this.reset(),this.selectErrorLog=t},changePage:function(t){this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{currentPage:t})}),this.currentPage=t,this.getErrorLogContent()}},watch:{selectErrorLog:function(){this.getErrorLogContent()},agentId:function(){var t=this;this.getErrorLogFiles().then(function(){return t.getErrorLogContent()})}}},fe=p()({props:["appId","agentId"],data:function(){return{fileLoading:!1,loading:!1,selectErrorLog:"",pageSize:20,currentPage:1,errorLogLength:0,errorLogFiles:[],errorLogTableColumns:[{title:"上报时间",slot:"time",width:120,align:"center"},{title:"错误类型",slot:"type",width:150,align:"center"},{title:"详细错误内容",slot:"error"}],errorLogTableContent:[]}}},ve),me={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("Row",[t.fileLoading?a("Col",[a("Row",{staticStyle:{"margin-top":"200px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{attrs:{size:"large"}})],1)],1)],1):t._e(),t._v(" "),t.fileLoading||0!==t.errorLogFiles.length?t._e():a("Col",[a("Row",{staticClass:"dashboard-message-tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v(" "),a("span",[t._v("项目下暂无错误日志信息，请查看您的 xagent 是否正确配置了 error_log 错误日志文件路径数组")])],1)],1),t._v(" "),t.fileLoading||0===t.errorLogFiles.length?t._e():a("Col",[a("Row",{staticClass:"file-filter"},[a("Select",{attrs:{placeholder:"请选择错误日志"},on:{"on-change":t.changeErrorLog},model:{value:t.selectErrorLog,callback:function(e){t.selectErrorLog=e},expression:"selectErrorLog"}},t._l(t.errorLogFiles,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1)],1),t._v(" "),a("Row",{staticClass:"error-logs"},[a("Table",{attrs:{border:"","disabled-hover":"",stripe:"",loading:t.loading,columns:t.errorLogTableColumns,data:t.errorLogTableContent,"no-data-text":"暂无错误日志信息"},scopedSlots:t._u([{key:"time",fn:function(e){var s=e.row;return[a("div",[a("p",[a("code",[t._v(t._s(s.date))])]),t._v(" "),a("p",{staticStyle:{"margin-top":"5px"}},[a("code",[t._v(t._s(s.time))])])])]}},{key:"type",fn:function(e){var s=e.row;return[a("div",[a("code",[t._v(t._s(s.type))])])]}},{key:"error",fn:function(e){var s=e.row;return[a("div",{staticClass:"error-content"},[t._l(s.stack,function(e,s){return a("p",{key:s},[0===s?a("code",[t._v(t._s(e))]):a("code",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(e))])])}),t._v(" "),s.extra.length?a("div",[a("br"),t._v(" "),t._l(s.extra,function(e,s){return a("p",{key:s},[a("code",[t._v(t._s(e))])])})],2):t._e()],2)]}}],null,!1,3202792477)})],1),t._v(" "),t.errorLogTableContent.length?a("Row",{staticClass:"error-pagination"},[a("Page",{attrs:{total:t.errorLogLength,"page-size":t.pageSize,current:t.currentPage,size:"small","show-elevator":""},on:{"on-change":t.changePage}})],1):t._e()],1)],1)],1)},staticRenderFns:[]};var ge=a("VU/8")(fe,me,!1,function(t){a("myhN")},"data-v-fba952e2",null).exports,ye=a("lHA8"),_e=a.n(ye),we=a("c/Tr"),Ce=a.n(we),xe=a("d7EF"),be=a.n(xe),ke=a("W3Iv"),Se=a.n(ke),Te={created:function(){this.getPackageInfo()},methods:{getPackageInfo:function(){var t=this,e="获取 package 信息列表失败，请重试";this.loading=!0,this.reset(),u.a.get("/api/app/agent_packages",{params:{appId:this.appId,agentId:this.agentId}}).then(function(a){(a=a.data).ok?(a=a.data,Array.isArray(a.packages)&&(t.packages=a.packages,t.packages.length>0&&(t.selectedPackage=t.packages[0]))):f.call(t,a.message||e,a.code),t.loading=!1}).catch(function(a){f.call(t,e+" "+a,a.code),t.loading=!1})},reset:function(){this.choseDependencies=!0,this.showHowToFix=!1},selectPackage:function(t){this.reset(),this.selectedPackage=this.packages[t]},howToFix:function(){this.showHowToFix=!0},showPackageInfo:function(){this.reset(),this.showHowToFix=!1},downloadPackage:function(t){window.location=t},getPackages:function(t,e){var a=this;return Se()(t).map(function(t){var s=be()(t,2),i=s[0],o=s[1],n=a.packageLockInfo[i]||{};return{packageName:i,settedPackageVersion:o,lockedPackageVersion:n.version,usedPackageDownloadUrl:n.resolved,devDependence:e}})},changeChosenDependencies:function(t){this.choseDependencies=t},changeChosenDevDependencies:function(t){this.choseDependencies=!t},showMorDetail:function(t){window.open(t)},changeDetail:function(t){var e=t.index,a=this.audit.actions||[];this.selectedResolves=a[e]&&a[e].resolves||[]}},computed:{audit:function(){var t=this.selectedPackage.audit||{};return t},advisories:function(){var t=this.audit.advisories||{};return t},metadata:function(){var t=this.audit.metadata||{};return t},vulnerabilities:function(){var t=this.metadata.vulnerabilities||{};return t},totalDependencies:function(){var t=this.metadata.totalDependencies||0;return t},scanTime:function(){var t=this.metadata.scanTime||0;return t},hasSecurityRisk:function(){var t=this.vulnerabilities;return t&&(t.low||t.moderate||t.high||t.critical)},packageLockInfo:function(){return this.selectedPackage.lock||{}},dependencies:function(){var t=this.selectedPackage.dependencies||{};return this.getPackages(t,!1)},devDependencies:function(){var t=this.selectedPackage.devDependencies||{};return this.getPackages(t,!0)},packageTableData:function(){return this.choseDependencies?this.dependencies:this.devDependencies},actionTableData:function(){var t=this.audit.actions||[];this.selectedResolves=t[0]&&t[0].resolves||[];var e=this.selectedPackage.devDependencies||{};return t.map(function(t,a){var s="",i=!!e[t.module];switch(t.action){case"install":s="npm install "+t.module+"@"+t.target+" "+(i?"--save-dev":"--save");break;case"update":s="npm update "+t.module+" --depth="+t.depth;break;case"review":s="涉及到的依赖模块需要手动 review"}return{index:a,fixCmd:s}})},resolvesTableData:function(){var t=this.advisories;return this.selectedResolves.map(function(e){var a={dev:e.dev,fullPath:e.path},s=e.id,i=t[s];if(i){a.moduleName=i.module_name,a.currentVersions=i.findings.map(function(t){return t.version}).join(", "),a.originDependence=[];var o=!0,n=!1,r=void 0;try{for(var l,c=K()(i.findings);!(o=(l=c.next()).done);o=!0){var p=l.value.paths,d=!0,u=!1,h=void 0;try{for(var v,f=K()(p);!(d=(v=f.next()).done);d=!0){var m=v.value.split(">");m.length>0&&a.originDependence.push(m[0])}}catch(t){u=!0,h=t}finally{try{!d&&f.return&&f.return()}finally{if(u)throw h}}}}catch(t){n=!0,r=t}finally{try{!o&&c.return&&c.return()}finally{if(n)throw r}}a.originDependence=Ce()(new _e.a(a.originDependence)),a.originDependence=a.originDependence.join(", "),a.severity=i.severity,a.vulnerableVersions=i.vulnerable_versions,a.detail=i.url}return a})}},watch:{agentId:function(){this.getPackageInfo()}}},Le=p()({props:["appId","agentId"],data:function(){return{loading:!1,selectedPackage:{},choseDependencies:!0,packages:[],showHowToFix:!1,selectedResolves:[],packageInfoColumns:[{title:"依赖名称",slot:"packageName"},{title:"版本设置信息",slot:"settedPackageVersion",align:"center"},{title:"版本锁定信息",slot:"lockedPackageVersion",align:"center"},{title:"下载实际使用版本",slot:"usedPackageDownloadUrl",width:180,align:"center"}],actionColumns:[{title:"安全漏洞修复命令",slot:"fixCmd"}],resolvesColumns:[{title:"模块名称",slot:"moduleName",align:"center"},{title:"当前版本",slot:"currentVersions",align:"center"},{title:"完整依赖路径",slot:"fullPath",width:250},{title:"漏洞级别",slot:"severity",align:"center"},{title:"影响版本",slot:"vulnerableVersions",align:"center"},{title:"漏洞详情",slot:"detail",align:"center"}]}}},Te),Ie={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",[t.loading?a("Col",[a("Row",{staticStyle:{"margin-top":"200px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{attrs:{size:"large"}})],1)],1)],1):t._e(),t._v(" "),t.loading||0!==t.packages.length?t._e():a("Col",[a("Row",{staticClass:"dashboard-message-tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v(" "),a("span",[t._v("项目下暂无 package 信息，请查看您的 xagent 是否正确配置了 packages 模块依赖文件路径数组")])],1)],1),t._v(" "),t.loading||0===t.packages.length?t._e():a("Col",{staticClass:"info-prompt"},[t.hasSecurityRisk?a("Alert",{attrs:{type:"warning"}},[a("Icon",{staticClass:"message-icon",staticStyle:{color:"#ff9900"},attrs:{type:"ios-alert-outline"}}),t._v("项目\n        "),a("Dropdown",{on:{"on-click":t.selectPackage}},[a("a",{attrs:{href:"javascript:void(0)"}},[a("span",{staticStyle:{color:"#ff9900"}},[t._v(t._s(t.selectedPackage.name))])]),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.packages,function(e,s){return a("DropdownItem",{key:s,attrs:{name:s}},[t._v(t._s(e.name))])}),1)],1),t._v(" "),a("span",[t._v("引入的 npm 依赖模块发现")]),t._v(" "),t.vulnerabilities.critical?a("span",[a("code",{staticClass:"alert"},[t._v(t._s(t.vulnerabilities.critical))]),t._v(" 个极危漏洞\n        ")]):t._e(),t._v(" "),t.vulnerabilities.high?a("span",[a("code",{staticClass:"alert"},[t._v(t._s(t.vulnerabilities.high))]),t._v(" 个高危漏洞\n        ")]):t._e(),t._v(" "),t.vulnerabilities.moderate?a("span",[a("code",{staticClass:"alert"},[t._v(t._s(t.vulnerabilities.moderate))]),t._v(" 个中危漏洞\n        ")]):t._e(),t._v(" "),t.vulnerabilities.low?a("span",[a("code",{staticClass:"alert"},[t._v(t._s(t.vulnerabilities.low))]),t._v(" 个低危漏洞\n        ")]):t._e(),t._v("\n        （共扫描\n        "),a("code",[t._v(t._s(t.totalDependencies))]),t._v(" 个依赖模块于\n        "),a("code",[t._v(t._s(t.scanTime))]),t._v("）\n        "),t.showHowToFix?a("a",{staticStyle:{color:"#ff9900"},attrs:{href:"javascript:void(0)"},on:{click:t.showPackageInfo}},[t._v("查看依赖模块")]):a("a",{staticStyle:{color:"#ff9900"},attrs:{href:"javascript:void(0)"},on:{click:t.howToFix}},[t._v("查看如何修复")])],1):t._e(),t._v(" "),t.showHowToFix?t._e():a("Row",[a("Tag",{staticStyle:{"user-select":"none"},attrs:{checkable:"",checked:t.choseDependencies,color:"primary"},on:{"on-change":t.changeChosenDependencies}},[t._v("dependencies")]),t._v(" "),a("Tag",{staticStyle:{"user-select":"none"},attrs:{checkable:"",checked:!t.choseDependencies,color:"primary"},on:{"on-change":t.changeChosenDevDependencies}},[t._v("devDependencies")])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"12px","margin-bottom":"15px"}},[t.showHowToFix?a("Col",[a("Row",{attrs:{gutter:8}},[a("Col",{attrs:{span:"6"}},[a("Table",{staticClass:"package-content",attrs:{columns:t.actionColumns,data:t.actionTableData,"highlight-row":""},on:{"on-current-change":t.changeDetail},scopedSlots:t._u([{key:"fixCmd",fn:function(e){var s=e.row;return[a("code",[t._v(t._s(s.fixCmd||"Unknown"))])]}}],null,!1,2780615366)})],1),t._v(" "),a("Col",{attrs:{span:"18"}},[a("Table",{staticClass:"package-content",attrs:{columns:t.resolvesColumns,data:t.resolvesTableData},scopedSlots:t._u([{key:"moduleName",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.moduleName))])]}},{key:"currentVersions",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.currentVersions))])]}},{key:"fullPath",fn:function(e){var s=e.row;return[a("span",{staticClass:"long-text"},[t._v(t._s(s.fullPath))])]}},{key:"severity",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.severity))])]}},{key:"vulnerableVersions",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.vulnerableVersions))])]}},{key:"detail",fn:function(e){var s=e.row;return[a("Button",{attrs:{type:"primary",long:"",ghost:"",size:"small"},on:{click:function(e){return t.showMorDetail(s.detail)}}},[t._v("漏洞详情")])]}}],null,!1,1077850856)})],1)],1)],1):a("Table",{staticClass:"package-content",attrs:{columns:t.packageInfoColumns,data:t.packageTableData},scopedSlots:t._u([{key:"packageName",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.packageName))])]}},{key:"settedPackageVersion",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.settedPackageVersion))])]}},{key:"lockedPackageVersion",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.lockedPackageVersion))])]}},{key:"usedPackageDownloadUrl",fn:function(e){var s=e.row;return[a("Button",{attrs:{type:"primary",size:"small",long:"",ghost:""},on:{click:function(e){return t.downloadPackage(s.usedPackageDownloadUrl)}}},[t._v("下载当前使用版本")])]}}],null,!1,4167395441)})],1)],1)],1)],1)},staticRenderFns:[]};var De=a("VU/8")(Le,Ie,!1,function(t){a("od7/")},"data-v-e849624c",null).exports,Re={props:["show","loading","cancel","data"],data:function(){return{showModal:!1,columns:[{title:"信息",key:"type",width:140},{title:"系统详情",key:"detail"}]}},watch:{show:function(){this.showModal=this.show},showModal:function(){this.$emit("modalStatusChanged",this.showModal)}},computed:{list:function(){var t=this.data.data;return t?[{type:"Node.js 版本",detail:"v"+t.nodeVersion},{type:"X-Agent 信息",detail:t.xagentVersion?"xagent@"+t.xagentVersion:"未知"},{type:"核心转储文件",detail:t.ulimitC+("unlimited"!==t.ulimitC?" ("+y(t.ulimitC)+")":"")},{type:"操作系统信息",detail:""+t.osInfo}]:[]}}},Me={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Modal",{staticStyle:{"border-radius":"0px"},attrs:{width:"580",closable:""},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[a("p",{staticStyle:{color:"white"},attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),a("span",[t._v("实例信息")])],1),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px","margin-bottom":"10px","text-align":"center"},attrs:{type:"flex",justify:"center"}},[t.loading?a("Row",[a("Col",{attrs:{span:"1"}},[a("Spin",{staticStyle:{color:"#2db7f5"},attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"ios-loading",size:"18"}})],1)],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Col",{attrs:{span:"24"}},[t.data.ok?a("Row",{staticStyle:{"text-align":"left"}},[a("Table",{staticStyle:{width:"550px"},attrs:{columns:t.columns,data:t.list}})],1):t._e(),t._v(" "),t.data.ok?t._e():a("Row",[a("p",[t._v(t._s(t.data.message))])])],1)],1)],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[t.loading?a("Button",{attrs:{type:"primary",ghost:"",loading:!0},on:{click:t.cancel}},[t._v("连接实例中...")]):t._e(),t._v(" "),t.loading?t._e():a("Button",{attrs:{type:"primary",ghost:""},on:{click:t.cancel}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var Pe=a("VU/8")(Re,Me,!1,function(t){a("I/Tt")},"data-v-29a053f4",null).exports,Ae=p()({data:function(){return{appId:"",selectedAgent:"",agentList:[],instanceTab:"",agentLoading:!1,showCheckOSModal:!1,checkOSModalLoading:!1,checkOSData:{},checkInstanceDisabled:!0}},props:["appName"],components:{"instance-process":ae,"instance-system":de,"instance-error":ge,"instance-package":De,"x-check-os":Pe},created:function(){this.appId=this.$route.params.appId,this.agentLoading=!0,this.getAgentList(),this.selectedAgent=this.$route.query.agentId||"",this.instanceTab=this.$route.query.instanceTab||"process"}},_t),je={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      "+t._s(t.appName)+"\n      > 实例信息\n      "),a("Select",{staticClass:"agent-list-select",attrs:{size:"small",placeholder:"请选择实例 ID"},model:{value:t.selectedAgent,callback:function(e){t.selectedAgent=e},expression:"selectedAgent"}},t._l(t.agentList,function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])}),1),t._v(" "),a("Button",{staticClass:"agent-list-button",attrs:{size:"small",type:"primary",disabled:t.checkInstanceDisabled},on:{click:t.checkInstance}},[t._v("查看实例")])],1)],1),t._v(" "),t.agentLoading?a("div",[a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{staticStyle:{"margin-top":"150px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin",{attrs:{size:"large"}})],1)],1)],1):t._e(),t._v(" "),t.agentLoading?t._e():a("div",[t.agentList.length?t._e():a("div",[a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{staticClass:"tip"},[a("Icon",{attrs:{type:"ios-information-circle-outline"}}),t._v(" "),a("span",[t._v("没有任何实例连接到此应用，请确认您的服务器上启动了 x-agent 并且填写了正确的 appid 和 secret")])],1)],1),t._v(" "),t.agentList.length?a("div",[a("Row",{staticClass:"instance-tab"},[a("Tabs",{attrs:{value:t.instanceTab},model:{value:t.instanceTab,callback:function(e){t.instanceTab=e},expression:"instanceTab"}},[a("TabPane",{attrs:{label:"进程数据",name:"process",icon:"ios-pulse"}}),t._v(" "),a("TabPane",{attrs:{label:"系统数据",name:"system",icon:"md-laptop"}}),t._v(" "),a("TabPane",{attrs:{label:"异常日志",name:"error",icon:"md-warning"}}),t._v(" "),a("TabPane",{attrs:{label:"模块依赖",name:"package",icon:"md-git-branch"}})],1)],1),t._v(" "),"process"===t.instanceTab?a("instance-process",{attrs:{"app-id":t.appId,"agent-id":t.selectedAgent},on:{instanceStatus:t.updateCheckInstanceDisabled}}):t._e(),t._v(" "),"system"===t.instanceTab?a("instance-system",{attrs:{"app-id":t.appId,"agent-id":t.selectedAgent}}):t._e(),t._v(" "),"error"===t.instanceTab?a("instance-error",{attrs:{"app-id":t.appId,"agent-id":t.selectedAgent}}):t._e(),t._v(" "),"package"===t.instanceTab?a("instance-package",{attrs:{"app-id":t.appId,"agent-id":t.selectedAgent}}):t._e()],1):t._e()]),t._v(" "),a("x-check-os",{attrs:{show:t.showCheckOSModal,loading:t.checkOSModalLoading,cancel:function(){t.showCheckOSModal=!1},data:t.checkOSData},on:{modalStatusChanged:t.updateCheckOSModalStatus}})],1)},staticRenderFns:[]};var Fe=a("VU/8")(Ae,je,!1,function(t){a("Teoh")},"data-v-9e6e5278",null).exports,Ne={methods:{getDiag:function(){var t=this;this.loading=!0;var e=this.data;u.a.get("/file/download",{params:{fileId:e.fileId,fileType:e.fileType}}).then(function(e){e=e.data,t.diag=e,t.loading=!1}).catch(function(e){f.call(t,"获取诊断报告失败，请重试 "+e,e.code),t.loading=!1})},getSpaceName:function(t){return t.name.split("_").join(" ")},getSpaceSize:function(t){return y(t.size)},getHeapTotal:function(){return y(((this.diag||{}).heapStatistics||{}).heapTotal||0)},getHeapLimit:function(){return y(((this.diag||{}).heapStatistics||{}).heapLimit||0)},changePage:function(t){this.libuvCurrentPage=t}},computed:{jsStackList:function(){return((this.diag||{}).jsStacks||[]).map(function(t){var e=t.pcAddress,a=t.frameType,s=t.functionName?t.functionName+"()":"anonymous()",i=t.scriptName;return t.lineNumber&&(i+=":"+t.lineNumber),t.column&&(i+=":"+t.column),{pcAddress:e,frameType:a,functionName:s,url:i}})},nativeStackList:function(){return(this.diag||{}).nativeStacks||[]},spaces:function(){var t=this.diag||{};return t.gcStatistics||t.heapSpaceStatistics||[]},libuvTotalHandles:function(){var t=(this.diag||{}).libuvHandles||[],e=t.reduce(function(t,e){return t[e.type]?t[e.type]++:t[e.type]=1,t},{}),a=t.map(function(t){var a=t.address,s=t.type,i=t.isActive,o="数量: "+e[t.type]+", 活跃: "+(i?"是":"否")+", 状态: "+(t.hasRef?"ref":"unref");return t.detail&&(o+=", 详情: "+t.detail),{pcAddress:a,type:s,detail:o,active:i}});return a.sort(function(t,a){return e[t.type]<e[a.type]?1:-1}),a},libuvHandles:function(){var t=(this.libuvCurrentPage-1)*this.libuvPageSize,e=this.libuvCurrentPage*this.libuvPageSize;return this.libuvTotalHandles.filter(function(){return(arguments.length<=1?void 0:arguments[1])>=t&&(arguments.length<=1?void 0:arguments[1])<e})},systemData:function(){return(this.diag||{}).system||{}},envList:function(){return(this.systemData.env||[]).map(function(t){var e=t.split("=");return{key:e[0],value:e[1]}})},resources:function(){return this.systemData.resourceLimits||[]},loadedLibs:function(){return this.systemData.loadedLibraries||[]}},watch:{messageType:function(){this.messageType!==this.$route.query.messageType&&(this.libuvCurrentPage=1,this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{messageType:this.messageType,libuvCurrentPage:1})}))},libuvCurrentPage:function(){this.libuvCurrentPage!==Number(this.$route.query.libuvCurrentPage)&&this.$router.push({path:this.$route.path,query:p()({},this.$route.query,{libuvCurrentPage:this.libuvCurrentPage})})}}},$e=p()({data:function(){return{loading:!1,diag:{},messageType:"",jsStack:[{title:"寄存器指令地址",slot:"pcAddress",width:140},{title:"函数类型",slot:"frameType",width:100,align:"center"},{title:"函数信息",slot:"url"}],nativeStack:[{title:"寄存器指令地址",slot:"pcAddress",width:140},{title:"Native 符号和共享库（动态/静态链接库）信息",slot:"symbolInfo"}],libuv:[{title:"寄存器指令地址",slot:"pcAddress",width:140},{title:"句柄类型",slot:"type",width:100},{title:"句柄详细信息",slot:"detail"}],libuvCurrentPage:1,libuvPageSize:10}},props:["data"],created:function(){this.getDiag(),this.messageType=this.$route.query.messageType||"jsStack",this.libuvCurrentPage=Number(this.$route.query.libuvCurrentPage)||1}},Ne),ze={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      诊断报告分析\n      > "+t._s(t.data.fileName)+"\n    ")])],1),t._v(" "),a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",[t.loading?a("Row",{staticStyle:{"margin-top":"200px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin")],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[a("Row",[a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("ProcessID")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.diag.pid))])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("Node.js 版本")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.diag.nodeVersion))])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("启动时间")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.diag.loadTime))])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("生成时间")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.diag.dumpTime))])],1)],1),t._v(" "),a("Row",[a("Tabs",{staticClass:"content",attrs:{value:t.messageType},model:{value:t.messageType,callback:function(e){t.messageType=e},expression:"messageType"}},[a("TabPane",{attrs:{label:"JavaScript 栈",name:"jsStack"}}),t._v(" "),a("TabPane",{attrs:{label:"Native 栈",name:"nativeStack"}}),t._v(" "),a("TabPane",{attrs:{label:"堆内存分布",name:"heap"}}),t._v(" "),a("TabPane",{attrs:{label:"Libuv 句柄",name:"libuv"}}),t._v(" "),a("TabPane",{attrs:{label:"系统详情",name:"system"}})],1)],1),t._v(" "),a("Row",{staticClass:"detail"},["jsStack"===t.messageType?a("div",[a("Table",{attrs:{columns:t.jsStack,data:t.jsStackList,"no-data-text":"暂无 JavaScript 栈信息"},scopedSlots:t._u([{key:"pcAddress",fn:function(e){var s=e.row;return[a("strong",{staticStyle:{color:"#c7254e"}},[t._v(t._s(s.pcAddress))])]}},{key:"frameType",fn:function(e){var s=e.row;return[a("strong",{staticStyle:{color:"#c7254e"}},[t._v(t._s(s.frameType))])]}},{key:"url",fn:function(e){var s=e.row;return[a("span",{staticStyle:{color:"#6f42c1"}},[t._v(t._s(s.functionName))]),t._v(" "),a("span",{staticStyle:{"font-style":"italic",color:"#d73a49"}},[t._v("("+t._s(s.url)+")")])]}}],null,!1,4208032628)})],1):t._e(),t._v(" "),"nativeStack"===t.messageType?a("div",[a("Table",{attrs:{columns:t.nativeStack,data:t.nativeStackList,"no-data-text":"暂无 Native 栈信息"},scopedSlots:t._u([{key:"pcAddress",fn:function(e){var s=e.row;return[a("strong",{staticStyle:{color:"#3ba3d8"}},[t._v(t._s(s.pcAddress))])]}},{key:"symbolInfo",fn:function(e){var s=e.row;return[a("span",{staticStyle:{color:"#3ba3d8"}},[t._v(t._s(s.symbolName))]),t._v(" "),"win32"===s.os?a("span",{staticStyle:{"font-style":"italic",color:"#30bfda"}},[a("span",[t._v(t._s(s.sharedObjectName))]),t._v(" "),void 0!==s.offset?a("span",[t._v("[+"+t._s(s.offset)+"]")]):t._e(),t._v(" "),void 0!==s.url?a("span",[t._v("in "+t._s(s.url))]):t._e(),t._v(" "),void 0!==s.lineNumber?a("span",[t._v("line: "+t._s(s.lineNumber))]):t._e()]):a("span",{staticStyle:{"font-style":"italic",color:"#30bfda"}},[t._v("["+t._s(s.sharedObjectName)+"]")])]}}],null,!1,2996313878)})],1):t._e(),t._v(" "),"heap"===t.messageType?a("div",{staticStyle:{"text-align":"left"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("堆已使用内存:\n            "),a("span",{staticStyle:{color:"#c7254e"}},[t._v(t._s(t.getHeapTotal()))]),t._v(", V8 可分配内存上限:\n            "),a("span",{staticStyle:{color:"#c7254e"}},[t._v(t._s(t.getHeapLimit()))])],1),t._v(" "),a("Row",{staticClass:"diag-content"},[a("strong",{staticClass:"system-tile"},[t._v("Heap Spaces")]),t._v(" "),t._l(t.spaces,function(e,s){return a("Row",{key:s,style:"margin-top:5px;margin-left:10px"},[t._v("\n              *\n              "),a("span",[t._v(t._s(t.getSpaceName(e)))]),t._v(" "),a("span",{staticStyle:{color:"#d73a49"}},[t._v(":")]),t._v(" "),a("span",{staticStyle:{color:"#005cc5"}},[t._v(t._s(t.getSpaceSize(e)))])])})],2)],1):t._e(),t._v(" "),"libuv"===t.messageType?a("div",[a("Row",{staticClass:"info-prompt",staticStyle:{"margin-right":"0","margin-left":"0"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("Libuv 句柄总数:\n              "),a("span",{staticStyle:{color:"#c7254e"}},[t._v(t._s(t.libuvTotalHandles.length))]),t._v(", 活跃句柄数:\n              "),a("span",{staticStyle:{color:"#c7254e"}},[t._v(t._s(t.libuvTotalHandles.filter(function(t){return t.active}).length))])],1)],1),t._v(" "),a("Table",{attrs:{columns:t.libuv,data:t.libuvHandles,"no-data-text":"暂无 Libuv 句柄信息"},scopedSlots:t._u([{key:"pcAddress",fn:function(e){var s=e.row;return[s.active?a("strong",{staticStyle:{color:"#3ba3d8"}},[t._v(t._s(s.pcAddress))]):t._e(),t._v(" "),s.active?t._e():a("strong",{staticStyle:{color:"#c5c8ce"}},[t._v(t._s(s.pcAddress))])]}},{key:"type",fn:function(e){var s=e.row;return[s.active?a("strong",{staticStyle:{color:"#3ba3d8"}},[t._v(t._s(s.type))]):t._e(),t._v(" "),s.active?t._e():a("strong",{staticStyle:{color:"#c5c8ce"}},[t._v(t._s(s.type))])]}},{key:"detail",fn:function(e){var s=e.row;return[s.active?a("span",{staticStyle:{color:"#1570a6 !important"}},[t._v(t._s(s.detail))]):t._e(),t._v(" "),s.active?t._e():a("span",{staticStyle:{color:"#c5c8ce"}},[t._v(t._s(s.detail))])]}}],null,!1,1909306280)}),t._v(" "),t.libuvTotalHandles.length?a("Row",{staticClass:"pagination"},[a("Page",{attrs:{total:t.libuvTotalHandles.length,"page-size":t.libuvPageSize,current:t.libuvCurrentPage,size:"small","show-elevator":""},on:{"on-change":t.changePage}})],1):t._e()],1):t._e(),t._v(" "),"system"===t.messageType?a("div",[a("Row",{staticClass:"info-prompt",staticStyle:{"margin-right":"0","margin-left":"0"}},[a("Alert",[a("Icon",{staticClass:"message-icon",attrs:{type:"ios-alert-outline"}}),t._v("系统信息：\n              "),a("span",{staticStyle:{color:"#c7254e"}},[t._v(t._s(t.diag.osVersion))])],1)],1),t._v(" "),a("Row",{staticClass:"diag-content"},[a("Row",[a("strong",{staticClass:"system-tile"},[t._v("Env")]),t._v(" "),t._l(t.envList,function(e,s){return a("Row",{key:s},[a("Row",{staticStyle:{"margin-left":"10px"}},[t._v("\n                  *\n                  "),a("span",[t._v(t._s(e.key))]),t._v(" "),a("span",{staticStyle:{color:"#d73a49"}},[t._v(":")]),t._v(" "),a("span",{staticStyle:{color:"#229954"}},[t._v('"'+t._s(e.value)+'"')])])],1)})],2),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px"}},[a("strong",{staticClass:"system-tile"},[t._v("Resource Limit")]),t._v(" "),t._l(t.resources,function(e,s){return a("Row",{key:s},[a("Row",{staticStyle:{"margin-left":"10px"}},[t._v("\n                  *\n                  "),a("span",[t._v(t._s(e.type))]),t._v(" "),a("span",{staticStyle:{color:"#d73a49"}},[t._v(":")]),t._v(" "),a("span",{staticStyle:{color:"#"}},[t._v("Soft")]),t._v(" "),a("span",{staticStyle:{color:"#005cc5"}},[t._v(t._s(e.softLimit))]),t._v(" "),a("span",{staticStyle:{color:"#"}},[t._v("Hard")]),t._v(" "),a("span",{staticStyle:{color:"#005cc5"}},[t._v(t._s(e.hardLimit))])])],1)})],2),t._v(" "),a("Row",{staticStyle:{"margin-top":"10px"}},[a("strong",{staticClass:"system-tile"},[t._v("Loaded Libraries")]),t._v(" "),t._l(t.loadedLibs,function(e,s){return a("Row",{key:s},[a("Row",{staticStyle:{"margin-left":"10px"}},[t._v("\n                  *\n                  "),a("span",[t._v(t._s(e))])])],1)})],2)],1)],1):t._e()])],1)],1)],1)},staticRenderFns:[]};var Ue=a("VU/8")($e,ze,!1,function(t){a("luJ5")},"data-v-7d3009b1",null).exports,Ee=a("gRE1"),Oe=a.n(Ee),Be={methods:{getGcLog:function(){var t=this;this.loading=!0;var e=this.data;u.a.get("/file/download",{params:{fileId:e.fileId,fileType:e.fileType}}).then(function(e){e=e.data,Array.isArray(e.gc)&&e.gc&&t.parseGcLog(e),t.loading=!1}).catch(function(e){f.call(t,"获取 GC 追踪日志失败，请重试 "+e,e.code),t.loading=!1})},getTotalSize:function(t){var e=0,a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){e+=o.value.space_used_size}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return e},parseGcLog:function(t){for(var e=t.gc||[],a=0;a<e.length;a++){var s=e[a];s.index=a+1,s.totalSizeBefore=this.getTotalSize(s.before),s.totalSizeAfter=this.getTotalSize(s.after)}this.gcLog=t,this.showGcData=e[0],e[0]&&Array.isArray(e[0].before)&&(this.spaces=e[0].before.map(function(t){return t.name}),this.spaces.splice(this.spaces.indexOf("new_space"),1),this.spaces.unshift("new_space"),this.spaces.splice(this.spaces.indexOf("old_space"),1),this.spaces.push("old_space"))},getTotalPauseTime:function(){var t=this.gcList,e=0,a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){var r=o.value;e+=+(r.end-r.start)}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return e},resetRadio:function(){this.selectGcStatus="before"},dropleft:function(){var t=this.showGcData.index,e=this.gcList;1!==t&&(this.showGcData=e[t-2],this.resetRadio())},dropright:function(){var t=this.showGcData.index,e=this.gcList;t!==e.length&&(this.showGcData=e[t],this.resetRadio())},formatTime:function(t){return function t(e,a){e=!isNaN(e)&&e||0;var s="";if((e=Number(e))<1e3)s=parseInt(e)+" "+(a?"毫秒":"ms");else if(e<6e4){var i=parseInt(e/1e3),o=e-1e3*i;s=i+" "+(a?"秒":"s")+(o?" "+t(o,a):"")}else if(e<36e5){var n=parseInt(e/6e4),r=e-1e3*n*60;s=n+" "+(a?"分":"min")+(r?" "+t(r,a):"")}else if(e<864e5){var l=parseInt(e/36e5),c=e-1e3*l*60*60;s=l+" "+(a?"时":"h")+(c?" "+t(c,a):"")}else{var p=parseInt(e/864e5),d=e-1e3*p*60*60*24;s=p+" "+(a?"天":"d")+(d?" "+t(d,a):"")}return s}(t,"ch")},formatSize:function(t){return y(t,!0)},getSpaceInfo:function(t){var e=this.showGcData[this.selectGcStatus]||[],a=!0,s=!1,i=void 0;try{for(var o,n=K()(e);!(a=(o=n.next()).done);a=!0){var r=o.value;if(r.name===t)return r}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}},showTooltip:function(t,e,a){var s=this.getSpaceInfo(t),i=e.split("::"),o=i[0];if(e=i[1],"active"===o)if("used"===e)this.spaceDetail="used "+t+": "+y(s.space_used_size);else{var n=s.space_size;this.spaceDetail="unused "+t+": "+y(n-s.space_used_size)}else this.spaceDetail="inactive new_space semispace: "+y(s.space_size/2);var r=this.$refs["space-detail"],l=parseInt(window.getComputedStyle(r).height,10),c=parseInt(window.getComputedStyle(r).width,10),p=parseInt(window.getComputedStyle(this.$refs["process-body"].$el).width,10),d=a.pageX+10+c<p?a.pageX+10:a.pageX-10-c,u=a.pageY>l?a.pageY-(l&&l+10):a.pageY+10;r.style.display="inherit",r.style["z-index"]=9999,r.style.left=d+"px",r.style.top=u+"px"},resetTooltip:function(){this.spaceDetail="";var t=this.$refs["space-detail"];t.style.display="none",t.style["z-index"]=-9999,t.style.left="0px",t.style.top="0px"},getSpaceMap:function(t){return t.reduce(function(t,e){return t[e.name]=e,t},{})},clickGcObject:function(t){this.showGcData=this.gcList[t.index]},pushChart:function(t){this.charts.push(t)},plotmove:function(t){var e=this,a=t.time;this.charts.forEach(function(t){var s=t.chart,i=t.id,o=e[i],n=void 0,r=!0,l=!1,c=void 0;try{for(var p,d=K()(o);!(r=(p=d.next()).done);r=!0){var u=p.value;u.time===a&&(n=u)}}catch(t){l=!0,c=t}finally{try{!r&&d.return&&d.return()}finally{if(l)throw c}}if(n){var h=s.getXY(n);h.x>0&&h.y>0&&s.showTooltip(h)}})},plotleave:function(){this.charts.forEach(function(t){var e=t.chart;try{e.hideTooltip()}catch(t){}})},getSpaceColor:function(t){return"old_space"===t?"#F4D03F":this.colors[this.spaces.indexOf(t)%this.colors.length]},getSpaceWidth:function(t){return this.spacesSpan[t]},getUsedHeight:function(t){var e=this.getSpaceInfo(t),a=e.space_size;return e.space_used_size?(e.space_used_size/a*100).toFixed(2):0}},computed:{spacesSpan:function(){var t={},e=0,a=this.showGcData[this.selectGcStatus]||[],s=!0,i=!1,o=void 0;try{for(var n,r=K()(a);!(s=(n=r.next()).done);s=!0){var l=n.value;"old_space"!==l.name&&(e+=l.space_size)}}catch(t){i=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw o}}var c="",p=0,d=!0,u=!1,h=void 0;try{for(var v,f=K()(a);!(d=(v=f.next()).done);d=!0){var m=v.value;if("old_space"!==m.name){var g=Math.round(m.space_size/e*24);g<2&&(g=2),g>p&&(p=g,c=m.name),t[m.name]=g}}}catch(t){u=!0,h=t}finally{try{!d&&f.return&&f.return()}finally{if(u)throw h}}var y=0,_=!0,w=!1,C=void 0;try{for(var x,b=K()(Oe()(t));!(_=(x=b.next()).done);_=!0){y+=x.value}}catch(t){w=!0,C=t}finally{try{!_&&b.return&&b.return()}finally{if(w)throw C}}return y>24&&(t[c]-=y-24),t},gcList:function(){var t=this.gcLog&&this.gcLog.gc;return t||[]},startTime:function(){var t=this.gcLog&&this.gcLog.startTime||0;return 1e3*t},stopTime:function(){var t=this.gcLog&&this.gcLog.stopTime||0;return 1e3*t},totalGcTime:function(){var t=this.getTotalPauseTime();return t=t?_(t):"-"},totalGTracingTime:function(){return _(this.stopTime-this.startTime)},gcTimes:function(){var t=this.gcList,e={total:0,scavenge:0,marksweep:0,marking:0},a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){var r=o.value;e.total++,"scavenge"===r.type&&e.scavenge++,"marksweep"===r.type&&e.marksweep++,"marking"===r.type&&e.marking++}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return e},memoryBeforeFirstGc:function(){var t=this.gcList;return t.length?y(t[0].totalSizeBefore):"-"},memoryAfterLastGc:function(){var t=this.gcList;return t.length?y(t[t.length-1].totalSizeAfter):"-"},gcPauseData:function(){return this.gcList.map(function(t,e){return{"(ms)":t.end-t.start,name:"name",type:t.type,index:e}})},gcReduceData:function(){return this.gcList.map(function(t,e){return{"(MB)":(t.totalSizeAfter-t.totalSizeBefore)/1024/1024,name:"name",type:t.type,index:e}})},progressPercentage:function(){return(this.getTotalPauseTime()/(this.stopTime-this.startTime)*100).toFixed(2)+"%"},totalSpacesUsedSize:function(){var t=this.showGcData[this.selectGcStatus]||[],e=0,a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){e+=o.value.space_used_size}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return y(e)},totalSpacesSize:function(){var t=this.showGcData[this.selectGcStatus]||[],e=0,a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){e+=o.value.space_size}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return y(e)},totalHoleSize:function(){var t=this.showGcData[this.selectGcStatus]||[],e=0,a=["read_only_space","old_space","code_space","map_space"],s=!0,i=!1,o=void 0;try{for(var n,r=K()(t);!(s=(n=r.next()).done);s=!0){var l=n.value;a.includes(l.name)&&(e+=l.space_available_size)}}catch(t){i=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw o}}return y(e)},totalPhysicalSpacesSize:function(){var t=this.showGcData[this.selectGcStatus]||[],e=0,a=!0,s=!1,i=void 0;try{for(var o,n=K()(t);!(a=(o=n.next()).done);a=!0){e+=o.value.physical_space_size}}catch(t){s=!0,i=t}finally{try{!a&&n.return&&n.return()}finally{if(s)throw i}}return y(e)},mainChangeSpace:function(){var t=this.getSpaceMap(this.showGcData.before),e=this.getSpaceMap(this.showGcData.after),a={},s=!0,i=!1,o=void 0;try{for(var n,r=K()(Se()(e));!(s=(n=r.next()).done);s=!0){var l=n.value,c=be()(l,2),p=c[0],d=c[1];a[p]=d.space_used_size-t[p].space_used_size}}catch(t){i=!0,o=t}finally{try{!s&&r.return&&r.return()}finally{if(i)throw o}}return(a=Se()(a).map(function(t){var e=be()(t,2);return{name:e[0],change:e[1]}})).sort(function(t,e){return Math.abs(t.change)<Math.abs(e.change)?1:-1}),(a=a.filter(function(t){return t.change}).map(function(t){return t.name+': <strong style="color: #17233d">'+y(t.change,!0)+"</strong>"}).join("<br />"))||'<strong style="color: #17233d">无变化</strong>'},gcCostTrend:function(){return this.gcList.map(function(t,e){return{time:e,value:t.end-t.start,type:t.type,index:e}})},gcHeapReduceTrend:function(){return this.gcList.map(function(t,e){return{time:e,value:t.totalSizeAfter/1024/1024,raw:t.totalSizeAfter-t.totalSizeBefore,type:t.type,index:e}})},gcSpaceTrend:function(){for(var t=this.gcList,e=[],a=0;a<t.length;a++){var s=t[a],i=this.getSpaceMap(s.before),o=this.getSpaceMap(s.after),n=!0,r=!1,l=void 0;try{for(var c,p=K()(this.spaces);!(n=(c=p.next()).done);n=!0){var d=c.value,u=o[d].space_used_size-i[d].space_used_size;u&&e.push({time:a,space:d,change:u,index:a})}}catch(t){r=!0,l=t}finally{try{!n&&p.return&&p.return()}finally{if(r)throw l}}}for(var h=0;h<t.length;h++){var v=t[h],f=v.totalSizeAfter-v.totalSizeBefore;f&&e.push({time:h,space:"all_spaces",change:f,index:h})}return e},spacesExceptOldSpace:function(){return this.spaces.filter(function(t){return"old_space"!==t})}}},Ge={data:function(){return{chart:null}},props:["id","fields","types","chartData","showColor"],mounted:function(){this.chart||this.drawChart()},watch:{chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint()):this.drawChart())}},methods:{color:function(t){return this.showColor},drawChart:function(){var t=this;this.chartData&&(this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,height:100,padding:[21,"25%",45,"25%"],animate:!1}),this.chart.source(this.chartData,{}),this.chart.legend(!1),this.chart.axis(this.fields[1],{grid:null,label:null}),this.chart.axis(this.fields[0],{tickLine:{length:-5}}),this.chart.scale(this.fields[0],{tickCount:5}),this.chart.tooltip(!1),this.chart.on("plotclick",function(e){var a=e.data&&e.data._origin;a&&a.index&&t.$emit("clickGcObject",a)}),this.chart.point().position(this.fields[0]+"*"+this.fields[1]).color(this.fields[2],this.color).size(4).opacity(.3).shape("circle").tooltip(this.fields[2]+"*"+this.fields[0]+"*"+this.fields[1],function(t,e,a){return{name:t,value:e+"ms"}}),this.chart.render())}}},Ve={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},He=a("VU/8")(Ge,Ve,!1,null,null,null).exports,qe={data:function(){return{chart:null,colors:["#3498db","#f5b041","#7d3c98"]}},props:["id","fields","alias","colorKeys","chartData","formatter"],mounted:function(){this.chart||this.drawChart()},watch:{chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint()):this.drawChart())}},methods:{color:function(t){var e=this.colorKeys.indexOf(t);if(e||0===e)return this.colors[e%this.colors.length]},drawChart:function(){var t=this;this.chartData&&(this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,height:400,animate:!1}),this.chart.source(this.chartData),this.chart.scale(this.fields[1],{alias:this.alias[this.fields[1]]}),this.chart.axis(this.fields[0],{label:{textStyle:{fill:"#aaaaaa"}},tickLine:{alignWithLabel:!1,length:0}}),this.chart.axis(this.fields[1],{label:{textStyle:{fill:"#aaaaaa"}},title:{offset:50}}),this.chart.tooltip({htmlContent:function(e,a){for(var s='<ul style="margin:0;list-style-type:none;padding:0;">',i=0;i<a.length;i++){var o=a[i];s+='<li><span style="background-color:'+o.color+';width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px;"></span>'+("scavenge"===o.name?"新生代回收":"marksweep"===o.name?"老生代回收":"marking"===o.name?"增量式标记":"未知")+':<span style="display:inline-block;float:right;margin-left:30px;">'+t.formatter(t.showOriginValue?o.point._origin.value:o.value)+"</span></li>"}return'<div style="position:absolute;visibility:hidden;z-index:8;transition:cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);background-color: rgba(255, 255, 255, 0.9);box-shadow: 0px 0px 10px #aeaeae;border-radius:3px;color:rgb(87, 87, 87);font-size:12px;font-family:r;line-height:20px;padding:10px 10px 6px 10px;">'+(s+="</ul>")+"</div>"}}),this.chart.interval().position("time*value*type").opacity(.8).size(2).color("type",this.color),this.chart.render(),this.$emit("pushChart",{chart:this.chart,id:this.id}),this.chart.on("plotmove",function(e){var a={x:e.x,y:e.y},s=t.chart.getSnapRecords(a);if(s.length){var i=s[0]._origin,o=i.time;t.$emit("plotmove",{time:o}),0!==i.index&&isNaN(i.index)||t.$emit("clickGcObject",i)}}),this.chart.on("plotleave",function(){return t.$emit("plotleave")}))}}},We={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},Xe=a("VU/8")(qe,We,!1,null,null,null).exports,Ke={data:function(){return{chart:null}},props:["id","fields","alias","showColor","chartData","formatter"],mounted:function(){this.chart||this.drawChart()},watch:{chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint()):this.drawChart())}},methods:{drawChart:function(){var t=this;this.chartData&&(this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,height:400,animate:!1}),this.chart.source(this.chartData),this.chart.scale(this.fields[1],{alias:this.alias[this.fields[1]]}),this.chart.axis(this.fields[0],{tickLine:{length:-5}}),this.chart.axis(this.fields[1],{label:{textStyle:{fill:"#aaaaaa"}},title:{offset:50}}),this.chart.tooltip({htmlContent:function(e,a){for(var s='<ul style="margin:0;list-style-type:none;padding:0;">',i=0;i<a.length;i++){var o=a[i],n=o.point._origin.type;s+='<li><span style="background-color:'+o.color+';width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:8px;"></span>'+("scavenge"===n?"新生代回收":"marksweep"===n?"老生代回收":"marking"===n?"增量式标记":"未知")+':<span style="display:inline-block;float:right;margin-left:30px;">'+t.formatter(o.point._origin.raw)+"</span></li>"}return'<div style="position:absolute;visibility:hidden;z-index:8;transition:cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);background-color: rgba(255, 255, 255, 0.9);box-shadow: 0px 0px 10px #aeaeae;border-radius:3px;color:rgb(87, 87, 87);font-size:12px;font-family:r;line-height:20px;padding:10px 10px 6px 10px;">'+(s+="</ul>")+"</div>"}}),this.chart.line().position(this.fields[0]+"*"+this.fields[1]).size(1).color(this.showColor),this.chart.render(),this.$emit("pushChart",{chart:this.chart,id:this.id}),this.chart.on("plotmove",function(e){var a={x:e.x,y:e.y},s=t.chart.getSnapRecords(a);if(s.length){var i=s[0]._origin,o=i.time;t.$emit("plotmove",{time:o}),0!==i.index&&isNaN(i.index)||t.$emit("clickGcObject",i)}}),this.chart.on("plotleave",function(){return t.$emit("plotleave")}))}}},Ye={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},Je=a("VU/8")(Ke,Ye,!1,null,null,null).exports,Qe={data:function(){return{chart:null}},props:["id","fields","alias","chartData","formatter"],mounted:function(){this.chart||this.drawChart()},watch:{chartData:function(){this.chartData&&(this.chart?(this.chart.changeData(this.chartData),this.chart.repaint()):this.drawChart())}},computed:{spacesMap:function(){var t={},e=!0,a=!1,s=void 0;try{for(var i,o=K()(this.chartData);!(e=(i=o.next()).done);e=!0){var n=i.value,r=Math.abs(n.change);t[n.space]?t[n.space].maxChange<r&&(t[n.space].maxChange=r):t[n.space]={maxChange:r}}}catch(t){a=!0,s=t}finally{try{!e&&o.return&&o.return()}finally{if(a)throw s}}return t}},methods:{drawChart:function(){var t=this;this.chartData&&(this.chart=new Tt.a.Chart({container:this.id,forceFit:!0,height:300,animate:!1,padding:["-5%","2%","10%","20%"]}),this.chart.source(this.chartData),this.chart.legend(!1),this.chart.axis(this.fields[0],{tickLine:{length:-5}}),this.chart.scale(this.fields[1],{alias:this.alias[this.fields[1]]}),this.chart.axis(this.fields[1],{label:{offset:17,textStyle:{fill:"#aaaaaa"}},title:{offset:172},grid:{hideLastLine:!0}}),this.chart.tooltip({showTitle:!1}),this.chart.point().position(this.fields[0]+"*"+this.fields[1]).color(this.fields[2],function(t){return t>0?"#f3a1a1":"#adbcc9"}).size(this.fields[1]+"*"+this.fields[2],function(e,a){var s=Math.round(Math.abs(a)/t.spacesMap[e].maxChange*15);return s<3?3:s}).opacity(this.fields[2],function(t){return 0===t?0:.6}).shape("circle").tooltip(this.fields[2]+"*"+this.fields[0]+"*"+this.fields[1],function(e,a,s){return{name:s,value:t.formatter(e)}}),this.chart.render(),this.chart.on("plotclick",function(e){var a=e.data&&e.data._origin;a&&a.index&&t.$emit("clickGcObject",a)}))}}},Ze={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{attrs:{id:this.id}})])},staticRenderFns:[]},ta=a("VU/8")(Qe,Ze,!1,null,null,null).exports,ea=p()({data:function(){return{loading:!1,gcLog:{},showGcData:{},selectGcStatus:"before",spaceDetail:"",spaces:[],colors:["#30bfd9","#ffc900","#8995d9","#d4668c","#646faa","#9B59B6","#2ECC71","#3498DB"],charts:[]}},props:["data"],components:{"x-mini-multi-scatter":He,"x-histogram":Xe,"x-line":Je,"x-gc-scatter":ta},created:function(){this.getGcLog()}},Be),aa={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Row",{staticClass:"info-bar"},[a("Col",{staticClass:"info-content"},[t._v("\n      GC 追踪日志分析\n      > "+t._s(t.data.fileName)+"\n    ")])],1),t._v(" "),a("Row",{staticClass:"info-divider"}),t._v(" "),a("Row",{ref:"process-body"},[t.loading?a("Row",{staticStyle:{"margin-top":"200px"},attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"1"}},[a("Spin")],1)],1):t._e(),t._v(" "),t.loading?t._e():a("Row",[t.gcList.length?t._e():a("div",{staticClass:"no-gc"},[t._v("追踪期间暂无 GC 行为发生")]),t._v(" "),t.gcList.length?a("div",[a("Row",[a("Col",{attrs:{span:"5"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("追踪期内 GC 暂停总时间 (追踪时长)")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.totalGcTime)+" ( "+t._s(t.totalGTracingTime)+" )")])],1),t._v(" "),a("Col",{attrs:{span:"9"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("GC 次数 (Scavenge / Mark-Sweep / Incremental-Marking)")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.gcTimes.total)+" ( "+t._s(t.gcTimes.scavenge)+" / "+t._s(t.gcTimes.marksweep)+" / "+t._s(t.gcTimes.marking)+" )")])],1),t._v(" "),a("Col",{attrs:{span:"5"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("第一次 GC 前堆大小")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.memoryBeforeFirstGc))])],1),t._v(" "),a("Col",{attrs:{span:"5"}},[a("Row",{staticClass:"analytics-overview-title"},[t._v("最后一次 GC 后堆大小")]),t._v(" "),a("Row",{staticClass:"analytics-overview-value"},[t._v(t._s(t.memoryAfterLastGc))])],1)],1),t._v(" "),a("Row",{staticClass:"sub-title"},[t._v("GC 追踪分析概览")]),t._v(" "),a("Row",{staticClass:"overview-content"},[a("Col",{attrs:{span:"8"}},[a("div",{staticClass:"mini-chart-title",staticStyle:{"margin-bottom":"15px"}},[t._v("GC 暂停时间占比 ( "+t._s(t.progressPercentage)+" )")]),t._v(" "),a("div",{staticClass:"progress"},[a("div",{staticClass:"progress-active",style:"width: "+t.progressPercentage})])]),t._v(" "),a("Col",{attrs:{span:"8"}},[a("div",{staticClass:"mini-chart-title"},[t._v("GC 暂停时间分布 (ms)")]),t._v(" "),a("x-mini-multi-scatter",{attrs:{id:"gc-pause",fields:["(ms)","name","type"],types:["scavenge","marksweep","marking"],chartData:t.gcPauseData,"show-color":"#3498DB","care-key":"type"},on:{clickGcObject:t.clickGcObject}})],1),t._v(" "),a("Col",{attrs:{span:"8"}},[a("div",{staticClass:"mini-chart-title"},[t._v("GC 内存变化分布 (MB)")]),t._v(" "),a("x-mini-multi-scatter",{attrs:{id:"gc-reduce",fields:["(MB)","name","type"],types:["scavenge","marksweep","marking"],chartData:t.gcReduceData,"show-color":"#F5B041","care-key":"type"},on:{clickGcObject:t.clickGcObject}})],1)],1),t._v(" "),a("Row",{staticClass:"sub-title",staticStyle:{"margin-top":"0"}},[t._v("GC 追踪详细分析")]),t._v(" "),a("Row",{staticClass:"analytics-content"},[a("Col",{attrs:{span:"18"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"11"}},[a("x-histogram",{attrs:{id:"gcCostTrend",fields:["time","value","type"],alias:{value:"GC 耗时 (ms)"},"chart-data":t.gcCostTrend,formatter:t.formatTime,"color-keys":["scavenge","marksweep","marking"]},on:{clickGcObject:t.clickGcObject,pushChart:t.pushChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1),t._v(" "),a("Col",{attrs:{span:"11"}},[a("x-line",{attrs:{id:"gcHeapReduceTrend",fields:["time","value","type"],alias:{value:"堆内存变化 (MB)"},"chart-data":t.gcHeapReduceTrend,formatter:t.formatSize,"show-color":"#72ccba"},on:{clickGcObject:t.clickGcObject,pushChart:t.pushChart,plotmove:t.plotmove,plotleave:t.plotleave}})],1)],1),t._v(" "),a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"22"}},[a("x-gc-scatter",{attrs:{id:"gcSpaceTrend",fields:["time","space","change"],alias:{space:"V8 各堆空间名称"},chartData:t.gcSpaceTrend,formatter:t.formatSize},on:{clickGcObject:t.clickGcObject}})],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Icon",{staticClass:"icon",attrs:{color:"#f3a1a1",type:"md-square"}}),t._v("GC 后空间内存增加\n              ")],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Icon",{staticClass:"icon",attrs:{color:"#adbcc9",type:"md-square"}}),t._v("GC 后空间内存减小\n              ")],1)],1)],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("Row",{class:"analytics-title-common "+t.showGcData.type},[a("Col",{attrs:{span:"6"}},[1!==t.showGcData.index?a("Icon",{staticClass:"analytics-icon",attrs:{type:"ios-arrow-dropleft"},on:{click:t.dropleft}}):t._e(),t._v(" "),1===t.showGcData.index?a("Icon",{staticClass:"analytics-icon analytics-icon-disable",attrs:{type:"ios-arrow-dropleft"}}):t._e()],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",[t._v("\n                  第\n                  "),a("span",{staticStyle:{"font-size":"30px"}},[t._v(t._s(t.showGcData.index))]),t._v(" 次 GC\n                ")]),t._v(" "),a("Row",{staticStyle:{"font-size":"12px"}},[t._v("类型: "+t._s(t.showGcData.type))])],1),t._v(" "),a("Col",{attrs:{span:"6"}},[t.showGcData.index!==t.gcList.length?a("Icon",{staticClass:"analytics-icon",attrs:{type:"ios-arrow-dropright"},on:{click:t.dropright}}):t._e(),t._v(" "),t.showGcData.index===t.gcList.length?a("Icon",{staticClass:"analytics-icon analytics-icon-disable",attrs:{type:"ios-arrow-dropright"}}):t._e()],1)],1),t._v(" "),a("Row",{staticClass:"analytics-info",attrs:{type:"flex",justify:"center"}},[a("Col",{staticStyle:{"margin-top":"10px"},attrs:{span:"22"}},[a("Row",[a("Col",{attrs:{span:"12"}},[a("Row",[t._v("距离进程启动时间")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.formatTime(1e3*t.showGcData.timeFromStart)))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",[t._v("累计 GC 暂停时间 (总数)")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.formatTime(t.showGcData.totalSpentfromStart))+" ("+t._s(t.showGcData.totalTimesfromStart)+")")])],1)],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"},attrs:{span:"22"}},[a("Row",[a("Col",{attrs:{span:"12"}},[a("Row",[t._v("堆大小变化")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.formatSize(t.showGcData.totalSizeAfter-t.showGcData.totalSizeBefore)))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",[t._v("本次 GC 暂停时间")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.formatTime(t.showGcData.end-t.showGcData.start)))])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"analytics-radio",attrs:{type:"flex",justify:"center"}},[a("RadioGroup",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"},model:{value:t.selectGcStatus,callback:function(e){t.selectGcStatus=e},expression:"selectGcStatus"}},[a("Radio",{attrs:{label:"before"}},[t._v("GC 前")]),t._v(" "),a("Radio",{attrs:{label:"after"}},[t._v("GC 后")])],1)],1),t._v(" "),a("Row",{staticClass:"analytics-space-detail",attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"22"}},[a("Row",{staticStyle:{"margin-top":"15px",padding:"2px"}},[a("Row",t._l(t.spacesExceptOldSpace,function(e,s){return a("Col",{key:s,staticClass:"space",style:"height: 130px;"+(0!==s?"padding-left:1px":""),attrs:{span:t.getSpaceWidth(e)}},[a("Row",{staticStyle:{height:"100%"}},[a("Row",{staticClass:"space-unused",style:"background-color: "+t.getSpaceColor(e)+";height: "+(100-t.getUsedHeight(e))+"%"},[a("div",{staticStyle:{height:"100%"},on:{mouseover:function(a){return a.stopPropagation(),t.showTooltip(e,"active::unused",a)},mousemove:function(a){return a.stopPropagation(),t.showTooltip(e,"active::unused",a)},mouseout:function(e){return e.stopPropagation(),t.resetTooltip()}}})]),t._v(" "),a("Row",{style:"margin-top:1px;background-color: "+t.getSpaceColor(e)+";height: "+t.getUsedHeight(e)+"%"},[a("div",{staticStyle:{height:"100%"},on:{mouseover:function(a){return a.stopPropagation(),t.showTooltip(e,"active::used",a)},mousemove:function(a){return a.stopPropagation(),t.showTooltip(e,"active::used",a)},mouseout:function(e){return e.stopPropagation(),t.resetTooltip()}}})])],1)],1)}),1),t._v(" "),a("Row",{staticClass:"space",staticStyle:{height:"130px","margin-top":"2px"}},[a("Row",{staticClass:"space-unused",style:"background-color: "+t.getSpaceColor("old_space")+";height: "+(100-t.getUsedHeight("old_space"))+"%;"},[a("div",{staticStyle:{height:"100%"},on:{mouseover:function(e){return e.stopPropagation(),t.showTooltip("old_space","active::unused",e)},mousemove:function(e){return e.stopPropagation(),t.showTooltip("old_space","active::unused",e)},mouseout:function(e){return e.stopPropagation(),t.resetTooltip()}}})]),t._v(" "),a("Row",{style:"margin-top:1px;background-color: "+t.getSpaceColor("old_space")+";height: "+t.getUsedHeight("old_space")+"%;"},[a("div",{staticStyle:{height:"100%"},on:{mouseover:function(e){return e.stopPropagation(),t.showTooltip("old_space","active::used",e)},mousemove:function(e){return e.stopPropagation(),t.showTooltip("old_space","active::used",e)},mouseout:function(e){return e.stopPropagation(),t.resetTooltip()}}})])],1)],1)],1)],1),t._v(" "),a("Row",{staticClass:"analytics-info"},[a("Col",{staticStyle:{"margin-top":"10px"},attrs:{span:"22"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"12"}},[a("Row",[t._v("所有空间已使用大小")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.totalSpacesUsedSize))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",[t._v("所有空间实际大小")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.totalSpacesSize))])],1)],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"10px"},attrs:{span:"22"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",{attrs:{span:"12"}},[a("Row",[t._v("Page 空洞大小 (部分)")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.totalHoleSize))])],1),t._v(" "),a("Col",{attrs:{span:"12"}},[a("Row",[t._v("物理分配内存大小")]),t._v(" "),a("Row",{staticClass:"analytics-info-value"},[t._v(t._s(t.totalPhysicalSpacesSize))])],1)],1)],1),t._v(" "),a("Col",{staticStyle:{"margin-top":"10px"},attrs:{span:"22"}},[a("Row",{attrs:{type:"flex",justify:"center"}},[a("Col",[a("Row",[t._v("堆各空间主要内存变化部分")]),t._v(" "),a("Row",{staticClass:"space-change-info",domProps:{innerHTML:t._s(t.mainChangeSpace)}})],1)],1)],1)],1)],1)],1)],1):t._e()])],1),t._v(" "),a("div",{ref:"space-detail",staticClass:"tooltip trace"},[a("Row",{staticClass:"tip-content"},[a("Row",[a("Col",[t._v(t._s(t.spaceDetail))])],1)],1)],1)],1)},staticRenderFns:[]};var sa={props:["data"],components:{"x-diag":Ue,"x-gc-trace":a("VU/8")(ea,aa,!1,function(t){a("mtWk")},"data-v-68cbd25c",null).exports},computed:{fileType:function(){return(this.data||{}).fileType||""}}},ia={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",["diag"===this.fileType?e("x-diag",{attrs:{data:this.data}}):this._e(),this._v(" "),"gclog"===this.fileType?e("x-gc-trace",{attrs:{data:this.data}}):this._e()],1)},staticRenderFns:[]},oa=a("VU/8")(sa,ia,!1,null,null,null).exports,na={methods:{changeOperation:function(t){if(this.operation!==t){var e=this.$route.params.appId;this.$router.push({path:"/app/"+e+"/"+t}),this.operation=t}},getAppInfo:function(){var t=this;u.a.get("/api/application",{params:{appId:this.appId}}).then(function(e){(e=e.data).ok?(e=e.data,t.appName=e.name,t.own=e.own):f.call(t,e.message||"获取 App 信息失败！",e.code)}).catch(function(e){return f.call(t,"获取 App 信息失败！ "+e,e.code)})},updateAppName:function(t){this.appName=t},xnodeAnalytics:function(t){var e=this.$route.params.appId,a=this.$router.resolve({path:"/app/"+e+"/analytics",query:t}).href;window.open(a,"_blank")}}},ra=p()({data:function(){return{appId:0,appName:"",own:!1,activeName:"console",operation:"agent",analyticData:null}},components:{"x-header":k,"x-setting":W,"x-alarm":nt,"x-team":ut,"x-file":yt,"x-agent":Fe,"x-analytics":oa},created:function(){this.analyticData=this.$route.query,this.operation=this.$route.params.operation||"agent",this.appId=this.$route.params.appId||0,this.getAppInfo()}},na),la={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"layout"},[a("x-header",{attrs:{"active-name":t.activeName}}),t._v(" "),a("Layout",[a("Sider",{attrs:{width:80}},[a("Menu",{staticStyle:{width:"80px","min-height":"100vh"},attrs:{theme:"dark",activeName:t.operation},on:{"on-select":t.changeOperation}},[a("MenuItem",{attrs:{name:"agent"}},[t._v("实例")]),t._v(" "),a("MenuItem",{attrs:{name:"file"}},[t._v("文件")]),t._v(" "),a("MenuItem",{attrs:{name:"team"}},[t._v("团队")]),t._v(" "),a("MenuItem",{attrs:{name:"alarm"}},[t._v("告警")]),t._v(" "),t.own?a("MenuItem",{class:"setting"===t.operation?"ivu-menu-item-active":"",attrs:{name:"setting"}},[t._v("设置")]):t._e()],1)],1),t._v(" "),a("Content",{style:{background:"#fff",minHeight:"500px"}},["agent"===t.operation?a("x-agent",{attrs:{"app-name":t.appName}}):t._e(),t._v(" "),"file"===t.operation?a("x-file",{attrs:{"app-name":t.appName},on:{xnodeAnalytics:t.xnodeAnalytics}}):t._e(),t._v(" "),"team"===t.operation?a("x-team",{attrs:{"app-name":t.appName}}):t._e(),t._v(" "),"alarm"===t.operation?a("x-alarm",{attrs:{"app-name":t.appName}}):t._e(),t._v(" "),"setting"===t.operation&&t.own?a("x-setting",{attrs:{"app-name":t.appName},on:{updateAppName:t.updateAppName}}):t._e(),t._v(" "),"analytics"===t.operation?a("x-analytics",{attrs:{data:t.analyticData}}):t._e()],1)],1)],1)},staticRenderFns:[]};var ca=a("VU/8")(ra,la,!1,function(t){a("EwBh")},"data-v-8e19ae9e",null).exports,pa={components:{"x-header":k,"x-alarm":nt},data:function(){return{appCount:0,instanceCount:0,userCount:0,apps:[],users:[],appColumns:[{title:"名称",key:"name"},{title:"创建时间",key:"gm_create"},{title:"拥有者",key:"owner"},{title:"实例数",key:"count"},{title:"成员",key:"members",render:function(t,e){return t("div",e.row.members.length.toString())}}]}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var t=this;u.a.get("/api/admin/summary").then(function(e){for(var a in e.data.data)t[a]=e.data.data[a]})}}},da={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"layout"},[a("x-header",{ref:"xheader",attrs:{"active-name":"adminView"}}),t._v(" "),a("Layout",{staticClass:"content"},[a("Content",{ref:"xbody",style:{background:"#fff",padding:"20px"}},[a("Tabs",[a("TabPane",{attrs:{label:"全局告警规则"}},[a("x-alarm",{staticStyle:{"margin-bottom":"100px"},attrs:{"app-name":"全局告警","global-rule":!0}})],1),t._v(" "),a("TabPane",{attrs:{label:"统计"}},[a("i-circle",{attrs:{size:200,"trail-width":4,"stroke-width":5,percent:100,"stroke-linecap":"square","stroke-color":"#43a3fb"}},[a("div",{staticClass:"demo-Circle-custom"},[a("h1",[t._v(t._s(t.appCount))]),t._v(" "),a("p",[t._v("接入应用总数")])])]),t._v(" "),a("i-circle",{attrs:{size:200,"trail-width":4,"stroke-width":5,percent:100,"stroke-linecap":"square","stroke-color":"#43a3fb"}},[a("div",{staticClass:"demo-Circle-custom"},[a("h1",[t._v(t._s(t.instanceCount))]),t._v(" "),a("p",[t._v("连接实例总数")])])]),t._v(" "),a("i-circle",{attrs:{size:200,"trail-width":4,"stroke-width":5,percent:100,"stroke-linecap":"square","stroke-color":"#43a3fb"}},[a("div",{staticClass:"demo-Circle-custom"},[a("h1",[t._v(t._s(t.userCount))]),t._v(" "),a("p",[t._v("用户总数")])])])],1),t._v(" "),a("TabPane",{attrs:{label:"应用"}},[a("Table",{attrs:{data:t.apps,columns:t.appColumns}})],1),t._v(" "),a("TabPane",{attrs:{label:"用户"}},[a("List",t._l(t.users,function(e){return a("ListItem",{key:e.id},[a("ListItemMeta",{attrs:{title:e.user_name,description:e.work_id}}),t._v("\n              "+t._s(e.apps.join(","))+"\n            ")],1)}),1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var ua=a("VU/8")(pa,da,!1,function(t){a("1Cko")},"data-v-243611de",null).exports;s.default.use(l.a);var ha=new l.a({routes:[{path:"/",name:"Home",component:L},{path:"/console",name:"Console",component:G},{path:"/admin",name:"admin",component:ua},{path:"/app/:appId/:operation/:agentId?",name:"Detail",component:ca}]});s.default.config.productionTip=!1,s.default.use(o.a),new s.default({el:"#app",router:ha,components:{App:r},template:"<App/>"})},Teoh:function(t,e){},XFle:function(t,e){},b6ah:function(t,e){},bDuY:function(t,e){},lR7k:function(t,e){},ljx0:function(t,e){},luJ5:function(t,e){},mQRO:function(t,e){},mtWk:function(t,e){},myhN:function(t,e){},"od7/":function(t,e){},"r5+f":function(t,e){},tXiL:function(t,e){},uslO:function(t,e,a){var s={"./af":"3CJN","./af.js":"3CJN","./ar":"3MVc","./ar-dz":"tkWw","./ar-dz.js":"tkWw","./ar-kw":"j8cJ","./ar-kw.js":"j8cJ","./ar-ly":"wPpW","./ar-ly.js":"wPpW","./ar-ma":"dURR","./ar-ma.js":"dURR","./ar-sa":"7OnE","./ar-sa.js":"7OnE","./ar-tn":"BEem","./ar-tn.js":"BEem","./ar.js":"3MVc","./az":"eHwN","./az.js":"eHwN","./be":"3hfc","./be.js":"3hfc","./bg":"lOED","./bg.js":"lOED","./bm":"hng5","./bm.js":"hng5","./bn":"aM0x","./bn.js":"aM0x","./bo":"w2Hs","./bo.js":"w2Hs","./br":"OSsP","./br.js":"OSsP","./bs":"aqvp","./bs.js":"aqvp","./ca":"wIgY","./ca.js":"wIgY","./cs":"ssxj","./cs.js":"ssxj","./cv":"N3vo","./cv.js":"N3vo","./cy":"ZFGz","./cy.js":"ZFGz","./da":"YBA/","./da.js":"YBA/","./de":"DOkx","./de-at":"8v14","./de-at.js":"8v14","./de-ch":"Frex","./de-ch.js":"Frex","./de.js":"DOkx","./dv":"rIuo","./dv.js":"rIuo","./el":"CFqe","./el.js":"CFqe","./en-au":"Sjoy","./en-au.js":"Sjoy","./en-ca":"Tqun","./en-ca.js":"Tqun","./en-gb":"hPuz","./en-gb.js":"hPuz","./en-ie":"ALEw","./en-ie.js":"ALEw","./en-il":"QZk1","./en-il.js":"QZk1","./en-in":"yJfC","./en-in.js":"yJfC","./en-nz":"dyB6","./en-nz.js":"dyB6","./en-sg":"NYST","./en-sg.js":"NYST","./eo":"Nd3h","./eo.js":"Nd3h","./es":"LT9G","./es-do":"7MHZ","./es-do.js":"7MHZ","./es-us":"INcR","./es-us.js":"INcR","./es.js":"LT9G","./et":"XlWM","./et.js":"XlWM","./eu":"sqLM","./eu.js":"sqLM","./fa":"2pmY","./fa.js":"2pmY","./fi":"nS2h","./fi.js":"nS2h","./fil":"rMbQ","./fil.js":"rMbQ","./fo":"OVPi","./fo.js":"OVPi","./fr":"tzHd","./fr-ca":"bXQP","./fr-ca.js":"bXQP","./fr-ch":"VK9h","./fr-ch.js":"VK9h","./fr.js":"tzHd","./fy":"g7KF","./fy.js":"g7KF","./ga":"U5Iz","./ga.js":"U5Iz","./gd":"nLOz","./gd.js":"nLOz","./gl":"FuaP","./gl.js":"FuaP","./gom-deva":"VGQH","./gom-deva.js":"VGQH","./gom-latn":"+27R","./gom-latn.js":"+27R","./gu":"rtsW","./gu.js":"rtsW","./he":"Nzt2","./he.js":"Nzt2","./hi":"ETHv","./hi.js":"ETHv","./hr":"V4qH","./hr.js":"V4qH","./hu":"xne+","./hu.js":"xne+","./hy-am":"GrS7","./hy-am.js":"GrS7","./id":"yRTJ","./id.js":"yRTJ","./is":"upln","./is.js":"upln","./it":"FKXc","./it-ch":"/E8D","./it-ch.js":"/E8D","./it.js":"FKXc","./ja":"ORgI","./ja.js":"ORgI","./jv":"JwiF","./jv.js":"JwiF","./ka":"RnJI","./ka.js":"RnJI","./kk":"j+vx","./kk.js":"j+vx","./km":"5j66","./km.js":"5j66","./kn":"gEQe","./kn.js":"gEQe","./ko":"eBB/","./ko.js":"eBB/","./ku":"kI9l","./ku.js":"kI9l","./ky":"6cf8","./ky.js":"6cf8","./lb":"z3hR","./lb.js":"z3hR","./lo":"nE8X","./lo.js":"nE8X","./lt":"/6P1","./lt.js":"/6P1","./lv":"jxEH","./lv.js":"jxEH","./me":"svD2","./me.js":"svD2","./mi":"gEU3","./mi.js":"gEU3","./mk":"Ab7C","./mk.js":"Ab7C","./ml":"oo1B","./ml.js":"oo1B","./mn":"CqHt","./mn.js":"CqHt","./mr":"5vPg","./mr.js":"5vPg","./ms":"ooba","./ms-my":"G++c","./ms-my.js":"G++c","./ms.js":"ooba","./mt":"oCzW","./mt.js":"oCzW","./my":"F+2e","./my.js":"F+2e","./nb":"FlzV","./nb.js":"FlzV","./ne":"/mhn","./ne.js":"/mhn","./nl":"3K28","./nl-be":"Bp2f","./nl-be.js":"Bp2f","./nl.js":"3K28","./nn":"C7av","./nn.js":"C7av","./oc-lnc":"KOFO","./oc-lnc.js":"KOFO","./pa-in":"pfs9","./pa-in.js":"pfs9","./pl":"7LV+","./pl.js":"7LV+","./pt":"ZoSI","./pt-br":"AoDM","./pt-br.js":"AoDM","./pt.js":"ZoSI","./ro":"wT5f","./ro.js":"wT5f","./ru":"ulq9","./ru.js":"ulq9","./sd":"fW1y","./sd.js":"fW1y","./se":"5Omq","./se.js":"5Omq","./si":"Lgqo","./si.js":"Lgqo","./sk":"OUMt","./sk.js":"OUMt","./sl":"2s1U","./sl.js":"2s1U","./sq":"V0td","./sq.js":"V0td","./sr":"f4W3","./sr-cyrl":"c1x4","./sr-cyrl.js":"c1x4","./sr.js":"f4W3","./ss":"7Q8x","./ss.js":"7Q8x","./sv":"Fpqq","./sv.js":"Fpqq","./sw":"DSXN","./sw.js":"DSXN","./ta":"+7/x","./ta.js":"+7/x","./te":"Nlnz","./te.js":"Nlnz","./tet":"gUgh","./tet.js":"gUgh","./tg":"5SNd","./tg.js":"5SNd","./th":"XzD+","./th.js":"XzD+","./tl-ph":"3LKG","./tl-ph.js":"3LKG","./tlh":"m7yE","./tlh.js":"m7yE","./tr":"k+5o","./tr.js":"k+5o","./tzl":"iNtv","./tzl.js":"iNtv","./tzm":"FRPF","./tzm-latn":"krPU","./tzm-latn.js":"krPU","./tzm.js":"FRPF","./ug-cn":"To0v","./ug-cn.js":"To0v","./uk":"ntHu","./uk.js":"ntHu","./ur":"uSe8","./ur.js":"uSe8","./uz":"XU1s","./uz-latn":"/bsm","./uz-latn.js":"/bsm","./uz.js":"XU1s","./vi":"0X8Q","./vi.js":"0X8Q","./x-pseudo":"e/KL","./x-pseudo.js":"e/KL","./yo":"YXlc","./yo.js":"YXlc","./zh-cn":"Vz2w","./zh-cn.js":"Vz2w","./zh-hk":"ZUyn","./zh-hk.js":"ZUyn","./zh-mo":"+WA1","./zh-mo.js":"+WA1","./zh-tw":"BbgG","./zh-tw.js":"BbgG"};function i(t){return a(o(t))}function o(t){var e=s[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}i.keys=function(){return Object.keys(s)},i.resolve=o,t.exports=i,i.id="uslO"},wiix:function(t,e){},xvAY:function(t,e){}},["NHnr"]);